{
  "hash": "60aece6932da43f0bf679bf3503251ad",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Storytelling with Data: Let’s Practice, Improve this table!\"\ndescription: \"Practicing to improve a cross-tab report table using Python\"\nauthor:\n  - name: \"Tuan Le Khac\"\n    url: https://lktuan.github.io/\ndate: 05-22-2024\ncategories: [Python, Visualization] # self-defined categories\nimage: .jpg\ndraft: false # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\n\nformat: \n  html: \n    code-fold: false\n    code-summary: \"Show the code\"\n    code-line-numbers: true\ncss: html/styles.scss\neditor: visual\n---\n\n# 1. Motivation\nLấy cảm hứng từ bài [post](https://rpubs.com/chidungkt/1139405) của thầy Nguyễn Chí Dũng về việc giải các exercise thuộc Chương 2 cuốn sách **Storytelling with Data: Let’s Practice** của tác giả [Cole Nussbaumer Knaflic](https://www.linkedin.com/in/colenussbaumer/) sử dụng R, mình muốn cải thiện 1 bảng biểu nhưng sử dụng Python (trong cuốn sách gốc, có lẽ tác giả sử dụng Excel).\n\n# 2. Let's Practice\nMình đang học `{ggplot2}` trên R để thực hành hình ảnh hóa dữ liệu, tuy nhiên có vẻ package này (và tương ứng là `plotnine` trên Python không phù hợp cho báo cáo bảng). Trong bài post, thầy Dũng cũng sử dụng một library khác là `kableExtra` (tham khảo [đây](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html)).\n\nSau một lúc google thì có vẻ có một package của Python phù hợp để làm nhiệm vụ này, đó là `great_tables` (tham khảo [đây](https://posit-dev.github.io/great-tables/articles/intro.html)).\n\n## 2.1. Import the data\nOkay đầu tiên cần import và làm sạch dữ liệu. Bảng có sẵn trong file Exercise có vẻ dùng để báo cáo hơn là lưu trữ dữ liệu.\n\n::: {#cd3bf429 .cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\n\ndata = pd.read_excel(\n  \"2.1 EXERCISE.xlsx\",\n  sheet_name = \"EXERCISE 2.1\",\n  skiprows=6\n)\n\ndata = data.drop('Unnamed: 0', axis=1)\ndata = data.rename(columns={ \"Tier\": \"tier\"\n                    ,\"# of Accounts\": \"no_of_account\"\n                    ,\"% Accounts\": \"pct_of_account\"\n                    ,\"Revenue ($M)\": \"revenue\"\n                    ,\"% Revenue\": \"pct_of_revenue\"})\n```\n:::\n\n\n## 2.2. Data manipulation\nYep giờ ta đã có 1 bảng data khá sạch, tuy nhiên lưu ý là bảng đang không thể hiện toàn bộ dữ liệu (total của `pct_of_account` chỉ là `81.86%`). Ta cần tính toán thêm `All other` và `Grand Total` (lý do là mình chưa tìm thấy function hiển thị Grand Total với package đang sử dụng, ngay cả trong ví dụ [này](https://posit-dev.github.io/great-tables/blog/pycon-2024-great-tables-are-possible/), GT cũng sử dụng data đã có sẵn Grand Total).\n\n::: {#4b97dd12 .cell execution_count=2}\n``` {.python .cell-code}\nall_other_pct_of_account = 1 - data[\"pct_of_account\"].sum()\nall_other_no_of_account = round(all_other_pct_of_account / data[\"pct_of_account\"][0] * data[\"no_of_account\"][0],0)\n\nall_other_pct_of_revenue = 1 - data[\"pct_of_revenue\"].sum()\nall_other_revenue = round(all_other_pct_of_revenue / data[\"pct_of_revenue\"][0] * data[\"revenue\"][0],3)\n\nall_other = pd.Series({ \"tier\": \"All other\",\n                        \"no_of_account\": all_other_no_of_account,\n                        \"pct_of_account\": all_other_pct_of_account,\n                        \"revenue\":all_other_revenue,\n                        \"pct_of_revenue\": all_other_pct_of_revenue})\n\ndata = pd.concat([data, all_other.to_frame().T])\n\ndata.loc[\"total\"] = data.sum()\ndata.loc[data.index[-1], 'tier'] = 'Grand Total'\n```\n:::\n\n\nShow the data:\n\n::: {#30e585d1 .cell execution_count=3}\n``` {.python .cell-code}\nfrom great_tables import GT\n\n( \n  GT(data)\n  .fmt_number(columns= [\"no_of_account\",\"pct_of_account\",\"revenue\",\"pct_of_revenue\"],decimals=2))\n```\n\n::: {.cell-output .cell-output-display execution_count=13}\n```{=html}\n<div id=\"pqeonppctd\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>\n#pqeonppctd table {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n          -webkit-font-smoothing: antialiased;\n          -moz-osx-font-smoothing: grayscale;\n        }\n\n#pqeonppctd thead, tbody, tfoot, tr, td, th { border-style: none; }\n tr { background-color: transparent; }\n#pqeonppctd p { margin: 0; padding: 0; }\n #pqeonppctd .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }\n #pqeonppctd .gt_caption { padding-top: 4px; padding-bottom: 4px; }\n #pqeonppctd .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }\n #pqeonppctd .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }\n #pqeonppctd .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #pqeonppctd .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }\n #pqeonppctd .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #pqeonppctd .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }\n #pqeonppctd .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }\n #pqeonppctd .gt_column_spanner_outer:first-child { padding-left: 0; }\n #pqeonppctd .gt_column_spanner_outer:last-child { padding-right: 0; }\n #pqeonppctd .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }\n #pqeonppctd .gt_spanner_row { border-bottom-style: hidden; }\n #pqeonppctd .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }\n #pqeonppctd .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }\n #pqeonppctd .gt_from_md> :first-child { margin-top: 0; }\n #pqeonppctd .gt_from_md> :last-child { margin-bottom: 0; }\n #pqeonppctd .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }\n #pqeonppctd .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }\n #pqeonppctd .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }\n #pqeonppctd .gt_row_group_first td { border-top-width: 2px; }\n #pqeonppctd .gt_row_group_first th { border-top-width: 2px; }\n #pqeonppctd .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }\n #pqeonppctd .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }\n #pqeonppctd .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }\n #pqeonppctd .gt_left { text-align: left; }\n #pqeonppctd .gt_center { text-align: center; }\n #pqeonppctd .gt_right { text-align: right; font-variant-numeric: tabular-nums; }\n #pqeonppctd .gt_font_normal { font-weight: normal; }\n #pqeonppctd .gt_font_bold { font-weight: bold; }\n #pqeonppctd .gt_font_italic { font-style: italic; }\n #pqeonppctd .gt_super { font-size: 65%; }\n #pqeonppctd .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }\n #pqeonppctd .gt_asterisk { font-size: 100%; vertical-align: 0; }\n \n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n\n<tr class=\"gt_col_headings\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"tier\">tier</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"no_of_account\">no_of_account</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"pct_of_account\">pct_of_account</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"revenue\">revenue</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"pct_of_revenue\">pct_of_revenue</th>\n</tr>\n<tbody class=\"gt_table_body\">\n  <tr>\n    <td class=\"gt_row gt_left\">A</td>\n    <td class=\"gt_row gt_right\">77.00</td>\n    <td class=\"gt_row gt_right\">0.07</td>\n    <td class=\"gt_row gt_right\">4.67</td>\n    <td class=\"gt_row gt_right\">0.25</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">A+</td>\n    <td class=\"gt_row gt_right\">19.00</td>\n    <td class=\"gt_row gt_right\">0.02</td>\n    <td class=\"gt_row gt_right\">3.93</td>\n    <td class=\"gt_row gt_right\">0.21</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">B</td>\n    <td class=\"gt_row gt_right\">338.00</td>\n    <td class=\"gt_row gt_right\">0.31</td>\n    <td class=\"gt_row gt_right\">5.98</td>\n    <td class=\"gt_row gt_right\">0.32</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">C</td>\n    <td class=\"gt_row gt_right\">425.00</td>\n    <td class=\"gt_row gt_right\">0.39</td>\n    <td class=\"gt_row gt_right\">2.80</td>\n    <td class=\"gt_row gt_right\">0.15</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">D</td>\n    <td class=\"gt_row gt_right\">24.00</td>\n    <td class=\"gt_row gt_right\">0.02</td>\n    <td class=\"gt_row gt_right\">0.37</td>\n    <td class=\"gt_row gt_right\">0.02</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">All other</td>\n    <td class=\"gt_row gt_right\">205.00</td>\n    <td class=\"gt_row gt_right\">0.19</td>\n    <td class=\"gt_row gt_right\">0.94</td>\n    <td class=\"gt_row gt_right\">0.05</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">Grand Total</td>\n    <td class=\"gt_row gt_right\">1,088.00</td>\n    <td class=\"gt_row gt_right\">1.00</td>\n    <td class=\"gt_row gt_right\">18.70</td>\n    <td class=\"gt_row gt_right\">1.00</td>\n  </tr>\n</tbody>\n\n\n</table>\n\n</div>\n        \n```\n:::\n:::\n\n\n## 2.3. Visualization\nĐược rồi, giờ ta có thể dùng `great_tables` để tiến hành visualize. Về cơ bản, chỉ cần khởi tạo một object `GT()` có  thể mở rộng được, các element/hoặc format được định nghĩa về sau.\n\nDưới đây chúng ta trình bày một bảng đơn giản với tiêu đề, tên cột, cũng như định dạng lại dữ liệu.\n\n::: {#93271502 .cell execution_count=4}\n``` {.python .cell-code}\n(\n  GT(data)\n  .tab_header(title=\"New client tier share\")\n  .cols_label(\n    tier = \"Tier\",\n    no_of_account = \"# of Accounts\",\n    pct_of_account = \"% Accounts\",\n    revenue = \"Revenue ($M)\",\n    pct_of_revenue = \"% Revenue\"\n  )\n  .fmt_number(columns=\"no_of_account\",decimals=0)\n  .fmt_percent(columns=[\"pct_of_account\", \"pct_of_revenue\"], decimals=2)\n  .fmt_currency(columns = \"revenue\", currency=\"USD\", decimals=2)\n  .tab_source_note(source_note=\"Figure 2.1b: Slightly improved table\")\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=14}\n```{=html}\n<div id=\"gtsipyruix\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>\n#gtsipyruix table {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n          -webkit-font-smoothing: antialiased;\n          -moz-osx-font-smoothing: grayscale;\n        }\n\n#gtsipyruix thead, tbody, tfoot, tr, td, th { border-style: none; }\n tr { background-color: transparent; }\n#gtsipyruix p { margin: 0; padding: 0; }\n #gtsipyruix .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }\n #gtsipyruix .gt_caption { padding-top: 4px; padding-bottom: 4px; }\n #gtsipyruix .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }\n #gtsipyruix .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }\n #gtsipyruix .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #gtsipyruix .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }\n #gtsipyruix .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #gtsipyruix .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }\n #gtsipyruix .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }\n #gtsipyruix .gt_column_spanner_outer:first-child { padding-left: 0; }\n #gtsipyruix .gt_column_spanner_outer:last-child { padding-right: 0; }\n #gtsipyruix .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }\n #gtsipyruix .gt_spanner_row { border-bottom-style: hidden; }\n #gtsipyruix .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }\n #gtsipyruix .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }\n #gtsipyruix .gt_from_md> :first-child { margin-top: 0; }\n #gtsipyruix .gt_from_md> :last-child { margin-bottom: 0; }\n #gtsipyruix .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }\n #gtsipyruix .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }\n #gtsipyruix .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }\n #gtsipyruix .gt_row_group_first td { border-top-width: 2px; }\n #gtsipyruix .gt_row_group_first th { border-top-width: 2px; }\n #gtsipyruix .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }\n #gtsipyruix .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }\n #gtsipyruix .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }\n #gtsipyruix .gt_left { text-align: left; }\n #gtsipyruix .gt_center { text-align: center; }\n #gtsipyruix .gt_right { text-align: right; font-variant-numeric: tabular-nums; }\n #gtsipyruix .gt_font_normal { font-weight: normal; }\n #gtsipyruix .gt_font_bold { font-weight: bold; }\n #gtsipyruix .gt_font_italic { font-style: italic; }\n #gtsipyruix .gt_super { font-size: 65%; }\n #gtsipyruix .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }\n #gtsipyruix .gt_asterisk { font-size: 100%; vertical-align: 0; }\n \n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n<thead class=\"gt_header\">\n  <tr>\n    <th colspan=\"5\" class=\"gt_heading gt_title gt_font_normal\">New client tier share</th>\n  </tr>\n</thead>\n<tr class=\"gt_col_headings\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Tier\">Tier</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"# of Accounts\"># of Accounts</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"% Accounts\">% Accounts</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Revenue ($M)\">Revenue ($M)</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"% Revenue\">% Revenue</th>\n</tr>\n<tbody class=\"gt_table_body\">\n  <tr>\n    <td class=\"gt_row gt_left\">A</td>\n    <td class=\"gt_row gt_right\">77</td>\n    <td class=\"gt_row gt_right\">7.08%</td>\n    <td class=\"gt_row gt_right\">$4.67</td>\n    <td class=\"gt_row gt_right\">25.00%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">A+</td>\n    <td class=\"gt_row gt_right\">19</td>\n    <td class=\"gt_row gt_right\">1.75%</td>\n    <td class=\"gt_row gt_right\">$3.93</td>\n    <td class=\"gt_row gt_right\">21.00%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">B</td>\n    <td class=\"gt_row gt_right\">338</td>\n    <td class=\"gt_row gt_right\">31.07%</td>\n    <td class=\"gt_row gt_right\">$5.98</td>\n    <td class=\"gt_row gt_right\">32.00%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">C</td>\n    <td class=\"gt_row gt_right\">425</td>\n    <td class=\"gt_row gt_right\">39.06%</td>\n    <td class=\"gt_row gt_right\">$2.80</td>\n    <td class=\"gt_row gt_right\">15.00%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">D</td>\n    <td class=\"gt_row gt_right\">24</td>\n    <td class=\"gt_row gt_right\">2.21%</td>\n    <td class=\"gt_row gt_right\">$0.37</td>\n    <td class=\"gt_row gt_right\">2.00%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">All other</td>\n    <td class=\"gt_row gt_right\">205</td>\n    <td class=\"gt_row gt_right\">18.84%</td>\n    <td class=\"gt_row gt_right\">$0.94</td>\n    <td class=\"gt_row gt_right\">5.00%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">Grand Total</td>\n    <td class=\"gt_row gt_right\">1,088</td>\n    <td class=\"gt_row gt_right\">100.00%</td>\n    <td class=\"gt_row gt_right\">$18.70</td>\n    <td class=\"gt_row gt_right\">100.00%</td>\n  </tr>\n</tbody>\n  <tfoot class=\"gt_sourcenotes\">\n  \n  <tr>\n    <td class=\"gt_sourcenote\" colspan=\"5\">Figure 2.1b: Slightly improved table</td>\n  </tr>\n\n</tfoot>\n\n</table>\n\n</div>\n        \n```\n:::\n:::\n\n\nTrông ổn (ít nhất là trình bày số liệu một cách toàn vẹn) so với bản gốc rồi!\n\nTiếp tục, ta dùng helper `md()` để định dạng lại tiêu đề, sử dụng `.data_color()` để tạo heatmapping, sử dụng `tab_style()` để format dòng Grand Total,sử dụng `.opt_stylize()` để theming.\n\n::: {#d9cde35b .cell execution_count=5}\n``` {.python .cell-code}\nfrom great_tables import md, style, loc\n\n(\n  GT(data)\n  .tab_header(title=md(\"<strong>New client tier share</strong>\"))\n  .opt_align_table_header(align=\"left\")\n  .cols_label(\n    tier = \"Tier\",\n    no_of_account = \"# of Accounts\",\n    pct_of_account = \"% Accounts\",\n    revenue = \"($M) Revenue\", # change the label\n    pct_of_revenue = \"% Revenue\"\n  )\n  .fmt_number(columns=\"no_of_account\",decimals=0)\n  .fmt_percent(columns=[\"pct_of_account\", \"pct_of_revenue\"], decimals=0) # changed decimals\n  .fmt_currency(columns = \"revenue\", currency=\"USD\", decimals=1)# changed decimals\n  .tab_source_note(source_note=\"Figure 2.1c: Table with heatmapping\")\n  .data_color(\n    columns=[\"pct_of_account\", \"pct_of_revenue\"],\n    palette=[\"#57A6A1\", \"#577B8D\", \"#344C64\", \"#240750\"],\n    domain=[0, 1],\n    na_color=\"lightgray\",\n    autocolor_text = False\n  )\n  .tab_style(\n        style=style.fill(\"#EEEEEE\"),\n        locations=loc.body(rows=[6]),\n    )\n  .tab_style(\n        style=style.borders(sides=[\"top\", \"bottom\"], weight='2px', color=\"grey\"),\n        locations=loc.body(rows=[6])\n  )\n  .tab_style(\n        style=style.text(style=\"bolder\"),\n        locations=loc.body(rows=[6])\n  )\n  .opt_stylize(style=5 ,color='blue')\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=15}\n```{=html}\n<div id=\"menceyghdq\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>\n#menceyghdq table {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n          -webkit-font-smoothing: antialiased;\n          -moz-osx-font-smoothing: grayscale;\n        }\n\n#menceyghdq thead, tbody, tfoot, tr, td, th { border-style: none; }\n tr { background-color: transparent; }\n#menceyghdq p { margin: 0; padding: 0; }\n #menceyghdq .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }\n #menceyghdq .gt_caption { padding-top: 4px; padding-bottom: 4px; }\n #menceyghdq .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }\n #menceyghdq .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }\n #menceyghdq .gt_heading { background-color: #FFFFFF; text-align: left; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #menceyghdq .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; }\n #menceyghdq .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #menceyghdq .gt_col_heading { color: #FFFFFF; background-color: #004D80; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }\n #menceyghdq .gt_column_spanner_outer { color: #FFFFFF; background-color: #004D80; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }\n #menceyghdq .gt_column_spanner_outer:first-child { padding-left: 0; }\n #menceyghdq .gt_column_spanner_outer:last-child { padding-right: 0; }\n #menceyghdq .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }\n #menceyghdq .gt_spanner_row { border-bottom-style: hidden; }\n #menceyghdq .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }\n #menceyghdq .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; vertical-align: middle; }\n #menceyghdq .gt_from_md> :first-child { margin-top: 0; }\n #menceyghdq .gt_from_md> :last-child { margin-bottom: 0; }\n #menceyghdq .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D5D5D5; border-left-style: solid; border-left-width: 1px; border-left-color: #D5D5D5; border-right-style: solid; border-right-width: 1px; border-right-color: #D5D5D5; vertical-align: middle; overflow-x: hidden; }\n #menceyghdq .gt_stub { color: #333333; background-color: #929292; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D5D5D5; padding-left: 5px; padding-right: 5px; }\n #menceyghdq .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }\n #menceyghdq .gt_row_group_first td { border-top-width: 2px; }\n #menceyghdq .gt_row_group_first th { border-top-width: 2px; }\n #menceyghdq .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; }\n #menceyghdq .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }\n #menceyghdq .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }\n #menceyghdq .gt_left { text-align: left; }\n #menceyghdq .gt_center { text-align: center; }\n #menceyghdq .gt_right { text-align: right; font-variant-numeric: tabular-nums; }\n #menceyghdq .gt_font_normal { font-weight: normal; }\n #menceyghdq .gt_font_bold { font-weight: bold; }\n #menceyghdq .gt_font_italic { font-style: italic; }\n #menceyghdq .gt_super { font-size: 65%; }\n #menceyghdq .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }\n #menceyghdq .gt_asterisk { font-size: 100%; vertical-align: 0; }\n \n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n<thead class=\"gt_header\">\n  <tr>\n    <th colspan=\"5\" class=\"gt_heading gt_title gt_font_normal\"><strong>New client tier share</strong></th>\n  </tr>\n</thead>\n<tr class=\"gt_col_headings\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Tier\">Tier</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"# of Accounts\"># of Accounts</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"% Accounts\">% Accounts</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"($M) Revenue\">($M) Revenue</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"% Revenue\">% Revenue</th>\n</tr>\n<tbody class=\"gt_table_body\">\n  <tr>\n    <td class=\"gt_row gt_left\">A</td>\n    <td class=\"gt_row gt_right\">77</td>\n    <td style=\"background-color: #579d9d;\" class=\"gt_row gt_right\">7%</td>\n    <td class=\"gt_row gt_right\">$4.7</td>\n    <td style=\"background-color: #578692;\" class=\"gt_row gt_right\">25%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">A+</td>\n    <td class=\"gt_row gt_right\">19</td>\n    <td style=\"background-color: #57a4a0;\" class=\"gt_row gt_right\">2%</td>\n    <td class=\"gt_row gt_right\">$3.9</td>\n    <td style=\"background-color: #578b94;\" class=\"gt_row gt_right\">21%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">B</td>\n    <td class=\"gt_row gt_right\">338</td>\n    <td style=\"background-color: #577e8e;\" class=\"gt_row gt_right\">31%</td>\n    <td class=\"gt_row gt_right\">$6.0</td>\n    <td style=\"background-color: #577d8e;\" class=\"gt_row gt_right\">32%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">C</td>\n    <td class=\"gt_row gt_right\">425</td>\n    <td style=\"background-color: #517386;\" class=\"gt_row gt_right\">39%</td>\n    <td class=\"gt_row gt_right\">$2.8</td>\n    <td style=\"background-color: #579398;\" class=\"gt_row gt_right\">15%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">D</td>\n    <td class=\"gt_row gt_right\">24</td>\n    <td style=\"background-color: #57a3a0;\" class=\"gt_row gt_right\">2%</td>\n    <td class=\"gt_row gt_right\">$0.4</td>\n    <td style=\"background-color: #57a3a0;\" class=\"gt_row gt_right\">2%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_left\">All other</td>\n    <td class=\"gt_row gt_right\">205</td>\n    <td style=\"background-color: #578e96;\" class=\"gt_row gt_right\">19%</td>\n    <td class=\"gt_row gt_right\">$0.9</td>\n    <td style=\"background-color: #57a09e;\" class=\"gt_row gt_right\">5%</td>\n  </tr>\n  <tr>\n    <td style=\"background-color: #EEEEEE; border-top: 2px solid grey;border-bottom: 2px solid grey; font-style: bolder;\" class=\"gt_row gt_left\">Grand Total</td>\n    <td style=\"background-color: #EEEEEE; border-top: 2px solid grey;border-bottom: 2px solid grey; font-style: bolder;\" class=\"gt_row gt_right\">1,088</td>\n    <td style=\"background-color: #240750; background-color: #EEEEEE; border-top: 2px solid grey;border-bottom: 2px solid grey; font-style: bolder;\" class=\"gt_row gt_right\">100%</td>\n    <td style=\"background-color: #EEEEEE; border-top: 2px solid grey;border-bottom: 2px solid grey; font-style: bolder;\" class=\"gt_row gt_right\">$18.7</td>\n    <td style=\"background-color: #240750; background-color: #EEEEEE; border-top: 2px solid grey;border-bottom: 2px solid grey; font-style: bolder;\" class=\"gt_row gt_right\">100%</td>\n  </tr>\n</tbody>\n  <tfoot class=\"gt_sourcenotes\">\n  \n  <tr>\n    <td class=\"gt_sourcenote\" colspan=\"5\">Figure 2.1c: Table with heatmapping</td>\n  </tr>\n\n</tfoot>\n\n</table>\n\n</div>\n        \n```\n:::\n:::\n\n\n# References\n1. <https://www.storytellingwithdata.com/books>\n2. <https://rpubs.com/chidungkt/1139405>\n3. <https://posit-dev.github.io/great-tables/articles/intro.html>\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}