<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tuan Le Khac">
<meta name="dcterms.date" content="2024-05-22">
<meta name="description" content="I am a Risk Modeler 🚀">

<title>Le Khac Tuan - Storytelling with Data: Let’s Practice, Improve this table!</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../img/rocket_1613268.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="html/styles.scss">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Le Khac Tuan</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about/index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../curriculum/index.html"> 
<span class="menu-text">Curriculum</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../学汉语的日记.html"> 
<span class="menu-text">学汉语的日记</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../jiu_jitsu_journal/index.html"> 
<span class="menu-text">Jiu Jitsu Journal</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/lktuan"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/tuanlekhac/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.facebook.com/toilatuan.lk/"> <i class="bi bi-facebook" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:tuan.lekhac0905@gmail.com"> <i class="bi bi-envelope" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Storytelling with Data: Let’s Practice, Improve this table!</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                  <div>
        <div class="description">
          Practicing to improve a cross-tab report table using Python
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">python</div>
                <div class="quarto-category">visualization</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://lktuan.github.io/">Tuan Le Khac</a> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 22, 2024</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">May 23, 2024</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#motivation" id="toc-motivation" class="nav-link active" data-scroll-target="#motivation">1. Motivation</a></li>
  <li><a href="#lets-practice" id="toc-lets-practice" class="nav-link" data-scroll-target="#lets-practice">2. Let’s Practice</a>
  <ul class="collapse">
  <li><a href="#import-the-data" id="toc-import-the-data" class="nav-link" data-scroll-target="#import-the-data">2.1. Import the data</a></li>
  <li><a href="#data-manipulation" id="toc-data-manipulation" class="nav-link" data-scroll-target="#data-manipulation">2.2. Data manipulation</a></li>
  <li><a href="#visualization" id="toc-visualization" class="nav-link" data-scroll-target="#visualization">2.3. Visualization</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="motivation" class="level1">
<h1>1. Motivation</h1>
<p>Lấy cảm hứng từ bài <a href="https://rpubs.com/chidungkt/1139405">post</a> của thầy Nguyễn Chí Dũng về việc giải các exercise thuộc Chương 2 cuốn sách <strong>Storytelling with Data: Let’s Practice</strong> của tác giả <a href="https://www.linkedin.com/in/colenussbaumer/">Cole Nussbaumer Knaflic</a> sử dụng R, mình muốn cải thiện 1 bảng biểu nhưng sử dụng Python (trong cuốn sách gốc, tác giả sử dụng Excel để makeover các graph).</p>
<p>Đây là một cuốn sách hay về chủ để visualization, dành cho những người sử dụng biểu đồ nhiều để communicate trong công việc. Cụm từ “storytelling” đang được sử dụng rất nhiều, thậm chí như là một buzzword, một keyword cần có trong CV của mỗi người làm data. Đối với mình, “storytelling” chỉ nên được sử dụng khi bạn đã có sẵn các kết quả phân tích, được thực hiện một cách khoa học, và bạn muốn truyền tải nó tới business unit/management một cách hiệu quả. “Storytelling” nên không bao giờ là động cơ để bạn thực hiện một phân tích (thứ thay vào đó nên là một <strong>câu hỏi</strong>), thiên kiến sẽ ảnh hưởng tới phương pháp thực hiện, và rất dễ nảy sinh ngụy biện khi kết luận. Hãy xem bài viết này của <a href="https://www.linkedin.com/pulse/data-professionals-beware-storytelling-keith-mcnulty/">Keith McNulty</a> và <a href="https://www.linkedin.com/posts/keith-mcnulty_my-most-hated-word-in-data-science-activity-7017097392759918592-2Atc/">discussion</a> trên Linked In.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="1">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="swd_chap5.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Photo credit to <a href="https://www.storytellingwithdata.com/blog/2019/8/27/lets-practice">swd</a></figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="lets-practice" class="level1">
<h1>2. Let’s Practice</h1>
<p>Mình đang học <code>{ggplot2}</code> trên R để thực hành hình ảnh hóa dữ liệu, tuy nhiên có vẻ package này (và tương ứng là <code>plotnine</code> trên Python không phù hợp cho báo cáo bảng). Trong bài post, thầy Dũng cũng sử dụng một library khác là <code>kableExtra</code> (tham khảo <a href="https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html">đây</a>).</p>
<p>Sau một lúc google thì có vẻ có một package của Python phù hợp để làm nhiệm vụ này, đó là <code>great_tables</code> (tham khảo <a href="https://posit-dev.github.io/great-tables/articles/intro.html">đây</a>). Package này cũng được khuyến khích sử dụng cho mục đích communication bởi <a href="https://www.emilyriederer.com/post/py-rgo/#the-stack">Emily Riederer</a>.</p>
<section id="import-the-data" class="level2">
<h2 class="anchored" data-anchor-id="import-the-data">2.1. Import the data</h2>
<p>Okay đầu tiên cần import và làm sạch dữ liệu. Bảng có sẵn trong file Exercise có vẻ dùng để báo cáo hơn là lưu trữ dữ liệu.</p>
<div id="b79e1fa5" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a>data <span class="op">=</span> pd.read_excel(</span>
<span id="cb1-4"><a href="#cb1-4"></a>  <span class="st">"2.1 EXERCISE.xlsx"</span>,</span>
<span id="cb1-5"><a href="#cb1-5"></a>  sheet_name <span class="op">=</span> <span class="st">"EXERCISE 2.1"</span>,</span>
<span id="cb1-6"><a href="#cb1-6"></a>  skiprows<span class="op">=</span><span class="dv">6</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>)</span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a>data <span class="op">=</span> data.drop(<span class="st">'Unnamed: 0'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-10"><a href="#cb1-10"></a>data <span class="op">=</span> data.rename(columns<span class="op">=</span>{ <span class="st">"Tier"</span>: <span class="st">"tier"</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>                    ,<span class="st">"# of Accounts"</span>: <span class="st">"no_of_account"</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>                    ,<span class="st">"% Accounts"</span>: <span class="st">"pct_of_account"</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>                    ,<span class="st">"Revenue ($M)"</span>: <span class="st">"revenue"</span></span>
<span id="cb1-14"><a href="#cb1-14"></a>                    ,<span class="st">"% Revenue"</span>: <span class="st">"pct_of_revenue"</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-manipulation" class="level2">
<h2 class="anchored" data-anchor-id="data-manipulation">2.2. Data manipulation</h2>
<p>Yep giờ ta đã có 1 bảng data khá sạch, tuy nhiên lưu ý là bảng đang không thể hiện toàn bộ dữ liệu (total của <code>pct_of_account</code> chỉ là <code>81.86%</code>). Ta cần tính toán thêm <code>All other</code> và <code>Grand Total</code> (lý do là mình chưa tìm thấy function hiển thị Grand Total với package đang sử dụng, ngay cả trong ví dụ <a href="https://posit-dev.github.io/great-tables/blog/pycon-2024-great-tables-are-possible/">này</a>, GT cũng sử dụng data đã có sẵn Grand Total).</p>
<div id="c1028c82" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a>all_other_pct_of_account <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> data[<span class="st">"pct_of_account"</span>].<span class="bu">sum</span>()</span>
<span id="cb2-2"><a href="#cb2-2"></a>all_other_no_of_account <span class="op">=</span> <span class="bu">round</span>(all_other_pct_of_account <span class="op">/</span> data[<span class="st">"pct_of_account"</span>][<span class="dv">0</span>] <span class="op">*</span> data[<span class="st">"no_of_account"</span>][<span class="dv">0</span>],<span class="dv">0</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a>all_other_pct_of_revenue <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> data[<span class="st">"pct_of_revenue"</span>].<span class="bu">sum</span>()</span>
<span id="cb2-5"><a href="#cb2-5"></a>all_other_revenue <span class="op">=</span> <span class="bu">round</span>(all_other_pct_of_revenue <span class="op">/</span> data[<span class="st">"pct_of_revenue"</span>][<span class="dv">0</span>] <span class="op">*</span> data[<span class="st">"revenue"</span>][<span class="dv">0</span>],<span class="dv">3</span>)</span>
<span id="cb2-6"><a href="#cb2-6"></a></span>
<span id="cb2-7"><a href="#cb2-7"></a>all_other <span class="op">=</span> pd.Series({ <span class="st">"tier"</span>: <span class="st">"All other"</span>,</span>
<span id="cb2-8"><a href="#cb2-8"></a>                        <span class="st">"no_of_account"</span>: all_other_no_of_account,</span>
<span id="cb2-9"><a href="#cb2-9"></a>                        <span class="st">"pct_of_account"</span>: all_other_pct_of_account,</span>
<span id="cb2-10"><a href="#cb2-10"></a>                        <span class="st">"revenue"</span>:all_other_revenue,</span>
<span id="cb2-11"><a href="#cb2-11"></a>                        <span class="st">"pct_of_revenue"</span>: all_other_pct_of_revenue})</span>
<span id="cb2-12"><a href="#cb2-12"></a></span>
<span id="cb2-13"><a href="#cb2-13"></a>data <span class="op">=</span> pd.concat([data, all_other.to_frame().T], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-14"><a href="#cb2-14"></a></span>
<span id="cb2-15"><a href="#cb2-15"></a>data.loc[<span class="bu">len</span>(data.index)] <span class="op">=</span> data.<span class="bu">sum</span>()</span>
<span id="cb2-16"><a href="#cb2-16"></a>data.loc[data.index[<span class="op">-</span><span class="dv">1</span>], <span class="st">'tier'</span>] <span class="op">=</span> <span class="st">'Grand Total'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Show the data:</p>
<div id="356d58f1" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="im">from</span> great_tables <span class="im">import</span> GT</span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a>( </span>
<span id="cb3-4"><a href="#cb3-4"></a>  GT(data)</span>
<span id="cb3-5"><a href="#cb3-5"></a>  .fmt_number(columns<span class="op">=</span> [<span class="st">"no_of_account"</span>,<span class="st">"pct_of_account"</span>,<span class="st">"revenue"</span>,<span class="st">"pct_of_revenue"</span>],decimals<span class="op">=</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>
<div id="wzhhmppaoe" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#wzhhmppaoe table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#wzhhmppaoe thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#wzhhmppaoe p { margin: 0; padding: 0; }
 #wzhhmppaoe .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #wzhhmppaoe .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #wzhhmppaoe .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #wzhhmppaoe .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #wzhhmppaoe .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #wzhhmppaoe .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #wzhhmppaoe .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #wzhhmppaoe .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #wzhhmppaoe .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #wzhhmppaoe .gt_column_spanner_outer:first-child { padding-left: 0; }
 #wzhhmppaoe .gt_column_spanner_outer:last-child { padding-right: 0; }
 #wzhhmppaoe .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #wzhhmppaoe .gt_spanner_row { border-bottom-style: hidden; }
 #wzhhmppaoe .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #wzhhmppaoe .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }
 #wzhhmppaoe .gt_from_md> :first-child { margin-top: 0; }
 #wzhhmppaoe .gt_from_md> :last-child { margin-bottom: 0; }
 #wzhhmppaoe .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }
 #wzhhmppaoe .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }
 #wzhhmppaoe .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #wzhhmppaoe .gt_row_group_first td { border-top-width: 2px; }
 #wzhhmppaoe .gt_row_group_first th { border-top-width: 2px; }
 #wzhhmppaoe .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #wzhhmppaoe .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #wzhhmppaoe .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #wzhhmppaoe .gt_left { text-align: left; }
 #wzhhmppaoe .gt_center { text-align: center; }
 #wzhhmppaoe .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #wzhhmppaoe .gt_font_normal { font-weight: normal; }
 #wzhhmppaoe .gt_font_bold { font-weight: bold; }
 #wzhhmppaoe .gt_font_italic { font-style: italic; }
 #wzhhmppaoe .gt_super { font-size: 65%; }
 #wzhhmppaoe .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #wzhhmppaoe .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<tbody>
<tr class="odd gt_col_headings">
<td id="tier" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">tier</td>
<td id="no_of_account" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">no_of_account</td>
<td id="pct_of_account" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">pct_of_account</td>
<td id="revenue" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">revenue</td>
<td id="pct_of_revenue" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">pct_of_revenue</td>
</tr>
</tbody>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left">A</td>
<td class="gt_row gt_right">77.00</td>
<td class="gt_row gt_right">0.07</td>
<td class="gt_row gt_right">4.67</td>
<td class="gt_row gt_right">0.25</td>
</tr>
<tr class="even">
<td class="gt_row gt_left">A+</td>
<td class="gt_row gt_right">19.00</td>
<td class="gt_row gt_right">0.02</td>
<td class="gt_row gt_right">3.93</td>
<td class="gt_row gt_right">0.21</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left">B</td>
<td class="gt_row gt_right">338.00</td>
<td class="gt_row gt_right">0.31</td>
<td class="gt_row gt_right">5.98</td>
<td class="gt_row gt_right">0.32</td>
</tr>
<tr class="even">
<td class="gt_row gt_left">C</td>
<td class="gt_row gt_right">425.00</td>
<td class="gt_row gt_right">0.39</td>
<td class="gt_row gt_right">2.80</td>
<td class="gt_row gt_right">0.15</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left">D</td>
<td class="gt_row gt_right">24.00</td>
<td class="gt_row gt_right">0.02</td>
<td class="gt_row gt_right">0.37</td>
<td class="gt_row gt_right">0.02</td>
</tr>
<tr class="even">
<td class="gt_row gt_left">All other</td>
<td class="gt_row gt_right">205.00</td>
<td class="gt_row gt_right">0.19</td>
<td class="gt_row gt_right">0.94</td>
<td class="gt_row gt_right">0.05</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left">Grand Total</td>
<td class="gt_row gt_right">1,088.00</td>
<td class="gt_row gt_right">1.00</td>
<td class="gt_row gt_right">18.70</td>
<td class="gt_row gt_right">1.00</td>
</tr>
</tbody>
</table>


</div>
        
</div>
</div>
</div>
</section>
<section id="visualization" class="level2">
<h2 class="anchored" data-anchor-id="visualization">2.3. Visualization</h2>
<p>Được rồi, giờ ta có thể dùng <code>great_tables</code> để tiến hành visualize. Về cơ bản, chỉ cần khởi tạo một object <code>GT()</code> có thể mở rộng được, các element/hoặc format được định nghĩa về sau.</p>
<p>Dưới đây chúng ta trình bày một bảng đơn giản với tiêu đề, tên cột, cũng như định dạng lại dữ liệu.</p>
<div id="407bc4b5" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a>(</span>
<span id="cb4-2"><a href="#cb4-2"></a>  GT(data)</span>
<span id="cb4-3"><a href="#cb4-3"></a>  .tab_header(title<span class="op">=</span><span class="st">"New client tier share"</span>)</span>
<span id="cb4-4"><a href="#cb4-4"></a>  .cols_label(</span>
<span id="cb4-5"><a href="#cb4-5"></a>    tier <span class="op">=</span> <span class="st">"Tier"</span>,</span>
<span id="cb4-6"><a href="#cb4-6"></a>    no_of_account <span class="op">=</span> <span class="st">"# of Accounts"</span>,</span>
<span id="cb4-7"><a href="#cb4-7"></a>    pct_of_account <span class="op">=</span> <span class="st">"% Accounts"</span>,</span>
<span id="cb4-8"><a href="#cb4-8"></a>    revenue <span class="op">=</span> <span class="st">"Revenue ($M)"</span>,</span>
<span id="cb4-9"><a href="#cb4-9"></a>    pct_of_revenue <span class="op">=</span> <span class="st">"% Revenue"</span></span>
<span id="cb4-10"><a href="#cb4-10"></a>  )</span>
<span id="cb4-11"><a href="#cb4-11"></a>  .fmt_number(columns<span class="op">=</span><span class="st">"no_of_account"</span>,decimals<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-12"><a href="#cb4-12"></a>  .fmt_percent(columns<span class="op">=</span>[<span class="st">"pct_of_account"</span>, <span class="st">"pct_of_revenue"</span>], decimals<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb4-13"><a href="#cb4-13"></a>  .fmt_currency(columns <span class="op">=</span> <span class="st">"revenue"</span>, currency<span class="op">=</span><span class="st">"USD"</span>, decimals<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb4-14"><a href="#cb4-14"></a>  .tab_source_note(source_note<span class="op">=</span><span class="st">"Figure 2.1b: Slightly improved table"</span>)</span>
<span id="cb4-15"><a href="#cb4-15"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>
<div id="nydweqdnwn" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#nydweqdnwn table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#nydweqdnwn thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#nydweqdnwn p { margin: 0; padding: 0; }
 #nydweqdnwn .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #nydweqdnwn .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #nydweqdnwn .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #nydweqdnwn .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #nydweqdnwn .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #nydweqdnwn .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #nydweqdnwn .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #nydweqdnwn .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #nydweqdnwn .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #nydweqdnwn .gt_column_spanner_outer:first-child { padding-left: 0; }
 #nydweqdnwn .gt_column_spanner_outer:last-child { padding-right: 0; }
 #nydweqdnwn .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #nydweqdnwn .gt_spanner_row { border-bottom-style: hidden; }
 #nydweqdnwn .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #nydweqdnwn .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }
 #nydweqdnwn .gt_from_md> :first-child { margin-top: 0; }
 #nydweqdnwn .gt_from_md> :last-child { margin-bottom: 0; }
 #nydweqdnwn .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }
 #nydweqdnwn .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }
 #nydweqdnwn .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #nydweqdnwn .gt_row_group_first td { border-top-width: 2px; }
 #nydweqdnwn .gt_row_group_first th { border-top-width: 2px; }
 #nydweqdnwn .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #nydweqdnwn .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #nydweqdnwn .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #nydweqdnwn .gt_left { text-align: left; }
 #nydweqdnwn .gt_center { text-align: center; }
 #nydweqdnwn .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #nydweqdnwn .gt_font_normal { font-weight: normal; }
 #nydweqdnwn .gt_font_bold { font-weight: bold; }
 #nydweqdnwn .gt_font_italic { font-style: italic; }
 #nydweqdnwn .gt_super { font-size: 65%; }
 #nydweqdnwn .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #nydweqdnwn .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead class="gt_header">
<tr class="header">
<th colspan="5" class="gt_heading gt_title gt_font_normal" data-quarto-table-cell-role="th">New client tier share</th>
</tr>
</thead>
<tbody>
<tr class="odd gt_col_headings">
<td id="Tier" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Tier</td>
<td id="# of Accounts" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col"># of Accounts</td>
<td id="% Accounts" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">% Accounts</td>
<td id="Revenue ($M)" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Revenue ($M)</td>
<td id="% Revenue" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">% Revenue</td>
</tr>
</tbody>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left">A</td>
<td class="gt_row gt_right">77</td>
<td class="gt_row gt_right">7.08%</td>
<td class="gt_row gt_right">$4.67</td>
<td class="gt_row gt_right">25.00%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left">A+</td>
<td class="gt_row gt_right">19</td>
<td class="gt_row gt_right">1.75%</td>
<td class="gt_row gt_right">$3.93</td>
<td class="gt_row gt_right">21.00%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left">B</td>
<td class="gt_row gt_right">338</td>
<td class="gt_row gt_right">31.07%</td>
<td class="gt_row gt_right">$5.98</td>
<td class="gt_row gt_right">32.00%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left">C</td>
<td class="gt_row gt_right">425</td>
<td class="gt_row gt_right">39.06%</td>
<td class="gt_row gt_right">$2.80</td>
<td class="gt_row gt_right">15.00%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left">D</td>
<td class="gt_row gt_right">24</td>
<td class="gt_row gt_right">2.21%</td>
<td class="gt_row gt_right">$0.37</td>
<td class="gt_row gt_right">2.00%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left">All other</td>
<td class="gt_row gt_right">205</td>
<td class="gt_row gt_right">18.84%</td>
<td class="gt_row gt_right">$0.94</td>
<td class="gt_row gt_right">5.00%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left">Grand Total</td>
<td class="gt_row gt_right">1,088</td>
<td class="gt_row gt_right">100.00%</td>
<td class="gt_row gt_right">$18.70</td>
<td class="gt_row gt_right">100.00%</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="odd">
<td colspan="5" class="gt_sourcenote">Figure 2.1b: Slightly improved table</td>
</tr>
</tfoot>

</table>


</div>
        
</div>
</div>
</div>
<p>Trông ổn (ít nhất là trình bày số liệu một cách toàn vẹn) so với bản gốc rồi!</p>
<p>Tiếp tục, ta dùng - helper <code>md()</code> để định dạng lại tiêu đề; - sử dụng <code>.data_color()</code> để tạo heatmapping; - sử dụng <code>tab_style()</code> để format dòng Grand Total; - sử dụng <code>.opt_stylize()</code> để theming.</p>
<div id="c94eb4d7" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="im">from</span> great_tables <span class="im">import</span> md, style, loc</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a>(</span>
<span id="cb5-4"><a href="#cb5-4"></a>  GT(data)</span>
<span id="cb5-5"><a href="#cb5-5"></a>  .tab_header(title<span class="op">=</span>md(<span class="st">"&lt;strong&gt;New client tier share&lt;/strong&gt;"</span>))</span>
<span id="cb5-6"><a href="#cb5-6"></a>  .opt_align_table_header(align<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb5-7"><a href="#cb5-7"></a>  .cols_label(</span>
<span id="cb5-8"><a href="#cb5-8"></a>    tier <span class="op">=</span> <span class="st">"Tier"</span>,</span>
<span id="cb5-9"><a href="#cb5-9"></a>    no_of_account <span class="op">=</span> <span class="st">"# of Accounts"</span>,</span>
<span id="cb5-10"><a href="#cb5-10"></a>    pct_of_account <span class="op">=</span> <span class="st">"% Accounts"</span>,</span>
<span id="cb5-11"><a href="#cb5-11"></a>    revenue <span class="op">=</span> <span class="st">"($M) Revenue"</span>, <span class="co"># change the label</span></span>
<span id="cb5-12"><a href="#cb5-12"></a>    pct_of_revenue <span class="op">=</span> <span class="st">"% Revenue"</span></span>
<span id="cb5-13"><a href="#cb5-13"></a>  )</span>
<span id="cb5-14"><a href="#cb5-14"></a>  .fmt_number(columns<span class="op">=</span><span class="st">"no_of_account"</span>,decimals<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb5-15"><a href="#cb5-15"></a>  .fmt_percent(columns<span class="op">=</span>[<span class="st">"pct_of_account"</span>, <span class="st">"pct_of_revenue"</span>], decimals<span class="op">=</span><span class="dv">0</span>) <span class="co"># changed decimals</span></span>
<span id="cb5-16"><a href="#cb5-16"></a>  .fmt_currency(columns <span class="op">=</span> <span class="st">"revenue"</span>, currency<span class="op">=</span><span class="st">"USD"</span>, decimals<span class="op">=</span><span class="dv">1</span>)<span class="co"># changed decimals</span></span>
<span id="cb5-17"><a href="#cb5-17"></a>  .tab_source_note(source_note<span class="op">=</span><span class="st">"Figure 2.1c: Table with heatmapping"</span>)</span>
<span id="cb5-18"><a href="#cb5-18"></a>  .data_color(</span>
<span id="cb5-19"><a href="#cb5-19"></a>    columns<span class="op">=</span>[<span class="st">"pct_of_account"</span>, <span class="st">"pct_of_revenue"</span>],</span>
<span id="cb5-20"><a href="#cb5-20"></a>    palette<span class="op">=</span>[<span class="st">"#57A6A1"</span>, <span class="st">"#577B8D"</span>, <span class="st">"#344C64"</span>, <span class="st">"#240750"</span>],</span>
<span id="cb5-21"><a href="#cb5-21"></a>    domain<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>],</span>
<span id="cb5-22"><a href="#cb5-22"></a>    na_color<span class="op">=</span><span class="st">"lightgray"</span>,</span>
<span id="cb5-23"><a href="#cb5-23"></a>    autocolor_text <span class="op">=</span> <span class="va">False</span></span>
<span id="cb5-24"><a href="#cb5-24"></a>  )</span>
<span id="cb5-25"><a href="#cb5-25"></a>  .tab_style(</span>
<span id="cb5-26"><a href="#cb5-26"></a>        style<span class="op">=</span>[</span>
<span id="cb5-27"><a href="#cb5-27"></a>          style.text(style<span class="op">=</span><span class="st">"bolder"</span>),</span>
<span id="cb5-28"><a href="#cb5-28"></a>          style.fill(<span class="st">"#EEEEEE"</span>),</span>
<span id="cb5-29"><a href="#cb5-29"></a>          style.borders(sides<span class="op">=</span>[<span class="st">"top"</span>, <span class="st">"bottom"</span>], weight<span class="op">=</span><span class="st">'2px'</span>, color<span class="op">=</span><span class="st">"grey"</span>)</span>
<span id="cb5-30"><a href="#cb5-30"></a>          ],</span>
<span id="cb5-31"><a href="#cb5-31"></a>        locations<span class="op">=</span>loc.body(rows<span class="op">=</span>[<span class="dv">6</span>])</span>
<span id="cb5-32"><a href="#cb5-32"></a>  )</span>
<span id="cb5-33"><a href="#cb5-33"></a>  .opt_stylize(style<span class="op">=</span><span class="dv">5</span> ,color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb5-34"><a href="#cb5-34"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>
<div id="lulpitlmjm" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#lulpitlmjm table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#lulpitlmjm thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#lulpitlmjm p { margin: 0; padding: 0; }
 #lulpitlmjm .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #lulpitlmjm .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #lulpitlmjm .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #lulpitlmjm .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #lulpitlmjm .gt_heading { background-color: #FFFFFF; text-align: left; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #lulpitlmjm .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; }
 #lulpitlmjm .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #lulpitlmjm .gt_col_heading { color: #FFFFFF; background-color: #004D80; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #lulpitlmjm .gt_column_spanner_outer { color: #FFFFFF; background-color: #004D80; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #lulpitlmjm .gt_column_spanner_outer:first-child { padding-left: 0; }
 #lulpitlmjm .gt_column_spanner_outer:last-child { padding-right: 0; }
 #lulpitlmjm .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #lulpitlmjm .gt_spanner_row { border-bottom-style: hidden; }
 #lulpitlmjm .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #lulpitlmjm .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; vertical-align: middle; }
 #lulpitlmjm .gt_from_md> :first-child { margin-top: 0; }
 #lulpitlmjm .gt_from_md> :last-child { margin-bottom: 0; }
 #lulpitlmjm .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D5D5D5; border-left-style: solid; border-left-width: 1px; border-left-color: #D5D5D5; border-right-style: solid; border-right-width: 1px; border-right-color: #D5D5D5; vertical-align: middle; overflow-x: hidden; }
 #lulpitlmjm .gt_stub { color: #333333; background-color: #929292; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D5D5D5; padding-left: 5px; padding-right: 5px; }
 #lulpitlmjm .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #lulpitlmjm .gt_row_group_first td { border-top-width: 2px; }
 #lulpitlmjm .gt_row_group_first th { border-top-width: 2px; }
 #lulpitlmjm .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; }
 #lulpitlmjm .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #lulpitlmjm .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #lulpitlmjm .gt_left { text-align: left; }
 #lulpitlmjm .gt_center { text-align: center; }
 #lulpitlmjm .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #lulpitlmjm .gt_font_normal { font-weight: normal; }
 #lulpitlmjm .gt_font_bold { font-weight: bold; }
 #lulpitlmjm .gt_font_italic { font-style: italic; }
 #lulpitlmjm .gt_super { font-size: 65%; }
 #lulpitlmjm .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #lulpitlmjm .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead class="gt_header">
<tr class="header">
<th colspan="5" class="gt_heading gt_title gt_font_normal" data-quarto-table-cell-role="th"><strong>New client tier share</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd gt_col_headings">
<td id="Tier" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Tier</td>
<td id="# of Accounts" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col"># of Accounts</td>
<td id="% Accounts" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">% Accounts</td>
<td id="($M) Revenue" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">($M) Revenue</td>
<td id="% Revenue" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">% Revenue</td>
</tr>
</tbody>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left">A</td>
<td class="gt_row gt_right">77</td>
<td class="gt_row gt_right" style="background-color: #579d9d">7%</td>
<td class="gt_row gt_right">$4.7</td>
<td class="gt_row gt_right" style="background-color: #578692">25%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left">A+</td>
<td class="gt_row gt_right">19</td>
<td class="gt_row gt_right" style="background-color: #57a4a0">2%</td>
<td class="gt_row gt_right">$3.9</td>
<td class="gt_row gt_right" style="background-color: #578b94">21%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left">B</td>
<td class="gt_row gt_right">338</td>
<td class="gt_row gt_right" style="background-color: #577e8e">31%</td>
<td class="gt_row gt_right">$6.0</td>
<td class="gt_row gt_right" style="background-color: #577d8e">32%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left">C</td>
<td class="gt_row gt_right">425</td>
<td class="gt_row gt_right" style="background-color: #517386">39%</td>
<td class="gt_row gt_right">$2.8</td>
<td class="gt_row gt_right" style="background-color: #579398">15%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left">D</td>
<td class="gt_row gt_right">24</td>
<td class="gt_row gt_right" style="background-color: #57a3a0">2%</td>
<td class="gt_row gt_right">$0.4</td>
<td class="gt_row gt_right" style="background-color: #57a3a0">2%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left">All other</td>
<td class="gt_row gt_right">205</td>
<td class="gt_row gt_right" style="background-color: #578e96">19%</td>
<td class="gt_row gt_right">$0.9</td>
<td class="gt_row gt_right" style="background-color: #57a09e">5%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" style="font-style: bolder; background-color: #EEEEEE; border-top: 2px solid grey; border-bottom: 2px solid grey">Grand Total</td>
<td class="gt_row gt_right" style="font-style: bolder; background-color: #EEEEEE; border-top: 2px solid grey; border-bottom: 2px solid grey">1,088</td>
<td class="gt_row gt_right" style="background-color: #240750; font-style: bolder; background-color: #EEEEEE; border-top: 2px solid grey; border-bottom: 2px solid grey">100%</td>
<td class="gt_row gt_right" style="font-style: bolder; background-color: #EEEEEE; border-top: 2px solid grey; border-bottom: 2px solid grey">$18.7</td>
<td class="gt_row gt_right" style="background-color: #240750; font-style: bolder; background-color: #EEEEEE; border-top: 2px solid grey; border-bottom: 2px solid grey">100%</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="odd">
<td colspan="5" class="gt_sourcenote">Figure 2.1c: Table with heatmapping</td>
</tr>
</tfoot>

</table>


</div>
        
</div>
</div>
</div>
<p>Tiếp theo, chúng ta sẽ thử dùng <code>fmt_nanoplot()</code> để tạo một bar plots thay cho hai cột percentage.</p>
<p>Đây là một tính năng trong giai đoạn thử nghiệm nên mình thấy chưa thực sử ổn định và tuân theo document mà nhà phát triển đề cập. Trong ví dụ dưới đây mình sử dụng data bar, loại bỏ format do hàng cuối cùng. Tuy nhiên, đồ thị vẫn include giá trị <code>100%</code> ở hàng Grand Total để điều chỉnh bar scale.</p>
<p>Thêm nữa mình cần chuyển dataframe về polar dataframe, khi đó một column của dl.df là iterable.</p>
<div id="cc6e4fc0" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="im">from</span> great_tables <span class="im">import</span> md, style, loc, nanoplot_options</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb6-4"><a href="#cb6-4"></a></span>
<span id="cb6-5"><a href="#cb6-5"></a>data.at[<span class="dv">6</span>, <span class="st">"pct_of_account"</span>] <span class="op">=</span> np.nan</span>
<span id="cb6-6"><a href="#cb6-6"></a>data.at[<span class="dv">6</span>, <span class="st">"pct_of_revenue"</span>] <span class="op">=</span> np.nan</span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co"># so that the data scale looks better</span></span>
<span id="cb6-8"><a href="#cb6-8"></a></span>
<span id="cb6-9"><a href="#cb6-9"></a>pl_data <span class="op">=</span> pl.from_pandas(data)</span>
<span id="cb6-10"><a href="#cb6-10"></a></span>
<span id="cb6-11"><a href="#cb6-11"></a>(</span>
<span id="cb6-12"><a href="#cb6-12"></a>  GT(pl_data, rowname_col<span class="op">=</span><span class="st">"tier"</span>)</span>
<span id="cb6-13"><a href="#cb6-13"></a>  .tab_header(title<span class="op">=</span>md(<span class="st">"&lt;strong&gt;New client tier share&lt;/strong&gt;"</span>))</span>
<span id="cb6-14"><a href="#cb6-14"></a>  .opt_align_table_header(align<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb6-15"><a href="#cb6-15"></a>  .tab_source_note(source_note<span class="op">=</span><span class="st">"Figure 2.1d: Table with data bar"</span>)</span>
<span id="cb6-16"><a href="#cb6-16"></a>  .cols_label(</span>
<span id="cb6-17"><a href="#cb6-17"></a>    tier <span class="op">=</span> <span class="st">"Tier"</span>,</span>
<span id="cb6-18"><a href="#cb6-18"></a>    no_of_account <span class="op">=</span> <span class="st">"# of Accounts"</span>,</span>
<span id="cb6-19"><a href="#cb6-19"></a>    pct_of_account <span class="op">=</span> <span class="st">"% Accounts"</span>,</span>
<span id="cb6-20"><a href="#cb6-20"></a>    revenue <span class="op">=</span> <span class="st">"($M) Revenue"</span>, <span class="co"># change the label</span></span>
<span id="cb6-21"><a href="#cb6-21"></a>    pct_of_revenue <span class="op">=</span> <span class="st">"% Revenue"</span></span>
<span id="cb6-22"><a href="#cb6-22"></a>  )</span>
<span id="cb6-23"><a href="#cb6-23"></a>  .fmt_number(columns<span class="op">=</span><span class="st">"no_of_account"</span>,decimals<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb6-24"><a href="#cb6-24"></a>  .fmt_currency(columns <span class="op">=</span> <span class="st">"revenue"</span>, currency<span class="op">=</span><span class="st">"USD"</span>, decimals<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb6-25"><a href="#cb6-25"></a>  .fmt_percent(columns<span class="op">=</span>[<span class="st">"pct_of_account"</span>, <span class="st">"pct_of_revenue"</span>], decimals<span class="op">=</span><span class="dv">0</span>) <span class="co"># changed decimals</span></span>
<span id="cb6-26"><a href="#cb6-26"></a>  .cols_width(</span>
<span id="cb6-27"><a href="#cb6-27"></a>    cases<span class="op">=</span>{</span>
<span id="cb6-28"><a href="#cb6-28"></a>        <span class="st">"tier"</span>: <span class="st">"20%"</span>,</span>
<span id="cb6-29"><a href="#cb6-29"></a>        <span class="st">"no_of_account"</span>: <span class="st">"20%"</span>,</span>
<span id="cb6-30"><a href="#cb6-30"></a>        <span class="st">"pct_of_account"</span>: <span class="st">"20%"</span>,</span>
<span id="cb6-31"><a href="#cb6-31"></a>        <span class="st">"revenue"</span>: <span class="st">"20%"</span>,</span>
<span id="cb6-32"><a href="#cb6-32"></a>        <span class="st">"pct_of_revenue"</span>: <span class="st">"20%"</span>      </span>
<span id="cb6-33"><a href="#cb6-33"></a>    }</span>
<span id="cb6-34"><a href="#cb6-34"></a>    )</span>
<span id="cb6-35"><a href="#cb6-35"></a>  .fmt_nanoplot(</span>
<span id="cb6-36"><a href="#cb6-36"></a>    columns<span class="op">=</span><span class="st">"pct_of_account"</span>,</span>
<span id="cb6-37"><a href="#cb6-37"></a>    rows <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>],</span>
<span id="cb6-38"><a href="#cb6-38"></a>    plot_type<span class="op">=</span><span class="st">"bar"</span>,</span>
<span id="cb6-39"><a href="#cb6-39"></a>    plot_height <span class="op">=</span> <span class="st">"3em"</span>,</span>
<span id="cb6-40"><a href="#cb6-40"></a>    autoscale<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb6-41"><a href="#cb6-41"></a>    options<span class="op">=</span>nanoplot_options(</span>
<span id="cb6-42"><a href="#cb6-42"></a>      data_bar_stroke_color<span class="op">=</span><span class="st">"#577B8D"</span>,</span>
<span id="cb6-43"><a href="#cb6-43"></a>      data_bar_stroke_width<span class="op">=</span><span class="dv">80</span>,</span>
<span id="cb6-44"><a href="#cb6-44"></a>      data_bar_fill_color<span class="op">=</span><span class="st">"#577B8D"</span>,)</span>
<span id="cb6-45"><a href="#cb6-45"></a>    )</span>
<span id="cb6-46"><a href="#cb6-46"></a>  .fmt_nanoplot(</span>
<span id="cb6-47"><a href="#cb6-47"></a>    columns<span class="op">=</span><span class="st">"pct_of_revenue"</span>,</span>
<span id="cb6-48"><a href="#cb6-48"></a>    rows <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>],</span>
<span id="cb6-49"><a href="#cb6-49"></a>    plot_type<span class="op">=</span><span class="st">"bar"</span>,</span>
<span id="cb6-50"><a href="#cb6-50"></a>    plot_height <span class="op">=</span> <span class="st">"3em"</span>,</span>
<span id="cb6-51"><a href="#cb6-51"></a>    autoscale<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb6-52"><a href="#cb6-52"></a>    options<span class="op">=</span>nanoplot_options(</span>
<span id="cb6-53"><a href="#cb6-53"></a>      data_bar_stroke_color<span class="op">=</span><span class="st">"#577B8D"</span>,</span>
<span id="cb6-54"><a href="#cb6-54"></a>      data_bar_stroke_width<span class="op">=</span><span class="dv">80</span>,</span>
<span id="cb6-55"><a href="#cb6-55"></a>      data_bar_fill_color<span class="op">=</span><span class="st">"#577B8D"</span>,)</span>
<span id="cb6-56"><a href="#cb6-56"></a>  )</span>
<span id="cb6-57"><a href="#cb6-57"></a>  .tab_style(</span>
<span id="cb6-58"><a href="#cb6-58"></a>        style<span class="op">=</span>[</span>
<span id="cb6-59"><a href="#cb6-59"></a>          style.text(style<span class="op">=</span><span class="st">"bolder"</span>),</span>
<span id="cb6-60"><a href="#cb6-60"></a>          style.fill(<span class="st">"#EEEEEE"</span>),</span>
<span id="cb6-61"><a href="#cb6-61"></a>          style.borders(sides<span class="op">=</span>[<span class="st">"top"</span>, <span class="st">"bottom"</span>], weight<span class="op">=</span><span class="st">'2px'</span>, color<span class="op">=</span><span class="st">"grey"</span>)</span>
<span id="cb6-62"><a href="#cb6-62"></a>          ],</span>
<span id="cb6-63"><a href="#cb6-63"></a>        locations<span class="op">=</span>loc.body(rows<span class="op">=</span>[<span class="dv">6</span>])</span>
<span id="cb6-64"><a href="#cb6-64"></a>  )</span>
<span id="cb6-65"><a href="#cb6-65"></a>  .tab_style(</span>
<span id="cb6-66"><a href="#cb6-66"></a>        style<span class="op">=</span>[</span>
<span id="cb6-67"><a href="#cb6-67"></a>          style.text(color<span class="op">=</span><span class="st">"#EEEEEE"</span>, size<span class="op">=</span><span class="fl">0.5</span>),</span>
<span id="cb6-68"><a href="#cb6-68"></a>          ],</span>
<span id="cb6-69"><a href="#cb6-69"></a>        locations<span class="op">=</span>loc.body(rows<span class="op">=</span>[<span class="dv">6</span>], columns<span class="op">=</span>[<span class="st">"pct_of_account"</span>, <span class="st">"pct_of_revenue"</span>])</span>
<span id="cb6-70"><a href="#cb6-70"></a>  )</span>
<span id="cb6-71"><a href="#cb6-71"></a>  .opt_stylize(style<span class="op">=</span><span class="dv">3</span> ,color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb6-72"><a href="#cb6-72"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>
<div id="ezjcjlzvab" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#ezjcjlzvab table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#ezjcjlzvab thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#ezjcjlzvab p { margin: 0; padding: 0; }
 #ezjcjlzvab .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #929292; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #929292; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #ezjcjlzvab .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #ezjcjlzvab .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #ezjcjlzvab .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #ezjcjlzvab .gt_heading { background-color: #FFFFFF; text-align: left; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #ezjcjlzvab .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #929292; }
 #ezjcjlzvab .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #929292; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #929292; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #ezjcjlzvab .gt_col_heading { color: #FFFFFF; background-color: #004D80; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #ezjcjlzvab .gt_column_spanner_outer { color: #FFFFFF; background-color: #004D80; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #ezjcjlzvab .gt_column_spanner_outer:first-child { padding-left: 0; }
 #ezjcjlzvab .gt_column_spanner_outer:last-child { padding-right: 0; }
 #ezjcjlzvab .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #929292; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #ezjcjlzvab .gt_spanner_row { border-bottom-style: hidden; }
 #ezjcjlzvab .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #929292; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #929292; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #ezjcjlzvab .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #929292; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #929292; vertical-align: middle; }
 #ezjcjlzvab .gt_from_md> :first-child { margin-top: 0; }
 #ezjcjlzvab .gt_from_md> :last-child { margin-bottom: 0; }
 #ezjcjlzvab .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: dashed; border-top-width: 1px; border-top-color: #929292; border-left-style: none; border-left-width: 1px; border-left-color: #929292; border-right-style: none; border-right-width: 1px; border-right-color: #929292; vertical-align: middle; overflow-x: hidden; }
 #ezjcjlzvab .gt_stub { color: #333333; background-color: #D5D5D5; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: none; border-right-width: 2px; border-right-color: #FFFFFF; padding-left: 5px; padding-right: 5px; }
 #ezjcjlzvab .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #ezjcjlzvab .gt_row_group_first td { border-top-width: 2px; }
 #ezjcjlzvab .gt_row_group_first th { border-top-width: 2px; }
 #ezjcjlzvab .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #929292; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #929292; }
 #ezjcjlzvab .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #ezjcjlzvab .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #ezjcjlzvab .gt_left { text-align: left; }
 #ezjcjlzvab .gt_center { text-align: center; }
 #ezjcjlzvab .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #ezjcjlzvab .gt_font_normal { font-weight: normal; }
 #ezjcjlzvab .gt_font_bold { font-weight: bold; }
 #ezjcjlzvab .gt_font_italic { font-style: italic; }
 #ezjcjlzvab .gt_super { font-size: 65%; }
 #ezjcjlzvab .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #ezjcjlzvab .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead class="gt_header">
<tr class="header">
<th colspan="5" class="gt_heading gt_title gt_font_normal" data-quarto-table-cell-role="th"><strong>New client tier share</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd gt_col_headings">
<td class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></td>
<td id="# of Accounts" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col"># of Accounts</td>
<td id="% Accounts" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">% Accounts</td>
<td id="($M) Revenue" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">($M) Revenue</td>
<td id="% Revenue" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">% Revenue</td>
</tr>
</tbody>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">A</td>
<td class="gt_row gt_right">77</td>
<td class="gt_row gt_right"><div>
<svg role="img" viewbox="0 0 600 130" style="height: 3em; margin-left: auto; margin-right: auto; font-size: inherit; overflow: visible; vertical-align: middle; position:relative;">
<defs><pattern id="area_pattern" width="8" height="8" patternunits="userSpaceOnUse"><path class="pattern-line" d="M 0,8 l 8,-8 M -1,1 l 4,-4 M 6,10 l 4,-4" stroke="#FF0000" stroke-width="1.5" stroke-linecap="round" shape-rendering="geometricPrecision"></path></pattern></defs>
<style> text { font-family: ui-monospace, 'Cascadia Code', 'Source Code Pro', Menlo, Consolas, 'DejaVu Sans Mono', monospace; stroke-width: 0.15em; paint-order: stroke; stroke-linejoin: round; cursor: default; } .vert-line:hover rect { fill: #911EB4; fill-opacity: 40%; stroke: #FFFFFF60; color: red; } .vert-line:hover text { stroke: white; fill: #212427; } .horizontal-line:hover text {stroke: white; fill: #212427; } .ref-line:hover rect { stroke: #FFFFFF60; } .ref-line:hover line { stroke: #FF0000; } .ref-line:hover text { stroke: white; fill: #212427; } .y-axis-line:hover rect { fill: #EDEDED; fill-opacity: 60%; stroke: #FFFFFF60; color: red; } .y-axis-line:hover text { stroke: white; stroke-width: 0.20em; fill: #1A1C1F; } </style>
<line x1="0.0" y1="5.0" x2="0.0" y2="125.0" stroke="#BFBFBF" stroke-width="4"></line><rect x="0.0" y="45.0" width="108.70588235294117" height="40" stroke="#577B8D" stroke-width="80" fill="#577B8D"></rect><g class="horizontal-line"><rect x="0" y="45.0" width="600" height="40" stroke="transparent" stroke-width="12" fill="transparent"></rect><text x="10.0" y="25" fill="transparent" stroke="transparent" font-size="30px">0.071</text></g>
</svg>
</div></td>
<td class="gt_row gt_right">$4.7</td>
<td class="gt_row gt_right"><div>
<svg role="img" viewbox="0 0 600 130" style="height: 3em; margin-left: auto; margin-right: auto; font-size: inherit; overflow: visible; vertical-align: middle; position:relative;">
<defs><pattern id="area_pattern" width="8" height="8" patternunits="userSpaceOnUse"><path class="pattern-line" d="M 0,8 l 8,-8 M -1,1 l 4,-4 M 6,10 l 4,-4" stroke="#FF0000" stroke-width="1.5" stroke-linecap="round" shape-rendering="geometricPrecision"></path></pattern></defs>
<style> text { font-family: ui-monospace, 'Cascadia Code', 'Source Code Pro', Menlo, Consolas, 'DejaVu Sans Mono', monospace; stroke-width: 0.15em; paint-order: stroke; stroke-linejoin: round; cursor: default; } .vert-line:hover rect { fill: #911EB4; fill-opacity: 40%; stroke: #FFFFFF60; color: red; } .vert-line:hover text { stroke: white; fill: #212427; } .horizontal-line:hover text {stroke: white; fill: #212427; } .ref-line:hover rect { stroke: #FFFFFF60; } .ref-line:hover line { stroke: #FF0000; } .ref-line:hover text { stroke: white; fill: #212427; } .y-axis-line:hover rect { fill: #EDEDED; fill-opacity: 60%; stroke: #FFFFFF60; color: red; } .y-axis-line:hover text { stroke: white; stroke-width: 0.20em; fill: #1A1C1F; } </style>
<line x1="0.0" y1="5.0" x2="0.0" y2="125.0" stroke="#BFBFBF" stroke-width="4"></line><rect x="0.0" y="45.0" width="468.75" height="40" stroke="#577B8D" stroke-width="80" fill="#577B8D"></rect><g class="horizontal-line"><rect x="0" y="45.0" width="600" height="40" stroke="transparent" stroke-width="12" fill="transparent"></rect><text x="10.0" y="25" fill="transparent" stroke="transparent" font-size="30px">0.25</text></g>
</svg>
</div></td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">A+</td>
<td class="gt_row gt_right">19</td>
<td class="gt_row gt_right"><div>
<svg role="img" viewbox="0 0 600 130" style="height: 3em; margin-left: auto; margin-right: auto; font-size: inherit; overflow: visible; vertical-align: middle; position:relative;">
<defs><pattern id="area_pattern" width="8" height="8" patternunits="userSpaceOnUse"><path class="pattern-line" d="M 0,8 l 8,-8 M -1,1 l 4,-4 M 6,10 l 4,-4" stroke="#FF0000" stroke-width="1.5" stroke-linecap="round" shape-rendering="geometricPrecision"></path></pattern></defs>
<style> text { font-family: ui-monospace, 'Cascadia Code', 'Source Code Pro', Menlo, Consolas, 'DejaVu Sans Mono', monospace; stroke-width: 0.15em; paint-order: stroke; stroke-linejoin: round; cursor: default; } .vert-line:hover rect { fill: #911EB4; fill-opacity: 40%; stroke: #FFFFFF60; color: red; } .vert-line:hover text { stroke: white; fill: #212427; } .horizontal-line:hover text {stroke: white; fill: #212427; } .ref-line:hover rect { stroke: #FFFFFF60; } .ref-line:hover line { stroke: #FF0000; } .ref-line:hover text { stroke: white; fill: #212427; } .y-axis-line:hover rect { fill: #EDEDED; fill-opacity: 60%; stroke: #FFFFFF60; color: red; } .y-axis-line:hover text { stroke: white; stroke-width: 0.20em; fill: #1A1C1F; } </style>
<line x1="0.0" y1="5.0" x2="0.0" y2="125.0" stroke="#BFBFBF" stroke-width="4"></line><rect x="0.0" y="45.0" width="26.823529411764707" height="40" stroke="#577B8D" stroke-width="80" fill="#577B8D"></rect><g class="horizontal-line"><rect x="0" y="45.0" width="600" height="40" stroke="transparent" stroke-width="12" fill="transparent"></rect><text x="10.0" y="25" fill="transparent" stroke="transparent" font-size="30px">0.017</text></g>
</svg>
</div></td>
<td class="gt_row gt_right">$3.9</td>
<td class="gt_row gt_right"><div>
<svg role="img" viewbox="0 0 600 130" style="height: 3em; margin-left: auto; margin-right: auto; font-size: inherit; overflow: visible; vertical-align: middle; position:relative;">
<defs><pattern id="area_pattern" width="8" height="8" patternunits="userSpaceOnUse"><path class="pattern-line" d="M 0,8 l 8,-8 M -1,1 l 4,-4 M 6,10 l 4,-4" stroke="#FF0000" stroke-width="1.5" stroke-linecap="round" shape-rendering="geometricPrecision"></path></pattern></defs>
<style> text { font-family: ui-monospace, 'Cascadia Code', 'Source Code Pro', Menlo, Consolas, 'DejaVu Sans Mono', monospace; stroke-width: 0.15em; paint-order: stroke; stroke-linejoin: round; cursor: default; } .vert-line:hover rect { fill: #911EB4; fill-opacity: 40%; stroke: #FFFFFF60; color: red; } .vert-line:hover text { stroke: white; fill: #212427; } .horizontal-line:hover text {stroke: white; fill: #212427; } .ref-line:hover rect { stroke: #FFFFFF60; } .ref-line:hover line { stroke: #FF0000; } .ref-line:hover text { stroke: white; fill: #212427; } .y-axis-line:hover rect { fill: #EDEDED; fill-opacity: 60%; stroke: #FFFFFF60; color: red; } .y-axis-line:hover text { stroke: white; stroke-width: 0.20em; fill: #1A1C1F; } </style>
<line x1="0.0" y1="5.0" x2="0.0" y2="125.0" stroke="#BFBFBF" stroke-width="4"></line><rect x="0.0" y="45.0" width="393.75" height="40" stroke="#577B8D" stroke-width="80" fill="#577B8D"></rect><g class="horizontal-line"><rect x="0" y="45.0" width="600" height="40" stroke="transparent" stroke-width="12" fill="transparent"></rect><text x="10.0" y="25" fill="transparent" stroke="transparent" font-size="30px">0.21</text></g>
</svg>
</div></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">B</td>
<td class="gt_row gt_right">338</td>
<td class="gt_row gt_right"><div>
<svg role="img" viewbox="0 0 600 130" style="height: 3em; margin-left: auto; margin-right: auto; font-size: inherit; overflow: visible; vertical-align: middle; position:relative;">
<defs><pattern id="area_pattern" width="8" height="8" patternunits="userSpaceOnUse"><path class="pattern-line" d="M 0,8 l 8,-8 M -1,1 l 4,-4 M 6,10 l 4,-4" stroke="#FF0000" stroke-width="1.5" stroke-linecap="round" shape-rendering="geometricPrecision"></path></pattern></defs>
<style> text { font-family: ui-monospace, 'Cascadia Code', 'Source Code Pro', Menlo, Consolas, 'DejaVu Sans Mono', monospace; stroke-width: 0.15em; paint-order: stroke; stroke-linejoin: round; cursor: default; } .vert-line:hover rect { fill: #911EB4; fill-opacity: 40%; stroke: #FFFFFF60; color: red; } .vert-line:hover text { stroke: white; fill: #212427; } .horizontal-line:hover text {stroke: white; fill: #212427; } .ref-line:hover rect { stroke: #FFFFFF60; } .ref-line:hover line { stroke: #FF0000; } .ref-line:hover text { stroke: white; fill: #212427; } .y-axis-line:hover rect { fill: #EDEDED; fill-opacity: 60%; stroke: #FFFFFF60; color: red; } .y-axis-line:hover text { stroke: white; stroke-width: 0.20em; fill: #1A1C1F; } </style>
<line x1="0.0" y1="5.0" x2="0.0" y2="125.0" stroke="#BFBFBF" stroke-width="4"></line><rect x="0.0" y="45.0" width="477.1764705882353" height="40" stroke="#577B8D" stroke-width="80" fill="#577B8D"></rect><g class="horizontal-line"><rect x="0" y="45.0" width="600" height="40" stroke="transparent" stroke-width="12" fill="transparent"></rect><text x="10.0" y="25" fill="transparent" stroke="transparent" font-size="30px">0.31</text></g>
</svg>
</div></td>
<td class="gt_row gt_right">$6.0</td>
<td class="gt_row gt_right"><div>
<svg role="img" viewbox="0 0 600 130" style="height: 3em; margin-left: auto; margin-right: auto; font-size: inherit; overflow: visible; vertical-align: middle; position:relative;">
<defs><pattern id="area_pattern" width="8" height="8" patternunits="userSpaceOnUse"><path class="pattern-line" d="M 0,8 l 8,-8 M -1,1 l 4,-4 M 6,10 l 4,-4" stroke="#FF0000" stroke-width="1.5" stroke-linecap="round" shape-rendering="geometricPrecision"></path></pattern></defs>
<style> text { font-family: ui-monospace, 'Cascadia Code', 'Source Code Pro', Menlo, Consolas, 'DejaVu Sans Mono', monospace; stroke-width: 0.15em; paint-order: stroke; stroke-linejoin: round; cursor: default; } .vert-line:hover rect { fill: #911EB4; fill-opacity: 40%; stroke: #FFFFFF60; color: red; } .vert-line:hover text { stroke: white; fill: #212427; } .horizontal-line:hover text {stroke: white; fill: #212427; } .ref-line:hover rect { stroke: #FFFFFF60; } .ref-line:hover line { stroke: #FF0000; } .ref-line:hover text { stroke: white; fill: #212427; } .y-axis-line:hover rect { fill: #EDEDED; fill-opacity: 60%; stroke: #FFFFFF60; color: red; } .y-axis-line:hover text { stroke: white; stroke-width: 0.20em; fill: #1A1C1F; } </style>
<line x1="0.0" y1="5.0" x2="0.0" y2="125.0" stroke="#BFBFBF" stroke-width="4"></line><rect x="0.0" y="45.0" width="600.0" height="40" stroke="#577B8D" stroke-width="80" fill="#577B8D"></rect><g class="horizontal-line"><rect x="0" y="45.0" width="600" height="40" stroke="transparent" stroke-width="12" fill="transparent"></rect><text x="10.0" y="25" fill="transparent" stroke="transparent" font-size="30px">0.32</text></g>
</svg>
</div></td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">C</td>
<td class="gt_row gt_right">425</td>
<td class="gt_row gt_right"><div>
<svg role="img" viewbox="0 0 600 130" style="height: 3em; margin-left: auto; margin-right: auto; font-size: inherit; overflow: visible; vertical-align: middle; position:relative;">
<defs><pattern id="area_pattern" width="8" height="8" patternunits="userSpaceOnUse"><path class="pattern-line" d="M 0,8 l 8,-8 M -1,1 l 4,-4 M 6,10 l 4,-4" stroke="#FF0000" stroke-width="1.5" stroke-linecap="round" shape-rendering="geometricPrecision"></path></pattern></defs>
<style> text { font-family: ui-monospace, 'Cascadia Code', 'Source Code Pro', Menlo, Consolas, 'DejaVu Sans Mono', monospace; stroke-width: 0.15em; paint-order: stroke; stroke-linejoin: round; cursor: default; } .vert-line:hover rect { fill: #911EB4; fill-opacity: 40%; stroke: #FFFFFF60; color: red; } .vert-line:hover text { stroke: white; fill: #212427; } .horizontal-line:hover text {stroke: white; fill: #212427; } .ref-line:hover rect { stroke: #FFFFFF60; } .ref-line:hover line { stroke: #FF0000; } .ref-line:hover text { stroke: white; fill: #212427; } .y-axis-line:hover rect { fill: #EDEDED; fill-opacity: 60%; stroke: #FFFFFF60; color: red; } .y-axis-line:hover text { stroke: white; stroke-width: 0.20em; fill: #1A1C1F; } </style>
<line x1="0.0" y1="5.0" x2="0.0" y2="125.0" stroke="#BFBFBF" stroke-width="4"></line><rect x="0.0" y="45.0" width="600.0" height="40" stroke="#577B8D" stroke-width="80" fill="#577B8D"></rect><g class="horizontal-line"><rect x="0" y="45.0" width="600" height="40" stroke="transparent" stroke-width="12" fill="transparent"></rect><text x="10.0" y="25" fill="transparent" stroke="transparent" font-size="30px">0.39</text></g>
</svg>
</div></td>
<td class="gt_row gt_right">$2.8</td>
<td class="gt_row gt_right"><div>
<svg role="img" viewbox="0 0 600 130" style="height: 3em; margin-left: auto; margin-right: auto; font-size: inherit; overflow: visible; vertical-align: middle; position:relative;">
<defs><pattern id="area_pattern" width="8" height="8" patternunits="userSpaceOnUse"><path class="pattern-line" d="M 0,8 l 8,-8 M -1,1 l 4,-4 M 6,10 l 4,-4" stroke="#FF0000" stroke-width="1.5" stroke-linecap="round" shape-rendering="geometricPrecision"></path></pattern></defs>
<style> text { font-family: ui-monospace, 'Cascadia Code', 'Source Code Pro', Menlo, Consolas, 'DejaVu Sans Mono', monospace; stroke-width: 0.15em; paint-order: stroke; stroke-linejoin: round; cursor: default; } .vert-line:hover rect { fill: #911EB4; fill-opacity: 40%; stroke: #FFFFFF60; color: red; } .vert-line:hover text { stroke: white; fill: #212427; } .horizontal-line:hover text {stroke: white; fill: #212427; } .ref-line:hover rect { stroke: #FFFFFF60; } .ref-line:hover line { stroke: #FF0000; } .ref-line:hover text { stroke: white; fill: #212427; } .y-axis-line:hover rect { fill: #EDEDED; fill-opacity: 60%; stroke: #FFFFFF60; color: red; } .y-axis-line:hover text { stroke: white; stroke-width: 0.20em; fill: #1A1C1F; } </style>
<line x1="0.0" y1="5.0" x2="0.0" y2="125.0" stroke="#BFBFBF" stroke-width="4"></line><rect x="0.0" y="45.0" width="281.25" height="40" stroke="#577B8D" stroke-width="80" fill="#577B8D"></rect><g class="horizontal-line"><rect x="0" y="45.0" width="600" height="40" stroke="transparent" stroke-width="12" fill="transparent"></rect><text x="10.0" y="25" fill="transparent" stroke="transparent" font-size="30px">0.15</text></g>
</svg>
</div></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">D</td>
<td class="gt_row gt_right">24</td>
<td class="gt_row gt_right"><div>
<svg role="img" viewbox="0 0 600 130" style="height: 3em; margin-left: auto; margin-right: auto; font-size: inherit; overflow: visible; vertical-align: middle; position:relative;">
<defs><pattern id="area_pattern" width="8" height="8" patternunits="userSpaceOnUse"><path class="pattern-line" d="M 0,8 l 8,-8 M -1,1 l 4,-4 M 6,10 l 4,-4" stroke="#FF0000" stroke-width="1.5" stroke-linecap="round" shape-rendering="geometricPrecision"></path></pattern></defs>
<style> text { font-family: ui-monospace, 'Cascadia Code', 'Source Code Pro', Menlo, Consolas, 'DejaVu Sans Mono', monospace; stroke-width: 0.15em; paint-order: stroke; stroke-linejoin: round; cursor: default; } .vert-line:hover rect { fill: #911EB4; fill-opacity: 40%; stroke: #FFFFFF60; color: red; } .vert-line:hover text { stroke: white; fill: #212427; } .horizontal-line:hover text {stroke: white; fill: #212427; } .ref-line:hover rect { stroke: #FFFFFF60; } .ref-line:hover line { stroke: #FF0000; } .ref-line:hover text { stroke: white; fill: #212427; } .y-axis-line:hover rect { fill: #EDEDED; fill-opacity: 60%; stroke: #FFFFFF60; color: red; } .y-axis-line:hover text { stroke: white; stroke-width: 0.20em; fill: #1A1C1F; } </style>
<line x1="0.0" y1="5.0" x2="0.0" y2="125.0" stroke="#BFBFBF" stroke-width="4"></line><rect x="0.0" y="45.0" width="33.88235294117647" height="40" stroke="#577B8D" stroke-width="80" fill="#577B8D"></rect><g class="horizontal-line"><rect x="0" y="45.0" width="600" height="40" stroke="transparent" stroke-width="12" fill="transparent"></rect><text x="10.0" y="25" fill="transparent" stroke="transparent" font-size="30px">0.022</text></g>
</svg>
</div></td>
<td class="gt_row gt_right">$0.4</td>
<td class="gt_row gt_right"><div>
<svg role="img" viewbox="0 0 600 130" style="height: 3em; margin-left: auto; margin-right: auto; font-size: inherit; overflow: visible; vertical-align: middle; position:relative;">
<defs><pattern id="area_pattern" width="8" height="8" patternunits="userSpaceOnUse"><path class="pattern-line" d="M 0,8 l 8,-8 M -1,1 l 4,-4 M 6,10 l 4,-4" stroke="#FF0000" stroke-width="1.5" stroke-linecap="round" shape-rendering="geometricPrecision"></path></pattern></defs>
<style> text { font-family: ui-monospace, 'Cascadia Code', 'Source Code Pro', Menlo, Consolas, 'DejaVu Sans Mono', monospace; stroke-width: 0.15em; paint-order: stroke; stroke-linejoin: round; cursor: default; } .vert-line:hover rect { fill: #911EB4; fill-opacity: 40%; stroke: #FFFFFF60; color: red; } .vert-line:hover text { stroke: white; fill: #212427; } .horizontal-line:hover text {stroke: white; fill: #212427; } .ref-line:hover rect { stroke: #FFFFFF60; } .ref-line:hover line { stroke: #FF0000; } .ref-line:hover text { stroke: white; fill: #212427; } .y-axis-line:hover rect { fill: #EDEDED; fill-opacity: 60%; stroke: #FFFFFF60; color: red; } .y-axis-line:hover text { stroke: white; stroke-width: 0.20em; fill: #1A1C1F; } </style>
<line x1="0.0" y1="5.0" x2="0.0" y2="125.0" stroke="#BFBFBF" stroke-width="4"></line><rect x="0.0" y="45.0" width="37.5" height="40" stroke="#577B8D" stroke-width="80" fill="#577B8D"></rect><g class="horizontal-line"><rect x="0" y="45.0" width="600" height="40" stroke="transparent" stroke-width="12" fill="transparent"></rect><text x="10.0" y="25" fill="transparent" stroke="transparent" font-size="30px">0.020</text></g>
</svg>
</div></td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">All other</td>
<td class="gt_row gt_right">205</td>
<td class="gt_row gt_right"><div>
<svg role="img" viewbox="0 0 600 130" style="height: 3em; margin-left: auto; margin-right: auto; font-size: inherit; overflow: visible; vertical-align: middle; position:relative;">
<defs><pattern id="area_pattern" width="8" height="8" patternunits="userSpaceOnUse"><path class="pattern-line" d="M 0,8 l 8,-8 M -1,1 l 4,-4 M 6,10 l 4,-4" stroke="#FF0000" stroke-width="1.5" stroke-linecap="round" shape-rendering="geometricPrecision"></path></pattern></defs>
<style> text { font-family: ui-monospace, 'Cascadia Code', 'Source Code Pro', Menlo, Consolas, 'DejaVu Sans Mono', monospace; stroke-width: 0.15em; paint-order: stroke; stroke-linejoin: round; cursor: default; } .vert-line:hover rect { fill: #911EB4; fill-opacity: 40%; stroke: #FFFFFF60; color: red; } .vert-line:hover text { stroke: white; fill: #212427; } .horizontal-line:hover text {stroke: white; fill: #212427; } .ref-line:hover rect { stroke: #FFFFFF60; } .ref-line:hover line { stroke: #FF0000; } .ref-line:hover text { stroke: white; fill: #212427; } .y-axis-line:hover rect { fill: #EDEDED; fill-opacity: 60%; stroke: #FFFFFF60; color: red; } .y-axis-line:hover text { stroke: white; stroke-width: 0.20em; fill: #1A1C1F; } </style>
<line x1="0.0" y1="5.0" x2="0.0" y2="125.0" stroke="#BFBFBF" stroke-width="4"></line><rect x="0.0" y="45.0" width="289.41176470588226" height="40" stroke="#577B8D" stroke-width="80" fill="#577B8D"></rect><g class="horizontal-line"><rect x="0" y="45.0" width="600" height="40" stroke="transparent" stroke-width="12" fill="transparent"></rect><text x="10.0" y="25" fill="transparent" stroke="transparent" font-size="30px">0.19</text></g>
</svg>
</div></td>
<td class="gt_row gt_right">$0.9</td>
<td class="gt_row gt_right"><div>
<svg role="img" viewbox="0 0 600 130" style="height: 3em; margin-left: auto; margin-right: auto; font-size: inherit; overflow: visible; vertical-align: middle; position:relative;">
<defs><pattern id="area_pattern" width="8" height="8" patternunits="userSpaceOnUse"><path class="pattern-line" d="M 0,8 l 8,-8 M -1,1 l 4,-4 M 6,10 l 4,-4" stroke="#FF0000" stroke-width="1.5" stroke-linecap="round" shape-rendering="geometricPrecision"></path></pattern></defs>
<style> text { font-family: ui-monospace, 'Cascadia Code', 'Source Code Pro', Menlo, Consolas, 'DejaVu Sans Mono', monospace; stroke-width: 0.15em; paint-order: stroke; stroke-linejoin: round; cursor: default; } .vert-line:hover rect { fill: #911EB4; fill-opacity: 40%; stroke: #FFFFFF60; color: red; } .vert-line:hover text { stroke: white; fill: #212427; } .horizontal-line:hover text {stroke: white; fill: #212427; } .ref-line:hover rect { stroke: #FFFFFF60; } .ref-line:hover line { stroke: #FF0000; } .ref-line:hover text { stroke: white; fill: #212427; } .y-axis-line:hover rect { fill: #EDEDED; fill-opacity: 60%; stroke: #FFFFFF60; color: red; } .y-axis-line:hover text { stroke: white; stroke-width: 0.20em; fill: #1A1C1F; } </style>
<line x1="0.0" y1="5.0" x2="0.0" y2="125.0" stroke="#BFBFBF" stroke-width="4"></line><rect x="0.0" y="45.0" width="93.74999999999987" height="40" stroke="#577B8D" stroke-width="80" fill="#577B8D"></rect><g class="horizontal-line"><rect x="0" y="45.0" width="600" height="40" stroke="transparent" stroke-width="12" fill="transparent"></rect><text x="10.0" y="25" fill="transparent" stroke="transparent" font-size="30px">0.050</text></g>
</svg>
</div></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">Grand Total</td>
<td class="gt_row gt_right" style="font-style: bolder; background-color: #EEEEEE; border-top: 2px solid grey; border-bottom: 2px solid grey">1,088</td>
<td class="gt_row gt_right" style="font-style: bolder; background-color: #EEEEEE; border-top: 2px solid grey; border-bottom: 2px solid grey; color: #EEEEEE; font-size: 0.5">None</td>
<td class="gt_row gt_right" style="font-style: bolder; background-color: #EEEEEE; border-top: 2px solid grey; border-bottom: 2px solid grey">$18.7</td>
<td class="gt_row gt_right" style="font-style: bolder; background-color: #EEEEEE; border-top: 2px solid grey; border-bottom: 2px solid grey; color: #EEEEEE; font-size: 0.5">None</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="odd">
<td colspan="5" class="gt_sourcenote">Figure 2.1d: Table with data bar</td>
</tr>
</tfoot>

</table>


</div>
        
</div>
</div>
</div>
<p><code>great_tables</code> vẫn chưa thực sự render ra được bảng biểu đúng như setting.</p>
<p>Bài thực hành đến đây là kết thúc! 🚀</p>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ol type="1">
<li><a href="https://www.storytellingwithdata.com/books" class="uri">https://www.storytellingwithdata.com/books</a></li>
<li><a href="https://rpubs.com/chidungkt/1139405" class="uri">https://rpubs.com/chidungkt/1139405</a></li>
<li><a href="https://posit-dev.github.io/great-tables/articles/intro.html" class="uri">https://posit-dev.github.io/great-tables/articles/intro.html</a></li>
</ol>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/lktuan\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb7" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">---</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="an">title:</span><span class="co"> "Storytelling with Data: Let’s Practice, Improve this table!"</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="an">description:</span><span class="co"> "Practicing to improve a cross-tab report table using Python"</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="an">author:</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co">  - name: "Tuan Le Khac"</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co">    url: https://lktuan.github.io/</span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="an">date:</span><span class="co"> 05-22-2024</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="an">date-modified:</span><span class="co"> 05-23-2024</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="an">categories:</span><span class="co"> [python, visualization] # self-defined categories</span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="an">image:</span><span class="co"> SWD-Cover-FULL-R5-MED.png</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="an">draft:</span><span class="co"> false # setting this to `true` will prevent your post from appearing on your listing page until you're ready!</span></span>
<span id="cb7-12"><a href="#cb7-12"></a></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="co">  html: </span></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="co">    code-fold: false</span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="co">    code-summary: "Show the code"</span></span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="co">    code-line-numbers: true</span></span>
<span id="cb7-18"><a href="#cb7-18"></a><span class="an">css:</span><span class="co"> html/styles.scss</span></span>
<span id="cb7-19"><a href="#cb7-19"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb7-20"><a href="#cb7-20"></a><span class="an">fig-cap-location:</span><span class="co"> bottom</span></span>
<span id="cb7-21"><a href="#cb7-21"></a><span class="co">---</span></span>
<span id="cb7-22"><a href="#cb7-22"></a></span>
<span id="cb7-23"><a href="#cb7-23"></a><span class="fu"># 1. Motivation</span></span>
<span id="cb7-24"><a href="#cb7-24"></a></span>
<span id="cb7-25"><a href="#cb7-25"></a>Lấy cảm hứng từ bài <span class="co">[</span><span class="ot">post</span><span class="co">](https://rpubs.com/chidungkt/1139405)</span> của thầy Nguyễn Chí Dũng về việc giải các exercise thuộc Chương 2 cuốn sách **Storytelling with Data: Let’s Practice** của tác giả <span class="co">[</span><span class="ot">Cole Nussbaumer Knaflic</span><span class="co">](https://www.linkedin.com/in/colenussbaumer/)</span> sử dụng R, mình muốn cải thiện 1 bảng biểu nhưng sử dụng Python (trong cuốn sách gốc, tác giả sử dụng Excel để makeover các graph).</span>
<span id="cb7-26"><a href="#cb7-26"></a></span>
<span id="cb7-27"><a href="#cb7-27"></a>Đây là một cuốn sách hay về chủ để visualization, dành cho những người sử dụng biểu đồ nhiều để communicate trong công việc. Cụm từ "storytelling" đang được sử dụng rất nhiều, thậm chí như là một buzzword, một keyword cần có trong CV của mỗi người làm data. Đối với mình, "storytelling" chỉ nên được sử dụng khi bạn đã có sẵn các kết quả phân tích, được thực hiện một cách khoa học, và bạn muốn truyền tải nó tới business unit/management một cách hiệu quả. "Storytelling" nên không bao giờ là động cơ để bạn thực hiện một phân tích (thứ thay vào đó nên là một **câu hỏi**), thiên kiến sẽ ảnh hưởng tới phương pháp thực hiện, và rất dễ nảy sinh ngụy biện khi kết luận. Hãy xem bài viết này của <span class="co">[</span><span class="ot">Keith McNulty</span><span class="co">](https://www.linkedin.com/pulse/data-professionals-beware-storytelling-keith-mcnulty/)</span> và <span class="co">[</span><span class="ot">discussion</span><span class="co">](https://www.linkedin.com/posts/keith-mcnulty_my-most-hated-word-in-data-science-activity-7017097392759918592-2Atc/)</span> trên Linked In.</span>
<span id="cb7-28"><a href="#cb7-28"></a></span>
<span id="cb7-29"><a href="#cb7-29"></a>::: {layout-ncol="1"}</span>
<span id="cb7-30"><a href="#cb7-30"></a>!<span class="co">[</span><span class="ot">Photo credit to [swd](https://www.storytellingwithdata.com/blog/2019/8/27/lets-practice)</span><span class="co">](swd_chap5.png)</span>{width="100%"}</span>
<span id="cb7-31"><a href="#cb7-31"></a>:::</span>
<span id="cb7-32"><a href="#cb7-32"></a></span>
<span id="cb7-33"><a href="#cb7-33"></a><span class="fu"># 2. Let's Practice</span></span>
<span id="cb7-34"><a href="#cb7-34"></a></span>
<span id="cb7-35"><a href="#cb7-35"></a>Mình đang học <span class="in">`{ggplot2}`</span> trên R để thực hành hình ảnh hóa dữ liệu, tuy nhiên có vẻ package này (và tương ứng là <span class="in">`plotnine`</span> trên Python không phù hợp cho báo cáo bảng). Trong bài post, thầy Dũng cũng sử dụng một library khác là <span class="in">`kableExtra`</span> (tham khảo <span class="co">[</span><span class="ot">đây</span><span class="co">](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html)</span>).</span>
<span id="cb7-36"><a href="#cb7-36"></a></span>
<span id="cb7-37"><a href="#cb7-37"></a>Sau một lúc google thì có vẻ có một package của Python phù hợp để làm nhiệm vụ này, đó là <span class="in">`great_tables`</span> (tham khảo <span class="co">[</span><span class="ot">đây</span><span class="co">](https://posit-dev.github.io/great-tables/articles/intro.html)</span>). Package này cũng được khuyến khích sử dụng cho mục đích communication bởi <span class="co">[</span><span class="ot">Emily Riederer</span><span class="co">](https://www.emilyriederer.com/post/py-rgo/#the-stack)</span>.</span>
<span id="cb7-38"><a href="#cb7-38"></a></span>
<span id="cb7-39"><a href="#cb7-39"></a><span class="fu">## 2.1. Import the data</span></span>
<span id="cb7-40"><a href="#cb7-40"></a></span>
<span id="cb7-41"><a href="#cb7-41"></a>Okay đầu tiên cần import và làm sạch dữ liệu. Bảng có sẵn trong file Exercise có vẻ dùng để báo cáo hơn là lưu trữ dữ liệu.</span>
<span id="cb7-42"><a href="#cb7-42"></a></span>
<span id="cb7-45"><a href="#cb7-45"></a><span class="in">```{python}</span></span>
<span id="cb7-46"><a href="#cb7-46"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-47"><a href="#cb7-47"></a></span>
<span id="cb7-48"><a href="#cb7-48"></a>data <span class="op">=</span> pd.read_excel(</span>
<span id="cb7-49"><a href="#cb7-49"></a>  <span class="st">"2.1 EXERCISE.xlsx"</span>,</span>
<span id="cb7-50"><a href="#cb7-50"></a>  sheet_name <span class="op">=</span> <span class="st">"EXERCISE 2.1"</span>,</span>
<span id="cb7-51"><a href="#cb7-51"></a>  skiprows<span class="op">=</span><span class="dv">6</span></span>
<span id="cb7-52"><a href="#cb7-52"></a>)</span>
<span id="cb7-53"><a href="#cb7-53"></a></span>
<span id="cb7-54"><a href="#cb7-54"></a>data <span class="op">=</span> data.drop(<span class="st">'Unnamed: 0'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb7-55"><a href="#cb7-55"></a>data <span class="op">=</span> data.rename(columns<span class="op">=</span>{ <span class="st">"Tier"</span>: <span class="st">"tier"</span></span>
<span id="cb7-56"><a href="#cb7-56"></a>                    ,<span class="st">"# of Accounts"</span>: <span class="st">"no_of_account"</span></span>
<span id="cb7-57"><a href="#cb7-57"></a>                    ,<span class="st">"% Accounts"</span>: <span class="st">"pct_of_account"</span></span>
<span id="cb7-58"><a href="#cb7-58"></a>                    ,<span class="st">"Revenue ($M)"</span>: <span class="st">"revenue"</span></span>
<span id="cb7-59"><a href="#cb7-59"></a>                    ,<span class="st">"% Revenue"</span>: <span class="st">"pct_of_revenue"</span>})</span>
<span id="cb7-60"><a href="#cb7-60"></a><span class="in">```</span></span>
<span id="cb7-61"><a href="#cb7-61"></a></span>
<span id="cb7-62"><a href="#cb7-62"></a><span class="fu">## 2.2. Data manipulation</span></span>
<span id="cb7-63"><a href="#cb7-63"></a></span>
<span id="cb7-64"><a href="#cb7-64"></a>Yep giờ ta đã có 1 bảng data khá sạch, tuy nhiên lưu ý là bảng đang không thể hiện toàn bộ dữ liệu (total của <span class="in">`pct_of_account`</span> chỉ là <span class="in">`81.86%`</span>). Ta cần tính toán thêm <span class="in">`All other`</span> và <span class="in">`Grand Total`</span> (lý do là mình chưa tìm thấy function hiển thị Grand Total với package đang sử dụng, ngay cả trong ví dụ <span class="co">[</span><span class="ot">này</span><span class="co">](https://posit-dev.github.io/great-tables/blog/pycon-2024-great-tables-are-possible/)</span>, GT cũng sử dụng data đã có sẵn Grand Total).</span>
<span id="cb7-65"><a href="#cb7-65"></a></span>
<span id="cb7-68"><a href="#cb7-68"></a><span class="in">```{python}</span></span>
<span id="cb7-69"><a href="#cb7-69"></a>all_other_pct_of_account <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> data[<span class="st">"pct_of_account"</span>].<span class="bu">sum</span>()</span>
<span id="cb7-70"><a href="#cb7-70"></a>all_other_no_of_account <span class="op">=</span> <span class="bu">round</span>(all_other_pct_of_account <span class="op">/</span> data[<span class="st">"pct_of_account"</span>][<span class="dv">0</span>] <span class="op">*</span> data[<span class="st">"no_of_account"</span>][<span class="dv">0</span>],<span class="dv">0</span>)</span>
<span id="cb7-71"><a href="#cb7-71"></a></span>
<span id="cb7-72"><a href="#cb7-72"></a>all_other_pct_of_revenue <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> data[<span class="st">"pct_of_revenue"</span>].<span class="bu">sum</span>()</span>
<span id="cb7-73"><a href="#cb7-73"></a>all_other_revenue <span class="op">=</span> <span class="bu">round</span>(all_other_pct_of_revenue <span class="op">/</span> data[<span class="st">"pct_of_revenue"</span>][<span class="dv">0</span>] <span class="op">*</span> data[<span class="st">"revenue"</span>][<span class="dv">0</span>],<span class="dv">3</span>)</span>
<span id="cb7-74"><a href="#cb7-74"></a></span>
<span id="cb7-75"><a href="#cb7-75"></a>all_other <span class="op">=</span> pd.Series({ <span class="st">"tier"</span>: <span class="st">"All other"</span>,</span>
<span id="cb7-76"><a href="#cb7-76"></a>                        <span class="st">"no_of_account"</span>: all_other_no_of_account,</span>
<span id="cb7-77"><a href="#cb7-77"></a>                        <span class="st">"pct_of_account"</span>: all_other_pct_of_account,</span>
<span id="cb7-78"><a href="#cb7-78"></a>                        <span class="st">"revenue"</span>:all_other_revenue,</span>
<span id="cb7-79"><a href="#cb7-79"></a>                        <span class="st">"pct_of_revenue"</span>: all_other_pct_of_revenue})</span>
<span id="cb7-80"><a href="#cb7-80"></a></span>
<span id="cb7-81"><a href="#cb7-81"></a>data <span class="op">=</span> pd.concat([data, all_other.to_frame().T], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-82"><a href="#cb7-82"></a></span>
<span id="cb7-83"><a href="#cb7-83"></a>data.loc[<span class="bu">len</span>(data.index)] <span class="op">=</span> data.<span class="bu">sum</span>()</span>
<span id="cb7-84"><a href="#cb7-84"></a>data.loc[data.index[<span class="op">-</span><span class="dv">1</span>], <span class="st">'tier'</span>] <span class="op">=</span> <span class="st">'Grand Total'</span></span>
<span id="cb7-85"><a href="#cb7-85"></a><span class="in">```</span></span>
<span id="cb7-86"><a href="#cb7-86"></a></span>
<span id="cb7-87"><a href="#cb7-87"></a>Show the data:</span>
<span id="cb7-88"><a href="#cb7-88"></a></span>
<span id="cb7-91"><a href="#cb7-91"></a><span class="in">```{python}</span></span>
<span id="cb7-92"><a href="#cb7-92"></a><span class="im">from</span> great_tables <span class="im">import</span> GT</span>
<span id="cb7-93"><a href="#cb7-93"></a></span>
<span id="cb7-94"><a href="#cb7-94"></a>( </span>
<span id="cb7-95"><a href="#cb7-95"></a>  GT(data)</span>
<span id="cb7-96"><a href="#cb7-96"></a>  .fmt_number(columns<span class="op">=</span> [<span class="st">"no_of_account"</span>,<span class="st">"pct_of_account"</span>,<span class="st">"revenue"</span>,<span class="st">"pct_of_revenue"</span>],decimals<span class="op">=</span><span class="dv">2</span>))</span>
<span id="cb7-97"><a href="#cb7-97"></a><span class="in">```</span></span>
<span id="cb7-98"><a href="#cb7-98"></a></span>
<span id="cb7-99"><a href="#cb7-99"></a><span class="fu">## 2.3. Visualization</span></span>
<span id="cb7-100"><a href="#cb7-100"></a></span>
<span id="cb7-101"><a href="#cb7-101"></a>Được rồi, giờ ta có thể dùng <span class="in">`great_tables`</span> để tiến hành visualize. Về cơ bản, chỉ cần khởi tạo một object <span class="in">`GT()`</span> có thể mở rộng được, các element/hoặc format được định nghĩa về sau.</span>
<span id="cb7-102"><a href="#cb7-102"></a></span>
<span id="cb7-103"><a href="#cb7-103"></a>Dưới đây chúng ta trình bày một bảng đơn giản với tiêu đề, tên cột, cũng như định dạng lại dữ liệu.</span>
<span id="cb7-104"><a href="#cb7-104"></a></span>
<span id="cb7-107"><a href="#cb7-107"></a><span class="in">```{python}</span></span>
<span id="cb7-108"><a href="#cb7-108"></a>(</span>
<span id="cb7-109"><a href="#cb7-109"></a>  GT(data)</span>
<span id="cb7-110"><a href="#cb7-110"></a>  .tab_header(title<span class="op">=</span><span class="st">"New client tier share"</span>)</span>
<span id="cb7-111"><a href="#cb7-111"></a>  .cols_label(</span>
<span id="cb7-112"><a href="#cb7-112"></a>    tier <span class="op">=</span> <span class="st">"Tier"</span>,</span>
<span id="cb7-113"><a href="#cb7-113"></a>    no_of_account <span class="op">=</span> <span class="st">"# of Accounts"</span>,</span>
<span id="cb7-114"><a href="#cb7-114"></a>    pct_of_account <span class="op">=</span> <span class="st">"% Accounts"</span>,</span>
<span id="cb7-115"><a href="#cb7-115"></a>    revenue <span class="op">=</span> <span class="st">"Revenue ($M)"</span>,</span>
<span id="cb7-116"><a href="#cb7-116"></a>    pct_of_revenue <span class="op">=</span> <span class="st">"% Revenue"</span></span>
<span id="cb7-117"><a href="#cb7-117"></a>  )</span>
<span id="cb7-118"><a href="#cb7-118"></a>  .fmt_number(columns<span class="op">=</span><span class="st">"no_of_account"</span>,decimals<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb7-119"><a href="#cb7-119"></a>  .fmt_percent(columns<span class="op">=</span>[<span class="st">"pct_of_account"</span>, <span class="st">"pct_of_revenue"</span>], decimals<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb7-120"><a href="#cb7-120"></a>  .fmt_currency(columns <span class="op">=</span> <span class="st">"revenue"</span>, currency<span class="op">=</span><span class="st">"USD"</span>, decimals<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb7-121"><a href="#cb7-121"></a>  .tab_source_note(source_note<span class="op">=</span><span class="st">"Figure 2.1b: Slightly improved table"</span>)</span>
<span id="cb7-122"><a href="#cb7-122"></a>)</span>
<span id="cb7-123"><a href="#cb7-123"></a><span class="in">```</span></span>
<span id="cb7-124"><a href="#cb7-124"></a></span>
<span id="cb7-125"><a href="#cb7-125"></a>Trông ổn (ít nhất là trình bày số liệu một cách toàn vẹn) so với bản gốc rồi!</span>
<span id="cb7-126"><a href="#cb7-126"></a></span>
<span id="cb7-127"><a href="#cb7-127"></a>Tiếp tục, ta dùng - helper <span class="in">`md()`</span> để định dạng lại tiêu đề; - sử dụng <span class="in">`.data_color()`</span> để tạo heatmapping; - sử dụng <span class="in">`tab_style()`</span> để format dòng Grand Total; - sử dụng <span class="in">`.opt_stylize()`</span> để theming.</span>
<span id="cb7-128"><a href="#cb7-128"></a></span>
<span id="cb7-131"><a href="#cb7-131"></a><span class="in">```{python}</span></span>
<span id="cb7-132"><a href="#cb7-132"></a><span class="im">from</span> great_tables <span class="im">import</span> md, style, loc</span>
<span id="cb7-133"><a href="#cb7-133"></a></span>
<span id="cb7-134"><a href="#cb7-134"></a>(</span>
<span id="cb7-135"><a href="#cb7-135"></a>  GT(data)</span>
<span id="cb7-136"><a href="#cb7-136"></a>  .tab_header(title<span class="op">=</span>md(<span class="st">"&lt;strong&gt;New client tier share&lt;/strong&gt;"</span>))</span>
<span id="cb7-137"><a href="#cb7-137"></a>  .opt_align_table_header(align<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb7-138"><a href="#cb7-138"></a>  .cols_label(</span>
<span id="cb7-139"><a href="#cb7-139"></a>    tier <span class="op">=</span> <span class="st">"Tier"</span>,</span>
<span id="cb7-140"><a href="#cb7-140"></a>    no_of_account <span class="op">=</span> <span class="st">"# of Accounts"</span>,</span>
<span id="cb7-141"><a href="#cb7-141"></a>    pct_of_account <span class="op">=</span> <span class="st">"% Accounts"</span>,</span>
<span id="cb7-142"><a href="#cb7-142"></a>    revenue <span class="op">=</span> <span class="st">"($M) Revenue"</span>, <span class="co"># change the label</span></span>
<span id="cb7-143"><a href="#cb7-143"></a>    pct_of_revenue <span class="op">=</span> <span class="st">"% Revenue"</span></span>
<span id="cb7-144"><a href="#cb7-144"></a>  )</span>
<span id="cb7-145"><a href="#cb7-145"></a>  .fmt_number(columns<span class="op">=</span><span class="st">"no_of_account"</span>,decimals<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb7-146"><a href="#cb7-146"></a>  .fmt_percent(columns<span class="op">=</span>[<span class="st">"pct_of_account"</span>, <span class="st">"pct_of_revenue"</span>], decimals<span class="op">=</span><span class="dv">0</span>) <span class="co"># changed decimals</span></span>
<span id="cb7-147"><a href="#cb7-147"></a>  .fmt_currency(columns <span class="op">=</span> <span class="st">"revenue"</span>, currency<span class="op">=</span><span class="st">"USD"</span>, decimals<span class="op">=</span><span class="dv">1</span>)<span class="co"># changed decimals</span></span>
<span id="cb7-148"><a href="#cb7-148"></a>  .tab_source_note(source_note<span class="op">=</span><span class="st">"Figure 2.1c: Table with heatmapping"</span>)</span>
<span id="cb7-149"><a href="#cb7-149"></a>  .data_color(</span>
<span id="cb7-150"><a href="#cb7-150"></a>    columns<span class="op">=</span>[<span class="st">"pct_of_account"</span>, <span class="st">"pct_of_revenue"</span>],</span>
<span id="cb7-151"><a href="#cb7-151"></a>    palette<span class="op">=</span>[<span class="st">"#57A6A1"</span>, <span class="st">"#577B8D"</span>, <span class="st">"#344C64"</span>, <span class="st">"#240750"</span>],</span>
<span id="cb7-152"><a href="#cb7-152"></a>    domain<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>],</span>
<span id="cb7-153"><a href="#cb7-153"></a>    na_color<span class="op">=</span><span class="st">"lightgray"</span>,</span>
<span id="cb7-154"><a href="#cb7-154"></a>    autocolor_text <span class="op">=</span> <span class="va">False</span></span>
<span id="cb7-155"><a href="#cb7-155"></a>  )</span>
<span id="cb7-156"><a href="#cb7-156"></a>  .tab_style(</span>
<span id="cb7-157"><a href="#cb7-157"></a>        style<span class="op">=</span>[</span>
<span id="cb7-158"><a href="#cb7-158"></a>          style.text(style<span class="op">=</span><span class="st">"bolder"</span>),</span>
<span id="cb7-159"><a href="#cb7-159"></a>          style.fill(<span class="st">"#EEEEEE"</span>),</span>
<span id="cb7-160"><a href="#cb7-160"></a>          style.borders(sides<span class="op">=</span>[<span class="st">"top"</span>, <span class="st">"bottom"</span>], weight<span class="op">=</span><span class="st">'2px'</span>, color<span class="op">=</span><span class="st">"grey"</span>)</span>
<span id="cb7-161"><a href="#cb7-161"></a>          ],</span>
<span id="cb7-162"><a href="#cb7-162"></a>        locations<span class="op">=</span>loc.body(rows<span class="op">=</span>[<span class="dv">6</span>])</span>
<span id="cb7-163"><a href="#cb7-163"></a>  )</span>
<span id="cb7-164"><a href="#cb7-164"></a>  .opt_stylize(style<span class="op">=</span><span class="dv">5</span> ,color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb7-165"><a href="#cb7-165"></a>)</span>
<span id="cb7-166"><a href="#cb7-166"></a><span class="in">```</span></span>
<span id="cb7-167"><a href="#cb7-167"></a></span>
<span id="cb7-168"><a href="#cb7-168"></a>Tiếp theo, chúng ta sẽ thử dùng <span class="in">`fmt_nanoplot()`</span> để tạo một bar plots thay cho hai cột percentage.</span>
<span id="cb7-169"><a href="#cb7-169"></a></span>
<span id="cb7-170"><a href="#cb7-170"></a>Đây là một tính năng trong giai đoạn thử nghiệm nên mình thấy chưa thực sử ổn định và tuân theo document mà nhà phát triển đề cập. Trong ví dụ dưới đây mình sử dụng data bar, loại bỏ format do hàng cuối cùng. Tuy nhiên, đồ thị vẫn include giá trị <span class="in">`100%`</span> ở hàng Grand Total để điều chỉnh bar scale.</span>
<span id="cb7-171"><a href="#cb7-171"></a></span>
<span id="cb7-172"><a href="#cb7-172"></a>Thêm nữa mình cần chuyển dataframe về polar dataframe, khi đó một column của dl.df là iterable.</span>
<span id="cb7-173"><a href="#cb7-173"></a></span>
<span id="cb7-176"><a href="#cb7-176"></a><span class="in">```{python}</span></span>
<span id="cb7-177"><a href="#cb7-177"></a><span class="im">from</span> great_tables <span class="im">import</span> md, style, loc, nanoplot_options</span>
<span id="cb7-178"><a href="#cb7-178"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-179"><a href="#cb7-179"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb7-180"><a href="#cb7-180"></a></span>
<span id="cb7-181"><a href="#cb7-181"></a>data.at[<span class="dv">6</span>, <span class="st">"pct_of_account"</span>] <span class="op">=</span> np.nan</span>
<span id="cb7-182"><a href="#cb7-182"></a>data.at[<span class="dv">6</span>, <span class="st">"pct_of_revenue"</span>] <span class="op">=</span> np.nan</span>
<span id="cb7-183"><a href="#cb7-183"></a><span class="co"># so that the data scale looks better</span></span>
<span id="cb7-184"><a href="#cb7-184"></a></span>
<span id="cb7-185"><a href="#cb7-185"></a>pl_data <span class="op">=</span> pl.from_pandas(data)</span>
<span id="cb7-186"><a href="#cb7-186"></a></span>
<span id="cb7-187"><a href="#cb7-187"></a>(</span>
<span id="cb7-188"><a href="#cb7-188"></a>  GT(pl_data, rowname_col<span class="op">=</span><span class="st">"tier"</span>)</span>
<span id="cb7-189"><a href="#cb7-189"></a>  .tab_header(title<span class="op">=</span>md(<span class="st">"&lt;strong&gt;New client tier share&lt;/strong&gt;"</span>))</span>
<span id="cb7-190"><a href="#cb7-190"></a>  .opt_align_table_header(align<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb7-191"><a href="#cb7-191"></a>  .tab_source_note(source_note<span class="op">=</span><span class="st">"Figure 2.1d: Table with data bar"</span>)</span>
<span id="cb7-192"><a href="#cb7-192"></a>  .cols_label(</span>
<span id="cb7-193"><a href="#cb7-193"></a>    tier <span class="op">=</span> <span class="st">"Tier"</span>,</span>
<span id="cb7-194"><a href="#cb7-194"></a>    no_of_account <span class="op">=</span> <span class="st">"# of Accounts"</span>,</span>
<span id="cb7-195"><a href="#cb7-195"></a>    pct_of_account <span class="op">=</span> <span class="st">"% Accounts"</span>,</span>
<span id="cb7-196"><a href="#cb7-196"></a>    revenue <span class="op">=</span> <span class="st">"($M) Revenue"</span>, <span class="co"># change the label</span></span>
<span id="cb7-197"><a href="#cb7-197"></a>    pct_of_revenue <span class="op">=</span> <span class="st">"% Revenue"</span></span>
<span id="cb7-198"><a href="#cb7-198"></a>  )</span>
<span id="cb7-199"><a href="#cb7-199"></a>  .fmt_number(columns<span class="op">=</span><span class="st">"no_of_account"</span>,decimals<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb7-200"><a href="#cb7-200"></a>  .fmt_currency(columns <span class="op">=</span> <span class="st">"revenue"</span>, currency<span class="op">=</span><span class="st">"USD"</span>, decimals<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb7-201"><a href="#cb7-201"></a>  .fmt_percent(columns<span class="op">=</span>[<span class="st">"pct_of_account"</span>, <span class="st">"pct_of_revenue"</span>], decimals<span class="op">=</span><span class="dv">0</span>) <span class="co"># changed decimals</span></span>
<span id="cb7-202"><a href="#cb7-202"></a>  .cols_width(</span>
<span id="cb7-203"><a href="#cb7-203"></a>    cases<span class="op">=</span>{</span>
<span id="cb7-204"><a href="#cb7-204"></a>        <span class="st">"tier"</span>: <span class="st">"20%"</span>,</span>
<span id="cb7-205"><a href="#cb7-205"></a>        <span class="st">"no_of_account"</span>: <span class="st">"20%"</span>,</span>
<span id="cb7-206"><a href="#cb7-206"></a>        <span class="st">"pct_of_account"</span>: <span class="st">"20%"</span>,</span>
<span id="cb7-207"><a href="#cb7-207"></a>        <span class="st">"revenue"</span>: <span class="st">"20%"</span>,</span>
<span id="cb7-208"><a href="#cb7-208"></a>        <span class="st">"pct_of_revenue"</span>: <span class="st">"20%"</span>      </span>
<span id="cb7-209"><a href="#cb7-209"></a>    }</span>
<span id="cb7-210"><a href="#cb7-210"></a>    )</span>
<span id="cb7-211"><a href="#cb7-211"></a>  .fmt_nanoplot(</span>
<span id="cb7-212"><a href="#cb7-212"></a>    columns<span class="op">=</span><span class="st">"pct_of_account"</span>,</span>
<span id="cb7-213"><a href="#cb7-213"></a>    rows <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>],</span>
<span id="cb7-214"><a href="#cb7-214"></a>    plot_type<span class="op">=</span><span class="st">"bar"</span>,</span>
<span id="cb7-215"><a href="#cb7-215"></a>    plot_height <span class="op">=</span> <span class="st">"3em"</span>,</span>
<span id="cb7-216"><a href="#cb7-216"></a>    autoscale<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb7-217"><a href="#cb7-217"></a>    options<span class="op">=</span>nanoplot_options(</span>
<span id="cb7-218"><a href="#cb7-218"></a>      data_bar_stroke_color<span class="op">=</span><span class="st">"#577B8D"</span>,</span>
<span id="cb7-219"><a href="#cb7-219"></a>      data_bar_stroke_width<span class="op">=</span><span class="dv">80</span>,</span>
<span id="cb7-220"><a href="#cb7-220"></a>      data_bar_fill_color<span class="op">=</span><span class="st">"#577B8D"</span>,)</span>
<span id="cb7-221"><a href="#cb7-221"></a>    )</span>
<span id="cb7-222"><a href="#cb7-222"></a>  .fmt_nanoplot(</span>
<span id="cb7-223"><a href="#cb7-223"></a>    columns<span class="op">=</span><span class="st">"pct_of_revenue"</span>,</span>
<span id="cb7-224"><a href="#cb7-224"></a>    rows <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>],</span>
<span id="cb7-225"><a href="#cb7-225"></a>    plot_type<span class="op">=</span><span class="st">"bar"</span>,</span>
<span id="cb7-226"><a href="#cb7-226"></a>    plot_height <span class="op">=</span> <span class="st">"3em"</span>,</span>
<span id="cb7-227"><a href="#cb7-227"></a>    autoscale<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb7-228"><a href="#cb7-228"></a>    options<span class="op">=</span>nanoplot_options(</span>
<span id="cb7-229"><a href="#cb7-229"></a>      data_bar_stroke_color<span class="op">=</span><span class="st">"#577B8D"</span>,</span>
<span id="cb7-230"><a href="#cb7-230"></a>      data_bar_stroke_width<span class="op">=</span><span class="dv">80</span>,</span>
<span id="cb7-231"><a href="#cb7-231"></a>      data_bar_fill_color<span class="op">=</span><span class="st">"#577B8D"</span>,)</span>
<span id="cb7-232"><a href="#cb7-232"></a>  )</span>
<span id="cb7-233"><a href="#cb7-233"></a>  .tab_style(</span>
<span id="cb7-234"><a href="#cb7-234"></a>        style<span class="op">=</span>[</span>
<span id="cb7-235"><a href="#cb7-235"></a>          style.text(style<span class="op">=</span><span class="st">"bolder"</span>),</span>
<span id="cb7-236"><a href="#cb7-236"></a>          style.fill(<span class="st">"#EEEEEE"</span>),</span>
<span id="cb7-237"><a href="#cb7-237"></a>          style.borders(sides<span class="op">=</span>[<span class="st">"top"</span>, <span class="st">"bottom"</span>], weight<span class="op">=</span><span class="st">'2px'</span>, color<span class="op">=</span><span class="st">"grey"</span>)</span>
<span id="cb7-238"><a href="#cb7-238"></a>          ],</span>
<span id="cb7-239"><a href="#cb7-239"></a>        locations<span class="op">=</span>loc.body(rows<span class="op">=</span>[<span class="dv">6</span>])</span>
<span id="cb7-240"><a href="#cb7-240"></a>  )</span>
<span id="cb7-241"><a href="#cb7-241"></a>  .tab_style(</span>
<span id="cb7-242"><a href="#cb7-242"></a>        style<span class="op">=</span>[</span>
<span id="cb7-243"><a href="#cb7-243"></a>          style.text(color<span class="op">=</span><span class="st">"#EEEEEE"</span>, size<span class="op">=</span><span class="fl">0.5</span>),</span>
<span id="cb7-244"><a href="#cb7-244"></a>          ],</span>
<span id="cb7-245"><a href="#cb7-245"></a>        locations<span class="op">=</span>loc.body(rows<span class="op">=</span>[<span class="dv">6</span>], columns<span class="op">=</span>[<span class="st">"pct_of_account"</span>, <span class="st">"pct_of_revenue"</span>])</span>
<span id="cb7-246"><a href="#cb7-246"></a>  )</span>
<span id="cb7-247"><a href="#cb7-247"></a>  .opt_stylize(style<span class="op">=</span><span class="dv">3</span> ,color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb7-248"><a href="#cb7-248"></a>)</span>
<span id="cb7-249"><a href="#cb7-249"></a><span class="in">```</span></span>
<span id="cb7-250"><a href="#cb7-250"></a></span>
<span id="cb7-251"><a href="#cb7-251"></a><span class="in">`great_tables`</span> vẫn chưa thực sự render ra được bảng biểu đúng như setting.</span>
<span id="cb7-252"><a href="#cb7-252"></a></span>
<span id="cb7-253"><a href="#cb7-253"></a>Bài thực hành đến đây là kết thúc! 🚀</span>
<span id="cb7-254"><a href="#cb7-254"></a></span>
<span id="cb7-255"><a href="#cb7-255"></a><span class="fu"># References</span></span>
<span id="cb7-256"><a href="#cb7-256"></a></span>
<span id="cb7-257"><a href="#cb7-257"></a><span class="ss">1.  </span><span class="ot">&lt;https://www.storytellingwithdata.com/books&gt;</span></span>
<span id="cb7-258"><a href="#cb7-258"></a><span class="ss">2.  </span><span class="ot">&lt;https://rpubs.com/chidungkt/1139405&gt;</span></span>
<span id="cb7-259"><a href="#cb7-259"></a><span class="ss">3.  </span><span class="ot">&lt;https://posit-dev.github.io/great-tables/articles/intro.html&gt;</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><span class="faux-block"><a href="https://creativecommons.org/licenses/by-nc-nd/4.0/"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i></a> 2023-2024 Le Khac Tuan</span></p>
</div>   
    <div class="nav-footer-center">
<p><span class="faux-block">Designed with <i class="fa-solid fa-heart" aria-label="heart"></i></span></p>
</div>
    <div class="nav-footer-right">
<p><span class="faux-block">Made with <a href="https://quarto.org/">Quarto</a></span> <span class="faux-block"><a href="https://github.com/lktuan/lktuan.github.io">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></span></p>
</div>
  </div>
</footer>




</body></html>