<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tuan Le Khac">
<meta name="dcterms.date" content="2024-07-17">
<meta name="description" content="I am a Risk Modeler üöÄ">

<title>Le Khac Tuan - A Prefect Workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../img/rocket_1613268.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="html/styles.scss">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Le Khac Tuan</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about/index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../curriculum/index.html"> 
<span class="menu-text">Curriculum</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../Â≠¶Ê±âËØ≠ÁöÑÊó•ËÆ∞.html"> 
<span class="menu-text">Â≠¶Ê±âËØ≠ÁöÑÊó•ËÆ∞</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/lktuan"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/tuanlekhac/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.facebook.com/toilatuan.lk/"> <i class="bi bi-facebook" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:tuan.lekhac0905@gmail.com"> <i class="bi bi-envelope" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">A Prefect Workshop</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          by Dr.&nbsp;Adam Hill in PyData London 2024
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">python</div>
                <div class="quarto-category">pydata</div>
                <div class="quarto-category">prefect</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://lktuan.github.io/">Tuan Le Khac</a> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 17, 2024</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">July 17, 2024</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#goals" id="toc-goals" class="nav-link active" data-scroll-target="#goals">goals</a></li>
  <li><a href="#prefect-overview" id="toc-prefect-overview" class="nav-link" data-scroll-target="#prefect-overview">prefect overview</a></li>
  <li><a href="#jump-to-the-workshop" id="toc-jump-to-the-workshop" class="nav-link" data-scroll-target="#jump-to-the-workshop">jump to the workshop</a>
  <ul class="collapse">
  <li><a href="#e01-my-first-flow" id="toc-e01-my-first-flow" class="nav-link" data-scroll-target="#e01-my-first-flow">e01 my first flow</a></li>
  <li><a href="#e02a-sentiment-pipeline-v1" id="toc-e02a-sentiment-pipeline-v1" class="nav-link" data-scroll-target="#e02a-sentiment-pipeline-v1">e02a sentiment pipeline v1</a></li>
  <li><a href="#e02b-sentiment-pipeline-v2" id="toc-e02b-sentiment-pipeline-v2" class="nav-link" data-scroll-target="#e02b-sentiment-pipeline-v2">e02b sentiment pipeline v2</a></li>
  <li><a href="#e03a-kafka-tweet-publisher" id="toc-e03a-kafka-tweet-publisher" class="nav-link" data-scroll-target="#e03a-kafka-tweet-publisher">e03a kafka tweet publisher</a></li>
  <li><a href="#e03b-kafka-tweet-deployment" id="toc-e03b-kafka-tweet-deployment" class="nav-link" data-scroll-target="#e03b-kafka-tweet-deployment">e03b kafka tweet deployment</a></li>
  <li><a href="#e04-sentiment-pipeline-v3" id="toc-e04-sentiment-pipeline-v3" class="nav-link" data-scroll-target="#e04-sentiment-pipeline-v3">e04 sentiment pipeline v3</a></li>
  </ul></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading">further reading</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>üéû Video source: <a href="https://www.youtube.com/watch?v=yIDBsHwTaa8&amp;list=PLGVZCDnMOq0rrhYTNedKKuJ9716fEaAdK&amp;index=4">Dr.&nbsp;Adam Hill - Empower Your Projects with Prefect‚Äôs Pipeline Magic | PyData London 2024</a></p>
<p>‚õè Github repo: <a href="https://github.com/Cadarn/PyData-Prefect-Workshop" class="uri">https://github.com/Cadarn/PyData-Prefect-Workshop</a></p>
<section id="goals" class="level1">
<h1>goals</h1>
<p>by end of this session you will:</p>
<ul>
<li>understand what Prefect is;</li>
<li>build and execute tasks and flows;</li>
<li>have schedules flow using deployment;</li>
<li>have a grasp what else can be done;</li>
<li>have some fun.</li>
</ul>
</section>
<section id="prefect-overview" class="level1">
<h1>prefect overview</h1>
<p>just simple as using jupyter notebook, you only need to use decorators (<code>@task</code> and <code>@flow</code>) to designate functions as <strong>task</strong> for <strong>flow</strong>. you need to breakdown your ‚Äúnotebook‚Äù into ‚Äúcode chunks‚Äù and organize to get them done.</p>
<div id="3aa32d45" class="cell" data-execution_count="1">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">from</span> prefect <span class="im">import</span> task, flow</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="at">@task</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">def</span> my_task():</span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="bu">print</span>(<span class="st">"hello, i am a task!"</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="at">@flow</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="kw">def</span> my_flow():</span>
<span id="cb1-9"><a href="#cb1-9"></a>  my_task()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="jump-to-the-workshop" class="level1">
<h1>jump to the workshop</h1>
<p>clone the repo, have docker compose up and running. then explore <code>http://localhost:8000/get_tweet</code>, this is shown which i have yet no idea:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="dt">"tweet_id"</span><span class="fu">:</span> <span class="dv">570306133677760500</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="dt">"airline_sentiment"</span><span class="fu">:</span> <span class="st">"neutral"</span><span class="fu">,</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="dt">"airline_sentiment_confidence"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="dt">"airline"</span><span class="fu">:</span> <span class="st">"Virgin America"</span><span class="fu">,</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>  <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"cairdin"</span><span class="fu">,</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>  <span class="dt">"text"</span><span class="fu">:</span> <span class="st">"@VirginAmerica What @dhepburn said."</span><span class="fu">,</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>  <span class="dt">"retweet_count"</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>  <span class="dt">"tweet_timestamp"</span><span class="fu">:</span> <span class="st">"2015-02-24T11:35:52-08:00"</span><span class="fu">,</span></span>
<span id="cb2-10"><a href="#cb2-10"></a>  <span class="dt">"tweet_coord"</span><span class="fu">:</span> <span class="dv">-1</span><span class="fu">,</span></span>
<span id="cb2-11"><a href="#cb2-11"></a>  <span class="dt">"loop"</span><span class="fu">:</span> <span class="dv">1</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>the first thing you need to do is telling where the Prefect API is gonna live. currently it runs on free tier of the their cloud server (?) and now we config it to run in the localhost (?):</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"></a><span class="ex">prefect</span> config set PREFECT_API_URL=<span class="st">"http://127.0.0.1:4200/api"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>then we gonna reset the database, do some config then can start the server. please note that if you are using window, you need to add <code>Scripts</code> variable to environment variables also, the value of the path can be found when you install Prefect by <code>pip</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1"></a><span class="ex">prefect</span> server database reset <span class="at">-y</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="ex">prefect</span> config set PREFECT_API_DATABASE_CONNECTION_URL=<span class="st">"postgresql+asyncpg://postgres:password@localhost:5432/prefect_server"</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="ex">prefect</span> config view <span class="at">--show-sources</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="ex">prefect</span> server start</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>below is my initial dashboard, there is nothing!</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="1">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="initial_prefect_server.png" class="img-fluid figure-img"></p>
<figcaption>Prefect Dashboard</figcaption>
</figure>
</div>
</div>
</div>
</div>
<section id="e01-my-first-flow" class="level2">
<h2 class="anchored" data-anchor-id="e01-my-first-flow">e01 my first flow</h2>
<p>the basic component of prefect is <code>task</code> and <code>flow</code>. these are decorators to funtions we want to run. we can name and log easily:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>e01.py</strong></pre>
</div>
<div class="sourceCode" id="cb5" data-filename="e01.py"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Example of processing some data</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="im">from</span> prefect <span class="im">import</span> task, flow</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="at">@task</span>(name<span class="op">=</span><span class="st">"Addition operator"</span>)</span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="kw">def</span> add(a, b):</span>
<span id="cb5-7"><a href="#cb5-7"></a>    <span class="cf">return</span> a <span class="op">+</span> b</span>
<span id="cb5-8"><a href="#cb5-8"></a></span>
<span id="cb5-9"><a href="#cb5-9"></a></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="at">@task</span>(name<span class="op">=</span><span class="st">"Squaring operator"</span>)</span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="kw">def</span> square_num(num):</span>
<span id="cb5-12"><a href="#cb5-12"></a>    <span class="cf">if</span> <span class="va">True</span>:</span>
<span id="cb5-13"><a href="#cb5-13"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span></span>
<span id="cb5-14"><a href="#cb5-14"></a>    <span class="cf">return</span> num <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb5-15"><a href="#cb5-15"></a></span>
<span id="cb5-16"><a href="#cb5-16"></a></span>
<span id="cb5-17"><a href="#cb5-17"></a><span class="at">@flow</span>(log_prints<span class="op">=</span><span class="va">True</span>, name<span class="op">=</span><span class="st">"My first simple flow"</span>)</span>
<span id="cb5-18"><a href="#cb5-18"></a><span class="kw">def</span> add_and_square(a: <span class="bu">int</span> <span class="op">=</span> <span class="dv">2</span>, b: <span class="bu">int</span> <span class="op">=</span> <span class="dv">3</span>):</span>
<span id="cb5-19"><a href="#cb5-19"></a>    add_result <span class="op">=</span> add(a, b)</span>
<span id="cb5-20"><a href="#cb5-20"></a>    square_result <span class="op">=</span> square_num(add_result)</span>
<span id="cb5-21"><a href="#cb5-21"></a>    <span class="bu">print</span>(<span class="ss">f"(</span><span class="sc">{</span>a<span class="sc">}</span><span class="ss"> + </span><span class="sc">{</span>b<span class="sc">}</span><span class="ss">) squared = </span><span class="sc">{</span>square_result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-22"><a href="#cb5-22"></a></span>
<span id="cb5-23"><a href="#cb5-23"></a></span>
<span id="cb5-24"><a href="#cb5-24"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb5-25"><a href="#cb5-25"></a>    add_and_square(<span class="dv">4</span>, <span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="e02a-sentiment-pipeline-v1" class="level2">
<h2 class="anchored" data-anchor-id="e02a-sentiment-pipeline-v1">e02a sentiment pipeline v1</h2>
</section>
<section id="e02b-sentiment-pipeline-v2" class="level2">
<h2 class="anchored" data-anchor-id="e02b-sentiment-pipeline-v2">e02b sentiment pipeline v2</h2>
</section>
<section id="e03a-kafka-tweet-publisher" class="level2">
<h2 class="anchored" data-anchor-id="e03a-kafka-tweet-publisher">e03a kafka tweet publisher</h2>
</section>
<section id="e03b-kafka-tweet-deployment" class="level2">
<h2 class="anchored" data-anchor-id="e03b-kafka-tweet-deployment">e03b kafka tweet deployment</h2>
</section>
<section id="e04-sentiment-pipeline-v3" class="level2">
<h2 class="anchored" data-anchor-id="e04-sentiment-pipeline-v3">e04 sentiment pipeline v3</h2>
</section>
</section>
<section id="further-reading" class="level1">
<h1>further reading</h1>
<ol type="1">
<li><a href="https://www.reddit.com/r/dataengineering/comments/oqbiiu/airflow_vs_prefect/">Prefect vs Airflow on Reddit</a></li>
</ol>
<p>B√¨nh lu·∫≠n b·ªüi <strong>u/alexisprince</strong>:</p>
<blockquote class="blockquote">
<p>T√¥i ƒëang s·ª≠ d·ª•ng song song Airflow v√† Prefect (A cho scheduling, P cho execution), P ƒë∆∞·ª£c s·ª≠ d·ª•ng khi y√™u c·∫ßu v·ªÅ hi·ªáu nƒÉng t√≠nh to√°n v√† ph·∫ßn scheduler c·ªßa A v·∫´n ch∆∞a th·ªÉ b·ªã thay th·∫ø.</p>
<p>L·ª£i th·∫ø c·ªßa A l√† ƒë√£ qu√° ph·ªï bi·∫øn, d·ªÖ t√¨m h∆∞·ªõng d·∫´n, d·ªÖ tuy·ªÉn ng∆∞·ªùi cho chuy√™n m√¥n. Y·∫øu ƒëi·ªÉm l√† A ƒë√£ qu√° c≈©, kh√¥ng c√≤n ph√π h·ª£p cho dynamic workflow v√† modern data env. H∆°n n·ªØa A lu√¥n best fit khi s·ª≠ d·ª•ng chung v·ªõi Astronomer, ngo√†i ra kh√° kh√≥ d√πng.</p>
<p>P hi·ªán ƒë·∫°i h∆°n, cung c·∫•p nhi·ªÅu modern execution models, DAG ƒë∆∞·ª£c x√°c ƒë·ªãnh t·∫°i runtime do ƒë√≥ dynamic h∆°n.</p>
<p>Prefer P h∆°n, better modularization of code.</p>
</blockquote>
<p>B√¨nh lu·∫≠n b·ªüi <strong>u/ChrisHC05</strong>:</p>
<blockquote class="blockquote">
<p>Tao ƒë√£ ƒë√°nh gi√° Airflow, Dagster, Argo v√† Prefect m·∫•y th√°ng nay.</p>
<p>Airflow th√¨ ƒë√£ gi√†, tuy nhi√™n t√†i li·ªáu, h∆∞·ªõng d·∫´n r·∫•t phong ph√∫.</p>
<p>Dagster c√≥ v·∫ª g·∫∑p nhi·ªÅu v·∫•n ƒë·ªÅ v·ªõi Production.</p>
<p>Prefect c√≥ c·ªông ƒë·ªìng ph√°t tri·ªÉn, support, s·ª≠a l·ªói active.</p>
<p>V·∫≠y n√™n t√¥i ch·ªâ ƒë√°nh gi√° cao hai th·∫±ng Argo v√† Prefect. Argo kh√°c bi·ªát m·ªôt c√°ch m·∫°nh m·∫Ω, config ƒë∆∞·ª£c vi·∫øt d∆∞·ªõi d·∫°ng YAML, ch·∫°y tr√™n c·ª•m Kubernetes, v√† vi·ªác vi·∫øt DAG kh√¥ng ph·ª• thu·ªôc v√†o m·ªôt ng√¥n ng·ªØ l·∫≠p tr√¨nh n√†o. Argo (t·∫°i th·ªùi ƒëi·ªÉm ƒë√≥) c≈©ng ƒëang ph√°t tri·ªÉn m·ªôt module ki·ªÉu event listening, from outside, nh∆∞ Sensor c·ªßa Airflow, th·ª© m√† Prefect thi·∫øu (workaround l√† call Prefect GraphQL-API).</p>
<p>N·∫øu ƒë√£ c√≥ s·∫µn infra l√† K8S, khuy·∫øn ngh·ªã Argo, kh√¥ng ch·ªâ l√† orchestration m√† c√≤n l√† m·ªôt h·ªá sinh th√°i support t·ª´ event responding t·ªõi CI/CD. Nh∆∞ng learning curve th√¨ steep nh√©. N√≥ c√≥ nhi·ªÅu ti·ªÅm nƒÉng v√¨ gi·ªù th√¨ ph·∫ßn m·ªÅm n√†o c≈©ng c·∫ßn dockerized c·∫£, t√≠nh tr·ª´u t∆∞·ª£ng cao h∆°n. ‚ÄúAnd IT in general is all about abstraction to make complicated things easier.‚Äù</p>
<p>V·∫≠y n√™n:</p>
<ul>
<li>N·∫øu c√≥ s·∫µn c·ª•m K8S: d√πng Argo</li>
<li>N·∫øu kh√¥ng: d√πng Prefect</li>
</ul>
</blockquote>
<ol start="2" type="1">
<li><a href="https://www.youtube.com/watch?v=XrZegcm1ftw">Airflow Vs. Prefect: Full Breakdown! by The Data Guy</a></li>
<li><a href="https://www.horsewithapointyhat.com/posts/being-a-data-scientist-in-a-post-truth-world/">Adam Hill‚Äôs blog</a></li>
</ol>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/lktuan\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb6" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">---</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="an">title:</span><span class="co"> "A Prefect Workshop"</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="an">description:</span><span class="co"> "by Dr. Adam Hill in PyData London 2024"</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="an">author:</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">  - name: "Tuan Le Khac"</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">    url: https://lktuan.github.io/</span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="an">categories:</span><span class="co"> [python, pydata, prefect] </span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="an">date:</span><span class="co"> 07-17-2024</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="an">date-modified:</span><span class="co"> 07-17-2024</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="an">image:</span><span class="co"> adam_hill.png</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="an">code-tools:</span><span class="co"> true</span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="an">code-fold:</span><span class="co"> show</span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="an">code-annotations:</span><span class="co"> hover</span></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="an">draft:</span><span class="co"> false</span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="an">css:</span><span class="co"> html/styles.scss</span></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="an">fig-cap-location:</span><span class="co"> bottom</span></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="an">format:</span></span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="co">  html:</span></span>
<span id="cb6-20"><a href="#cb6-20"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb6-21"><a href="#cb6-21"></a><span class="co">---</span></span>
<span id="cb6-22"><a href="#cb6-22"></a></span>
<span id="cb6-23"><a href="#cb6-23"></a>üéû Video source: <span class="co">[</span><span class="ot">Dr. Adam Hill - Empower Your Projects with Prefect's Pipeline Magic | PyData London 2024</span><span class="co">](https://www.youtube.com/watch?v=yIDBsHwTaa8&amp;list=PLGVZCDnMOq0rrhYTNedKKuJ9716fEaAdK&amp;index=4)</span></span>
<span id="cb6-24"><a href="#cb6-24"></a></span>
<span id="cb6-25"><a href="#cb6-25"></a>‚õè Github repo: <span class="ot">&lt;https://github.com/Cadarn/PyData-Prefect-Workshop&gt;</span></span>
<span id="cb6-26"><a href="#cb6-26"></a></span>
<span id="cb6-27"><a href="#cb6-27"></a><span class="fu"># goals</span></span>
<span id="cb6-28"><a href="#cb6-28"></a></span>
<span id="cb6-29"><a href="#cb6-29"></a>by end of this session you will:</span>
<span id="cb6-30"><a href="#cb6-30"></a></span>
<span id="cb6-31"><a href="#cb6-31"></a><span class="ss">- </span>understand what Prefect is;</span>
<span id="cb6-32"><a href="#cb6-32"></a><span class="ss">- </span>build and execute tasks and flows;</span>
<span id="cb6-33"><a href="#cb6-33"></a><span class="ss">- </span>have schedules flow using deployment;</span>
<span id="cb6-34"><a href="#cb6-34"></a><span class="ss">- </span>have a grasp what else can be done;</span>
<span id="cb6-35"><a href="#cb6-35"></a><span class="ss">- </span>have some fun.</span>
<span id="cb6-36"><a href="#cb6-36"></a></span>
<span id="cb6-37"><a href="#cb6-37"></a><span class="fu"># prefect overview</span></span>
<span id="cb6-38"><a href="#cb6-38"></a></span>
<span id="cb6-39"><a href="#cb6-39"></a>just simple as using jupyter notebook, you only need to use decorators (<span class="in">`@task`</span> and <span class="in">`@flow`</span>) to designate functions as **task** for **flow**. you need to breakdown your "notebook" into "code chunks" and organize to get them done.</span>
<span id="cb6-40"><a href="#cb6-40"></a></span>
<span id="cb6-43"><a href="#cb6-43"></a><span class="in">```{python}</span></span>
<span id="cb6-44"><a href="#cb6-44"></a><span class="co">#| eval: false </span></span>
<span id="cb6-45"><a href="#cb6-45"></a></span>
<span id="cb6-46"><a href="#cb6-46"></a><span class="im">from</span> prefect <span class="im">import</span> task, flow</span>
<span id="cb6-47"><a href="#cb6-47"></a></span>
<span id="cb6-48"><a href="#cb6-48"></a><span class="at">@task</span></span>
<span id="cb6-49"><a href="#cb6-49"></a><span class="kw">def</span> my_task():</span>
<span id="cb6-50"><a href="#cb6-50"></a>  <span class="bu">print</span>(<span class="st">"hello, i am a task!"</span>)</span>
<span id="cb6-51"><a href="#cb6-51"></a></span>
<span id="cb6-52"><a href="#cb6-52"></a><span class="at">@flow</span></span>
<span id="cb6-53"><a href="#cb6-53"></a><span class="kw">def</span> my_flow():</span>
<span id="cb6-54"><a href="#cb6-54"></a>  my_task()</span>
<span id="cb6-55"><a href="#cb6-55"></a><span class="in">```</span></span>
<span id="cb6-56"><a href="#cb6-56"></a></span>
<span id="cb6-57"><a href="#cb6-57"></a><span class="fu"># jump to the workshop</span></span>
<span id="cb6-58"><a href="#cb6-58"></a></span>
<span id="cb6-59"><a href="#cb6-59"></a>clone the repo, have docker compose up and running. then explore <span class="in">`http://localhost:8000/get_tweet`</span>, this is shown which i have yet no idea:</span>
<span id="cb6-60"><a href="#cb6-60"></a></span>
<span id="cb6-61"><a href="#cb6-61"></a><span class="in">```json</span></span>
<span id="cb6-62"><a href="#cb6-62"></a><span class="fu">{</span></span>
<span id="cb6-63"><a href="#cb6-63"></a>  <span class="dt">"tweet_id"</span><span class="fu">:</span> <span class="dv">570306133677760500</span><span class="fu">,</span></span>
<span id="cb6-64"><a href="#cb6-64"></a>  <span class="dt">"airline_sentiment"</span><span class="fu">:</span> <span class="st">"neutral"</span><span class="fu">,</span></span>
<span id="cb6-65"><a href="#cb6-65"></a>  <span class="dt">"airline_sentiment_confidence"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb6-66"><a href="#cb6-66"></a>  <span class="dt">"airline"</span><span class="fu">:</span> <span class="st">"Virgin America"</span><span class="fu">,</span></span>
<span id="cb6-67"><a href="#cb6-67"></a>  <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"cairdin"</span><span class="fu">,</span></span>
<span id="cb6-68"><a href="#cb6-68"></a>  <span class="dt">"text"</span><span class="fu">:</span> <span class="st">"@VirginAmerica What @dhepburn said."</span><span class="fu">,</span></span>
<span id="cb6-69"><a href="#cb6-69"></a>  <span class="dt">"retweet_count"</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb6-70"><a href="#cb6-70"></a>  <span class="dt">"tweet_timestamp"</span><span class="fu">:</span> <span class="st">"2015-02-24T11:35:52-08:00"</span><span class="fu">,</span></span>
<span id="cb6-71"><a href="#cb6-71"></a>  <span class="dt">"tweet_coord"</span><span class="fu">:</span> <span class="dv">-1</span><span class="fu">,</span></span>
<span id="cb6-72"><a href="#cb6-72"></a>  <span class="dt">"loop"</span><span class="fu">:</span> <span class="dv">1</span></span>
<span id="cb6-73"><a href="#cb6-73"></a><span class="fu">}</span></span>
<span id="cb6-74"><a href="#cb6-74"></a><span class="in">```</span></span>
<span id="cb6-75"><a href="#cb6-75"></a></span>
<span id="cb6-76"><a href="#cb6-76"></a>the first thing you need to do is telling where the Prefect API is gonna live. currently it runs on free tier of the their cloud server (?) and now we config it to run in the localhost (?):</span>
<span id="cb6-77"><a href="#cb6-77"></a></span>
<span id="cb6-78"><a href="#cb6-78"></a><span class="in">```bash</span></span>
<span id="cb6-79"><a href="#cb6-79"></a><span class="ex">prefect</span> config set PREFECT_API_URL=<span class="st">"http://127.0.0.1:4200/api"</span></span>
<span id="cb6-80"><a href="#cb6-80"></a><span class="in">```</span></span>
<span id="cb6-81"><a href="#cb6-81"></a></span>
<span id="cb6-82"><a href="#cb6-82"></a>then we gonna reset the database, do some config then can start the server. please note that if you are using window, you need to add <span class="in">`Scripts`</span> variable to environment variables also, the value of the path can be found when you install Prefect by <span class="in">`pip`</span>:</span>
<span id="cb6-83"><a href="#cb6-83"></a></span>
<span id="cb6-84"><a href="#cb6-84"></a><span class="in">```bash</span></span>
<span id="cb6-85"><a href="#cb6-85"></a><span class="ex">prefect</span> server database reset <span class="at">-y</span></span>
<span id="cb6-86"><a href="#cb6-86"></a><span class="ex">prefect</span> config set PREFECT_API_DATABASE_CONNECTION_URL=<span class="st">"postgresql+asyncpg://postgres:password@localhost:5432/prefect_server"</span></span>
<span id="cb6-87"><a href="#cb6-87"></a><span class="ex">prefect</span> config view <span class="at">--show-sources</span></span>
<span id="cb6-88"><a href="#cb6-88"></a><span class="ex">prefect</span> server start</span>
<span id="cb6-89"><a href="#cb6-89"></a><span class="in">```</span></span>
<span id="cb6-90"><a href="#cb6-90"></a></span>
<span id="cb6-91"><a href="#cb6-91"></a>below is my initial dashboard, there is nothing!</span>
<span id="cb6-92"><a href="#cb6-92"></a></span>
<span id="cb6-93"><a href="#cb6-93"></a>:::{layout-ncol="1"}</span>
<span id="cb6-94"><a href="#cb6-94"></a><span class="al">![Prefect Dashboard](initial_prefect_server.png)</span></span>
<span id="cb6-95"><a href="#cb6-95"></a>:::</span>
<span id="cb6-96"><a href="#cb6-96"></a></span>
<span id="cb6-97"><a href="#cb6-97"></a><span class="fu">## e01 my first flow</span></span>
<span id="cb6-98"><a href="#cb6-98"></a></span>
<span id="cb6-99"><a href="#cb6-99"></a>the basic component of prefect is <span class="in">`task`</span> and <span class="in">`flow`</span>. these are decorators to funtions we want to run. we can name and log easily:</span>
<span id="cb6-100"><a href="#cb6-100"></a></span>
<span id="cb6-101"><a href="#cb6-101"></a><span class="in">```{.python filename="e01.py"}</span></span>
<span id="cb6-102"><a href="#cb6-102"></a><span class="in">from prefect import task, flow</span></span>
<span id="cb6-103"><a href="#cb6-103"></a></span>
<span id="cb6-104"><a href="#cb6-104"></a></span>
<span id="cb6-105"><a href="#cb6-105"></a><span class="in">@task(name="Addition operator")  # this task will successfully run</span></span>
<span id="cb6-106"><a href="#cb6-106"></a><span class="in">def add(a, b):</span></span>
<span id="cb6-107"><a href="#cb6-107"></a><span class="in">    return a + b</span></span>
<span id="cb6-108"><a href="#cb6-108"></a></span>
<span id="cb6-109"><a href="#cb6-109"></a></span>
<span id="cb6-110"><a href="#cb6-110"></a><span class="in">@task(name="Squaring operator")  # this task will fail</span></span>
<span id="cb6-111"><a href="#cb6-111"></a><span class="in">def square_num(num):</span></span>
<span id="cb6-112"><a href="#cb6-112"></a><span class="in">    if True:</span></span>
<span id="cb6-113"><a href="#cb6-113"></a><span class="in">        raise ValueError</span></span>
<span id="cb6-114"><a href="#cb6-114"></a><span class="in">    return num ** 2</span></span>
<span id="cb6-115"><a href="#cb6-115"></a></span>
<span id="cb6-116"><a href="#cb6-116"></a></span>
<span id="cb6-117"><a href="#cb6-117"></a><span class="in">@flow(log_prints=True,</span></span>
<span id="cb6-118"><a href="#cb6-118"></a><span class="in">      name="Add and Square",</span></span>
<span id="cb6-119"><a href="#cb6-119"></a><span class="in">      description="My first simple flow")</span></span>
<span id="cb6-120"><a href="#cb6-120"></a><span class="in">def add_and_square(a: int = 2, b: int = 3):</span></span>
<span id="cb6-121"><a href="#cb6-121"></a><span class="in">    add_result = add(a, b)</span></span>
<span id="cb6-122"><a href="#cb6-122"></a><span class="in">    square_result = square_num(add_result)</span></span>
<span id="cb6-123"><a href="#cb6-123"></a><span class="in">    print(f"({a} + {b}) squared = {square_result}")</span></span>
<span id="cb6-124"><a href="#cb6-124"></a></span>
<span id="cb6-125"><a href="#cb6-125"></a></span>
<span id="cb6-126"><a href="#cb6-126"></a><span class="in">if __name__ == "__main__":</span></span>
<span id="cb6-127"><a href="#cb6-127"></a><span class="in">    add_and_square(4, 8)</span></span>
<span id="cb6-128"><a href="#cb6-128"></a><span class="in">    </span></span>
<span id="cb6-129"><a href="#cb6-129"></a><span class="in">```</span></span>
<span id="cb6-130"><a href="#cb6-130"></a></span>
<span id="cb6-131"><a href="#cb6-131"></a><span class="fu">## e02a sentiment pipeline v1</span></span>
<span id="cb6-132"><a href="#cb6-132"></a></span>
<span id="cb6-133"><a href="#cb6-133"></a><span class="fu">## e02b sentiment pipeline v2</span></span>
<span id="cb6-134"><a href="#cb6-134"></a></span>
<span id="cb6-135"><a href="#cb6-135"></a><span class="fu">## e03a kafka tweet publisher</span></span>
<span id="cb6-136"><a href="#cb6-136"></a></span>
<span id="cb6-137"><a href="#cb6-137"></a><span class="fu">## e03b kafka tweet deployment</span></span>
<span id="cb6-138"><a href="#cb6-138"></a></span>
<span id="cb6-139"><a href="#cb6-139"></a><span class="fu">## e04 sentiment pipeline v3</span></span>
<span id="cb6-140"><a href="#cb6-140"></a></span>
<span id="cb6-141"><a href="#cb6-141"></a><span class="fu"># further reading</span></span>
<span id="cb6-142"><a href="#cb6-142"></a></span>
<span id="cb6-143"><a href="#cb6-143"></a><span class="ss">1. </span><span class="co">[</span><span class="ot">Prefect vs Airflow on Reddit</span><span class="co">](https://www.reddit.com/r/dataengineering/comments/oqbiiu/airflow_vs_prefect/)</span></span>
<span id="cb6-144"><a href="#cb6-144"></a></span>
<span id="cb6-145"><a href="#cb6-145"></a>B√¨nh lu·∫≠n b·ªüi **u/alexisprince**:</span>
<span id="cb6-146"><a href="#cb6-146"></a></span>
<span id="cb6-147"><a href="#cb6-147"></a><span class="at">&gt; T√¥i ƒëang s·ª≠ d·ª•ng song song Airflow v√† Prefect (A cho scheduling, P cho execution), P ƒë∆∞·ª£c s·ª≠ d·ª•ng khi y√™u c·∫ßu v·ªÅ hi·ªáu nƒÉng t√≠nh to√°n v√† ph·∫ßn scheduler c·ªßa A v·∫´n ch∆∞a th·ªÉ b·ªã thay th·∫ø.</span></span>
<span id="cb6-148"><a href="#cb6-148"></a><span class="at">&gt; </span></span>
<span id="cb6-149"><a href="#cb6-149"></a><span class="at">&gt; L·ª£i th·∫ø c·ªßa A l√† ƒë√£ qu√° ph·ªï bi·∫øn, d·ªÖ t√¨m h∆∞·ªõng d·∫´n, d·ªÖ tuy·ªÉn ng∆∞·ªùi cho chuy√™n m√¥n. Y·∫øu ƒëi·ªÉm l√† A ƒë√£ qu√° c≈©, kh√¥ng c√≤n ph√π h·ª£p cho dynamic workflow v√† modern data env. H∆°n n·ªØa A lu√¥n best fit khi s·ª≠ d·ª•ng chung v·ªõi Astronomer, ngo√†i ra kh√° kh√≥ d√πng.</span></span>
<span id="cb6-150"><a href="#cb6-150"></a><span class="at">&gt; </span></span>
<span id="cb6-151"><a href="#cb6-151"></a><span class="at">&gt; P hi·ªán ƒë·∫°i h∆°n, cung c·∫•p nhi·ªÅu modern execution models, DAG ƒë∆∞·ª£c x√°c ƒë·ªãnh t·∫°i runtime do ƒë√≥ dynamic h∆°n.</span></span>
<span id="cb6-152"><a href="#cb6-152"></a><span class="at">&gt; </span></span>
<span id="cb6-153"><a href="#cb6-153"></a><span class="at">&gt; Prefer P h∆°n, better modularization of code.</span></span>
<span id="cb6-154"><a href="#cb6-154"></a></span>
<span id="cb6-155"><a href="#cb6-155"></a>B√¨nh lu·∫≠n b·ªüi **u/ChrisHC05**:</span>
<span id="cb6-156"><a href="#cb6-156"></a></span>
<span id="cb6-157"><a href="#cb6-157"></a><span class="at">&gt; Tao ƒë√£ ƒë√°nh gi√° Airflow, Dagster, Argo v√† Prefect m·∫•y th√°ng nay.</span></span>
<span id="cb6-158"><a href="#cb6-158"></a><span class="at">&gt; </span></span>
<span id="cb6-159"><a href="#cb6-159"></a><span class="at">&gt; Airflow th√¨ ƒë√£ gi√†, tuy nhi√™n t√†i li·ªáu, h∆∞·ªõng d·∫´n r·∫•t phong ph√∫.</span></span>
<span id="cb6-160"><a href="#cb6-160"></a><span class="at">&gt; </span></span>
<span id="cb6-161"><a href="#cb6-161"></a><span class="at">&gt; Dagster c√≥ v·∫ª g·∫∑p nhi·ªÅu v·∫•n ƒë·ªÅ v·ªõi Production.</span></span>
<span id="cb6-162"><a href="#cb6-162"></a><span class="at">&gt; </span></span>
<span id="cb6-163"><a href="#cb6-163"></a><span class="at">&gt; Prefect c√≥ c·ªông ƒë·ªìng ph√°t tri·ªÉn, support, s·ª≠a l·ªói active.</span></span>
<span id="cb6-164"><a href="#cb6-164"></a><span class="at">&gt; </span></span>
<span id="cb6-165"><a href="#cb6-165"></a><span class="at">&gt; V·∫≠y n√™n t√¥i ch·ªâ ƒë√°nh gi√° cao hai th·∫±ng Argo v√† Prefect. Argo kh√°c bi·ªát m·ªôt c√°ch m·∫°nh m·∫Ω, config ƒë∆∞·ª£c vi·∫øt d∆∞·ªõi d·∫°ng YAML, ch·∫°y tr√™n c·ª•m Kubernetes, v√† vi·ªác vi·∫øt DAG kh√¥ng ph·ª• thu·ªôc v√†o m·ªôt ng√¥n ng·ªØ l·∫≠p tr√¨nh n√†o. Argo (t·∫°i th·ªùi ƒëi·ªÉm ƒë√≥) c≈©ng ƒëang ph√°t tri·ªÉn m·ªôt module ki·ªÉu event listening, from outside, nh∆∞ Sensor c·ªßa Airflow, th·ª© m√† Prefect thi·∫øu (workaround l√† call Prefect GraphQL-API).</span></span>
<span id="cb6-166"><a href="#cb6-166"></a><span class="at">&gt; </span></span>
<span id="cb6-167"><a href="#cb6-167"></a><span class="at">&gt; N·∫øu ƒë√£ c√≥ s·∫µn infra l√† K8S, khuy·∫øn ngh·ªã Argo, kh√¥ng ch·ªâ l√† orchestration m√† c√≤n l√† m·ªôt h·ªá sinh th√°i support t·ª´ event responding t·ªõi CI/CD. Nh∆∞ng learning curve th√¨ steep nh√©. N√≥ c√≥ nhi·ªÅu ti·ªÅm nƒÉng v√¨ gi·ªù th√¨ ph·∫ßn m·ªÅm n√†o c≈©ng c·∫ßn dockerized c·∫£, t√≠nh tr·ª´u t∆∞·ª£ng cao h∆°n. "And IT in general is all about abstraction to make complicated things easier."</span></span>
<span id="cb6-168"><a href="#cb6-168"></a><span class="at">&gt; </span></span>
<span id="cb6-169"><a href="#cb6-169"></a><span class="at">&gt; V·∫≠y n√™n:</span></span>
<span id="cb6-170"><a href="#cb6-170"></a><span class="at">&gt; </span></span>
<span id="cb6-171"><a href="#cb6-171"></a><span class="at">&gt; - N·∫øu c√≥ s·∫µn c·ª•m K8S: d√πng Argo</span></span>
<span id="cb6-172"><a href="#cb6-172"></a><span class="at">&gt; - N·∫øu kh√¥ng: d√πng Prefect</span></span>
<span id="cb6-173"><a href="#cb6-173"></a></span>
<span id="cb6-174"><a href="#cb6-174"></a><span class="ss">2. </span><span class="co">[</span><span class="ot">Airflow Vs. Prefect: Full Breakdown! by The Data Guy</span><span class="co">](https://www.youtube.com/watch?v=XrZegcm1ftw)</span></span>
<span id="cb6-175"><a href="#cb6-175"></a><span class="ss">3. </span><span class="co">[</span><span class="ot">Adam Hill's blog</span><span class="co">](https://www.horsewithapointyhat.com/posts/being-a-data-scientist-in-a-post-truth-world/)</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><span class="faux-block"><a href="https://creativecommons.org/licenses/by-nc-nd/4.0/"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i></a> 2023-2024 Le Khac Tuan</span></p>
</div>   
    <div class="nav-footer-center">
<p><span class="faux-block">Designed with <i class="fa-solid fa-heart" aria-label="heart"></i></span></p>
</div>
    <div class="nav-footer-right">
<p><span class="faux-block">Made with <a href="https://quarto.org/">Quarto</a></span> <span class="faux-block"><a href="https://github.com/lktuan/lktuan.github.io">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></span></p>
</div>
  </div>
</footer>




</body></html>