<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tuan Le Khac">
<meta name="dcterms.date" content="2025-02-12">
<meta name="description" content="This is Tuan’s blog">

<title>I completed 25 days of DAX (Friday) challenge, in 2 days! – Le Khac Tuan</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../img/rocket_1613268.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-8e54dfbe729680b42f22c627ac27a053.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-81b089a3b74ed4cf194f083418e7130b.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-89cb849060b93fd12025e4f44aaa3f02.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-94f6159ad9ce5d98e16f8a0f764f5363.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Le Khac Tuan</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about/index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../curriculum/index.html"> 
<span class="menu-text">Curriculum</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../学汉语的日记.html"> 
<span class="menu-text">学汉语的日记</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../jiu_jitsu_journal/index.html"> 
<span class="menu-text">Jiu Jitsu Journal</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/lktuan"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/tuanlekhac/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.facebook.com/toilatuan.lk/"> <i class="bi bi-facebook" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/Halle4231"> <i class="bi bi-twitter-x" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:tuan.lekhac0905@gmail.com"> <i class="bi bi-envelope" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">I completed 25 days of DAX (Friday) challenge, in 2 days!</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                  <div>
        <div class="description">
          by Curbal AB, Edition 3, on Northwind dataset
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">DAX</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://lktuan.github.io/">Tuan Le Khac</a> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 12, 2025</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">February 12, 2025</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#my-thought" id="toc-my-thought" class="nav-link active" data-scroll-target="#my-thought">My thought</a></li>
  <li><a href="#my-solution" id="toc-my-solution" class="nav-link" data-scroll-target="#my-solution">My solution</a>
  <ul class="collapse">
  <li><a href="#day-1-which-product-had-been-ordered-the-most-in-terms-of-quantity" id="toc-day-1-which-product-had-been-ordered-the-most-in-terms-of-quantity" class="nav-link" data-scroll-target="#day-1-which-product-had-been-ordered-the-most-in-terms-of-quantity">Day 1: Which product had been ordered the most (in terms of quantity) ?</a></li>
  <li><a href="#day-2-which-product-have-the-highest-average-order-size" id="toc-day-2-which-product-have-the-highest-average-order-size" class="nav-link" data-scroll-target="#day-2-which-product-have-the-highest-average-order-size">Day 2: Which product have the highest average order size?</a></li>
  <li><a href="#day-3-what-is-highest-average-discount-done-to-a-product" id="toc-day-3-what-is-highest-average-discount-done-to-a-product" class="nav-link" data-scroll-target="#day-3-what-is-highest-average-discount-done-to-a-product">Day 3: What is highest average discount done to a product?</a></li>
  <li><a href="#day-4-top3-categories-that-have-the-highest-revenue-contribution" id="toc-day-4-top3-categories-that-have-the-highest-revenue-contribution" class="nav-link" data-scroll-target="#day-4-top3-categories-that-have-the-highest-revenue-contribution">Day 4: Top3 categories that have the highest revenue contribution?</a></li>
  <li><a href="#day-5-average-price-of-discontinued-products" id="toc-day-5-average-price-of-discontinued-products" class="nav-link" data-scroll-target="#day-5-average-price-of-discontinued-products">Day 5: Average price of discontinued products?</a></li>
  <li><a href="#day-6-percentage-of-sales-from-discontinued-products" id="toc-day-6-percentage-of-sales-from-discontinued-products" class="nav-link" data-scroll-target="#day-6-percentage-of-sales-from-discontinued-products">Day 6: Percentage of sales from discontinued products?</a></li>
  <li><a href="#day-7-how-many-high-value-orders-were-placed-in-1997" id="toc-day-7-how-many-high-value-orders-were-placed-in-1997" class="nav-link" data-scroll-target="#day-7-how-many-high-value-orders-were-placed-in-1997">Day 7: How many high-value orders were placed in 1997?</a></li>
  <li><a href="#day-8-number-of-orders-delivered-on-time" id="toc-day-8-number-of-orders-delivered-on-time" class="nav-link" data-scroll-target="#day-8-number-of-orders-delivered-on-time">Day 8: Number of orders delivered on time?</a></li>
  <li><a href="#day-9-the-single-month-with-highest-sales" id="toc-day-9-the-single-month-with-highest-sales" class="nav-link" data-scroll-target="#day-9-the-single-month-with-highest-sales">Day 9: The single month with highest sales?</a></li>
  <li><a href="#day-10-best-sales-week-day-for-queso-cabrales" id="toc-day-10-best-sales-week-day-for-queso-cabrales" class="nav-link" data-scroll-target="#day-10-best-sales-week-day-for-queso-cabrales">Day 10: Best sales (week) day for queso cabrales?</a></li>
  <li><a href="#day-11-customer-with-the-highest-customer-lifespan" id="toc-day-11-customer-with-the-highest-customer-lifespan" class="nav-link" data-scroll-target="#day-11-customer-with-the-highest-customer-lifespan">Day 11: Customer with the highest customer lifespan?</a></li>
  <li><a href="#day-12-which-customer-had-placed-most-orders" id="toc-day-12-which-customer-had-placed-most-orders" class="nav-link" data-scroll-target="#day-12-which-customer-had-placed-most-orders">Day 12: Which customer had placed most orders?</a></li>
  <li><a href="#day-13-top-5-countries-with-the-highest-number-of-customers" id="toc-day-13-top-5-countries-with-the-highest-number-of-customers" class="nav-link" data-scroll-target="#day-13-top-5-countries-with-the-highest-number-of-customers">Day 13: Top 5 countries with the highest number of customers?</a></li>
  <li><a href="#day-14-which-customer-placed-the-highest-value-of-order-sales-in-1997" id="toc-day-14-which-customer-placed-the-highest-value-of-order-sales-in-1997" class="nav-link" data-scroll-target="#day-14-which-customer-placed-the-highest-value-of-order-sales-in-1997">Day 14: Which customer placed the highest value of order (sales) in 1997?</a></li>
  <li><a href="#day-15-customer-with-the-highest-number-of-orders-in-one-single-month" id="toc-day-15-customer-with-the-highest-number-of-orders-in-one-single-month" class="nav-link" data-scroll-target="#day-15-customer-with-the-highest-number-of-orders-in-one-single-month">Day 15: Customer with the highest number of orders in one single month?</a></li>
  <li><a href="#day-16-employee-with-the-highest-average-order-value-in-sales" id="toc-day-16-employee-with-the-highest-average-order-value-in-sales" class="nav-link" data-scroll-target="#day-16-employee-with-the-highest-average-order-value-in-sales">Day 16: Employee with the highest average order value (in sales)?</a></li>
  <li><a href="#day-17-employee-with-the-longest-average-processing-order-time" id="toc-day-17-employee-with-the-longest-average-processing-order-time" class="nav-link" data-scroll-target="#day-17-employee-with-the-longest-average-processing-order-time">Day 17: Employee with the longest average processing order time?</a></li>
  <li><a href="#day-18-which-employee-has-been-in-the-company-the-longest" id="toc-day-18-which-employee-has-been-in-the-company-the-longest" class="nav-link" data-scroll-target="#day-18-which-employee-has-been-in-the-company-the-longest">Day 18: Which employee has been in the company the longest?</a></li>
  <li><a href="#day-19-name-of-all-northwind-managers" id="toc-day-19-name-of-all-northwind-managers" class="nav-link" data-scroll-target="#day-19-name-of-all-northwind-managers">Day 19: Name of all Northwind managers?</a></li>
  <li><a href="#day-20-which-employee-handle-the-most-unique-customers" id="toc-day-20-which-employee-handle-the-most-unique-customers" class="nav-link" data-scroll-target="#day-20-which-employee-handle-the-most-unique-customers">Day 20: Which employee handle the most unique customers?</a></li>
  <li><a href="#day-21-number-of-suppliers-that-deliver-more-product-items-than-average" id="toc-day-21-number-of-suppliers-that-deliver-more-product-items-than-average" class="nav-link" data-scroll-target="#day-21-number-of-suppliers-that-deliver-more-product-items-than-average">Day 21: Number of suppliers that deliver more product items than average?</a></li>
  <li><a href="#day-22-suppliers-with-most-stocked-out-products" id="toc-day-22-suppliers-with-most-stocked-out-products" class="nav-link" data-scroll-target="#day-22-suppliers-with-most-stocked-out-products">Day 22: Suppliers with most stocked-out products?</a></li>
  <li><a href="#day-23-which-supplier-delivers-the-most-expensive-product" id="toc-day-23-which-supplier-delivers-the-most-expensive-product" class="nav-link" data-scroll-target="#day-23-which-supplier-delivers-the-most-expensive-product">Day 23: Which supplier delivers the most expensive product?</a></li>
  <li><a href="#day-24-which-supplier-has-the-highest-category-diversity" id="toc-day-24-which-supplier-has-the-highest-category-diversity" class="nav-link" data-scroll-target="#day-24-which-supplier-has-the-highest-category-diversity">Day 24: Which supplier has the highest category diversity?</a></li>
  <li><a href="#day-25-supplier-with-highest-number-of-top-5-selling-products" id="toc-day-25-supplier-with-highest-number-of-top-5-selling-products" class="nav-link" data-scroll-target="#day-25-supplier-with-highest-number-of-top-5-selling-products">Day 25: Supplier with highest number of top 5 selling products?</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="my-thought" class="level1">
<h1>My thought</h1>
<p>I did the challenge a couple of months after it closed, so all the solutions by Curbal were available. I practiced along with watching the solution, and asking LLMs (mostly Claude 3.5 Sonnet, and DeepSeek-R1) for advice on a calculation pattern, or to give a more efficient approach.</p>
<p>I am satisfied with the ability to solve around 50-60% myself as I am new to DAX.</p>
<p>Everything in DAX (Data, contexts, filters, aggregators, parameters, etc) are <strong>tables</strong>. I do not like the way Curbal always used <code>SUMMARIZE()</code> but the instruction of how can we drag variables to a <strong>table</strong> (as a pivot table), do some sorting, or export to Excel to understand to flow of calculation is good. Tips on working with DAX query view is also helpful.</p>
<p>What I do not like about DAX is there are <strong>several ways</strong> to achieve a calculation pattern, and actually we don’t need such many functions that DAX offers (see this <a href="https://www.linkedin.com/posts/brianjuliusdc_dax-nocalculate-rochesmaxim-activity-7294362624358567936-SgNC">post</a> from Brian Julius).</p>
<p>Anyway, I am now more confident with DAX. Happy learning!</p>
</section>
<section id="my-solution" class="level1">
<h1>My solution</h1>
<p><a href="https://github.com/lktuan/lktuan.github.io/tree/main/assets/20250210_25daysDAX_ed3_Northwind">Here</a> is my final file.</p>
<section id="day-1-which-product-had-been-ordered-the-most-in-terms-of-quantity" class="level2">
<h2 class="anchored" data-anchor-id="day-1-which-product-had-been-ordered-the-most-in-terms-of-quantity">Day 1: Which product had been ordered the most (in terms of quantity) ?</h2>
<p>View the data on DAX query view:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1"></a>EVALUATE</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">SUMMARIZE</span> (</span>
<span id="cb1-3"><a href="#cb1-3"></a>    Products<span class="op">,</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>    Products[ProductID]<span class="op">,</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>    Products[ProductName]<span class="op">,</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>    <span class="st">"Qty"</span><span class="op">,</span> <span class="fu">SUM</span> ( Order_Details[Quantity] )</span>
<span id="cb1-7"><a href="#cb1-7"></a>)</span>
<span id="cb1-8"><a href="#cb1-8"></a>ORDER BY [Qty] DESC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We need to get the <code>TOPN()</code> <strong>1</strong>, and then <code>CONCATENATE()</code> all products that have largest order quantities (there is such scenario):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1"></a>D1 <span class="op">=</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb2-3"><a href="#cb2-3"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb2-4"><a href="#cb2-4"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>        <span class="fu">SUMMARIZE</span> (</span>
<span id="cb2-6"><a href="#cb2-6"></a>            Products<span class="op">,</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>            Products[ProductID]<span class="op">,</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>            Products[ProductName]<span class="op">,</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>            <span class="st">"Qty"</span><span class="op">,</span> <span class="fu">SUM</span> ( Order_Details[Quantity] )</span>
<span id="cb2-10"><a href="#cb2-10"></a>        )<span class="op">,</span></span>
<span id="cb2-11"><a href="#cb2-11"></a>        [Qty]<span class="op">,</span> DESC</span>
<span id="cb2-12"><a href="#cb2-12"></a>    )<span class="op">,</span></span>
<span id="cb2-13"><a href="#cb2-13"></a>    Products[ProductName]<span class="op">,</span></span>
<span id="cb2-14"><a href="#cb2-14"></a>    <span class="st">", "</span><span class="op">,</span></span>
<span id="cb2-15"><a href="#cb2-15"></a>    Products[ProductName]<span class="op">,</span> ASC</span>
<span id="cb2-16"><a href="#cb2-16"></a>)</span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co">// Concat ProductName and order ascending by itself</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The answer is: “Camembert Pierrot”!</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>CONCATENATE()</code> return string so if we want to run it in DAX query view, use the <code>ROW()</code> function:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">ROW</span>(<span class="st">"Top sales products"</span><span class="op">,</span> </span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co">// measure D1</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="day-2-which-product-have-the-highest-average-order-size" class="level2">
<h2 class="anchored" data-anchor-id="day-2-which-product-have-the-highest-average-order-size">Day 2: Which product have the highest average order size?</h2>
<p>The average order size is calculated for each product based on the quantity of each order. We will first <code>SUMMARIZE()</code> to get distinct product and the average order quantity over Order Details table.</p>
<p>This time we will use the <code>ADDCOLUMNS()</code> to explicit the intention of adding more columns, which is more efficient (this is also a common pattern in DAX). Readmore: <a href="https://www.sqlbi.com/articles/best-practices-using-summarize-and-addcolumns/" class="uri">https://www.sqlbi.com/articles/best-practices-using-summarize-and-addcolumns/</a>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1"></a>D2 <span class="op">=</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb4-3"><a href="#cb4-3"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb4-4"><a href="#cb4-4"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>        <span class="fu">ADDCOLUMNS</span> (</span>
<span id="cb4-6"><a href="#cb4-6"></a>            <span class="fu">SUMMARIZE</span> ( Products<span class="op">,</span> Products[ProductID]<span class="op">,</span> Products[ProductName] )<span class="op">,</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>            <span class="st">"Avg qty"</span><span class="op">,</span> <span class="fu">CALCULATE</span> ( <span class="fu">AVERAGE</span> ( Order_Details[Quantity] ) )</span>
<span id="cb4-8"><a href="#cb4-8"></a>        )<span class="op">,</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>        [Avg qty]<span class="op">,</span> DESC</span>
<span id="cb4-10"><a href="#cb4-10"></a>    )<span class="op">,</span></span>
<span id="cb4-11"><a href="#cb4-11"></a>    Products[ProductName]<span class="op">,</span></span>
<span id="cb4-12"><a href="#cb4-12"></a>    <span class="st">", "</span><span class="op">,</span></span>
<span id="cb4-13"><a href="#cb4-13"></a>    Products[ProductName]<span class="op">,</span> ASC</span>
<span id="cb4-14"><a href="#cb4-14"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And the answer is: “Schoggi Schokolade”!</p>
</section>
<section id="day-3-what-is-highest-average-discount-done-to-a-product" class="level2">
<h2 class="anchored" data-anchor-id="day-3-what-is-highest-average-discount-done-to-a-product">Day 3: What is highest average discount done to a product?</h2>
<p>The solution is pretty similar to day 2, but this time we get the hight value instead of product name, we <code>FORMAT()</code> the value to text and select it by <code>SELECTCOLUMNS()</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1"></a>D3 <span class="op">=</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">SELECTCOLUMNS</span> (</span>
<span id="cb5-3"><a href="#cb5-3"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb5-4"><a href="#cb5-4"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>        <span class="fu">ADDCOLUMNS</span> (</span>
<span id="cb5-6"><a href="#cb5-6"></a>            <span class="fu">SUMMARIZE</span> ( Products<span class="op">,</span> Products[ProductID]<span class="op">,</span> Products[ProductName] )<span class="op">,</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>            <span class="st">"Avg discount"</span><span class="op">,</span> <span class="fu">CALCULATE</span> ( <span class="fu">AVERAGE</span> ( Order_Details[Discount] ) )</span>
<span id="cb5-8"><a href="#cb5-8"></a>        )<span class="op">,</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>        [Avg discount]<span class="op">,</span> DESC</span>
<span id="cb5-10"><a href="#cb5-10"></a>    )<span class="op">,</span></span>
<span id="cb5-11"><a href="#cb5-11"></a>    <span class="st">"Highest average"</span><span class="op">,</span> <span class="fu">FORMAT</span> ( [Avg discount]<span class="op">,</span> <span class="st">"0.00%"</span> )</span>
<span id="cb5-12"><a href="#cb5-12"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The answer is: “25.00%”!</p>
</section>
<section id="day-4-top3-categories-that-have-the-highest-revenue-contribution" class="level2">
<h2 class="anchored" data-anchor-id="day-4-top3-categories-that-have-the-highest-revenue-contribution">Day 4: Top3 categories that have the highest revenue contribution?</h2>
<p>We do not need to <code>DIVIDE()</code> as the solution provided by Curbal IMHO, it would be the same if we sort the absolute value.</p>
<p>We first create a measure to calculate the revenue post discount:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1"></a>Revenue after discount <span class="op">=</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="fu">SUMX</span> (</span>
<span id="cb6-3"><a href="#cb6-3"></a>    Order_Details<span class="op">,</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>    Order_Details[Quantity] <span class="op">*</span> Order_Details[UnitPrice] <span class="op">*</span> ( <span class="dv">1</span> <span class="op">-</span> Order_Details[Discount] )</span>
<span id="cb6-5"><a href="#cb6-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And everything remained the same to previous question! We should sort descending by the revenue in the concatenated output rather than category name to show them in informative order.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1"></a>D4 <span class="op">=</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb7-3"><a href="#cb7-3"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb7-4"><a href="#cb7-4"></a>        <span class="dv">3</span><span class="op">,</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>        <span class="fu">ADDCOLUMNS</span> (</span>
<span id="cb7-6"><a href="#cb7-6"></a>            <span class="fu">SUMMARIZE</span> ( Categories<span class="op">,</span> Categories[CategoryID]<span class="op">,</span> Categories[CategoryName] )<span class="op">,</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>            <span class="st">"Total revenue"</span><span class="op">,</span> <span class="fu">CALCULATE</span> ( [Revenue after discount] )</span>
<span id="cb7-8"><a href="#cb7-8"></a>        )<span class="op">,</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>        [Total revenue]<span class="op">,</span> DESC</span>
<span id="cb7-10"><a href="#cb7-10"></a>    )<span class="op">,</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>    Categories[CategoryName]<span class="op">,</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>    <span class="st">", "</span><span class="op">,</span></span>
<span id="cb7-13"><a href="#cb7-13"></a>    [Total revenue]<span class="op">,</span> DESC</span>
<span id="cb7-14"><a href="#cb7-14"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The answer is: “Beverages, Dairy Products, Confections”!</p>
</section>
<section id="day-5-average-price-of-discontinued-products" class="level2">
<h2 class="anchored" data-anchor-id="day-5-average-price-of-discontinued-products">Day 5: Average price of discontinued products?</h2>
<p>We must get the (actual) unit price from the Order details table, not the Product table. The order price is even different order by order, so we need 2 steps:</p>
<ul>
<li>Calculate average order unit price (over all order) for all discontinued products;</li>
<li>Calculate the average for all those average.</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1"></a>D5 <span class="op">=</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">AVERAGEX</span> (</span>
<span id="cb8-3"><a href="#cb8-3"></a>    <span class="fu">SUMMARIZE</span> (</span>
<span id="cb8-4"><a href="#cb8-4"></a>        <span class="fu">FILTER</span> ( Products<span class="op">,</span> Products[Discontinued] <span class="op">=</span> <span class="fu">TRUE</span> () )<span class="op">,</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>        Products[ProductID]<span class="op">,</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>        Products[ProductName]<span class="op">,</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>        <span class="st">"Avg unit price"</span><span class="op">,</span> <span class="fu">AVERAGE</span> ( Order_Details[UnitPrice] )</span>
<span id="cb8-8"><a href="#cb8-8"></a>    )<span class="op">,</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>    [Avg unit price]</span>
<span id="cb8-10"><a href="#cb8-10"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The answer is: 44.35!</p>
</section>
<section id="day-6-percentage-of-sales-from-discontinued-products" class="level2">
<h2 class="anchored" data-anchor-id="day-6-percentage-of-sales-from-discontinued-products">Day 6: Percentage of sales from discontinued products?</h2>
<p>We will be reusing the Revenue post discount:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1"></a>D6 <span class="op">=</span> </span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="fu">DIVIDE</span>(</span>
<span id="cb9-3"><a href="#cb9-3"></a>    <span class="fu">SUMX</span>(</span>
<span id="cb9-4"><a href="#cb9-4"></a>        <span class="fu">FILTER</span>(</span>
<span id="cb9-5"><a href="#cb9-5"></a>        Products<span class="op">,</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>        Products[Discontinued] <span class="op">=</span> <span class="fu">TRUE</span>()</span>
<span id="cb9-7"><a href="#cb9-7"></a>        )<span class="op">,</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>        [Revenue after discount]</span>
<span id="cb9-9"><a href="#cb9-9"></a>    )<span class="op">,</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>    [Revenue after discount] <span class="co">// This is a measure of SUMX itself</span></span>
<span id="cb9-11"><a href="#cb9-11"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The answer is: 14.61%!</p>
</section>
<section id="day-7-how-many-high-value-orders-were-placed-in-1997" class="level2">
<h2 class="anchored" data-anchor-id="day-7-how-many-high-value-orders-were-placed-in-1997">Day 7: How many high-value orders were placed in 1997?</h2>
<p>The Orders table, not the Order detail is the concerned table, we first calculate the average order revenue for all orders place in 1997. And then we filter the Orders table with 2 conditions: year of order date is 1997, and the revenue post discount is larger than average.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1"></a>D7 <span class="op">=</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>VAR Avg_order_rev_1997 <span class="op">=</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>    <span class="fu">AVERAGEX</span> (</span>
<span id="cb10-4"><a href="#cb10-4"></a>        <span class="fu">FILTER</span> ( Orders<span class="op">,</span> <span class="fu">YEAR</span> ( Orders[OrderDate] ) <span class="op">=</span> <span class="dv">1997</span> )<span class="op">,</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>        [Revenue after discount]</span>
<span id="cb10-6"><a href="#cb10-6"></a>    )</span>
<span id="cb10-7"><a href="#cb10-7"></a>RETURN</span>
<span id="cb10-8"><a href="#cb10-8"></a>    <span class="fu">COUNTROWS</span> (</span>
<span id="cb10-9"><a href="#cb10-9"></a>        <span class="fu">FILTER</span> (</span>
<span id="cb10-10"><a href="#cb10-10"></a>            Orders<span class="op">,</span></span>
<span id="cb10-11"><a href="#cb10-11"></a>            [Revenue after discount] <span class="op">&gt;</span> Avg_order_rev_1997</span>
<span id="cb10-12"><a href="#cb10-12"></a>                <span class="op">&amp;&amp;</span> <span class="fu">YEAR</span> ( Orders[OrderDate] ) <span class="op">=</span> <span class="dv">1997</span></span>
<span id="cb10-13"><a href="#cb10-13"></a>        )</span>
<span id="cb10-14"><a href="#cb10-14"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>There are 145 high-value orders in the year 1997!</p>
</section>
<section id="day-8-number-of-orders-delivered-on-time" class="level2">
<h2 class="anchored" data-anchor-id="day-8-number-of-orders-delivered-on-time">Day 8: Number of orders delivered on time?</h2>
<p>Curbal seems to prefer using <code>SUMMARIZE()</code> everywhere, I think the solution is relatively simple of <code>COUNTROWS()</code> after some <code>FILTER()</code>. Here is my initial solution:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb11-1"><a href="#cb11-1"></a>D8 <span class="op">=</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="fu">COUNTROWS</span> (</span>
<span id="cb11-3"><a href="#cb11-3"></a>    <span class="fu">FILTER</span> (</span>
<span id="cb11-4"><a href="#cb11-4"></a>        Orders<span class="op">,</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>        NOT <span class="fu">ISBLANK</span> ( Orders[ShippedDate] )</span>
<span id="cb11-6"><a href="#cb11-6"></a>            <span class="op">&amp;&amp;</span> <span class="fu">DATEDIFF</span> ( Orders[RequiredDate]<span class="op">,</span> Orders[ShippedDate]<span class="op">,</span> DAY ) <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>    )</span>
<span id="cb11-8"><a href="#cb11-8"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>I asked Claude 3.5 Sonnet to optimized this and he said the combination of <code>FILTER()</code> and <code>DATEDIFF()</code> might be expensive, his solution is:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb12-1"><a href="#cb12-1"></a>D8 <span class="op">=</span> </span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="fu">CALCULATE</span>(</span>
<span id="cb12-3"><a href="#cb12-3"></a>    <span class="fu">COUNTROWS</span>(Orders)<span class="op">,</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>    Orders[ShippedDate] <span class="op">&lt;&gt;</span> <span class="fu">BLANK</span>()<span class="op">,</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>    Orders[RequiredDate] <span class="op">=</span> Orders[ShippedDate]</span>
<span id="cb12-6"><a href="#cb12-6"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Cool! There is 3 such orders.</p>
<p>If we use the logic <code>Orders[RequiredDate] &gt;= Orders[ShippedDate]</code>, there is 772 orders. IMHO I think this make more sense!</p>
</section>
<section id="day-9-the-single-month-with-highest-sales" class="level2">
<h2 class="anchored" data-anchor-id="day-9-the-single-month-with-highest-sales">Day 9: The single month with highest sales?</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb13-1"><a href="#cb13-1"></a>D9 <span class="op">=</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb13-3"><a href="#cb13-3"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb13-4"><a href="#cb13-4"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>        <span class="fu">ADDCOLUMNS</span> (</span>
<span id="cb13-6"><a href="#cb13-6"></a>            <span class="fu">SUMMARIZE</span> ( <span class="st">'Calendar'</span><span class="op">,</span> <span class="st">'Calendar'</span>[Year<span class="op">-</span>Month] )<span class="op">,</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>            <span class="st">"Total rev"</span><span class="op">,</span> [Revenue after discount]</span>
<span id="cb13-8"><a href="#cb13-8"></a>        )<span class="op">,</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>        [Revenue after discount]<span class="op">,</span> DESC</span>
<span id="cb13-10"><a href="#cb13-10"></a>    )<span class="op">,</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>    <span class="st">'Calendar'</span>[Year<span class="op">-</span>Month]<span class="op">,</span></span>
<span id="cb13-12"><a href="#cb13-12"></a>    <span class="st">", "</span><span class="op">,</span></span>
<span id="cb13-13"><a href="#cb13-13"></a>    <span class="st">'Calendar'</span>[Year<span class="op">-</span>Month]<span class="op">,</span> ASC</span>
<span id="cb13-14"><a href="#cb13-14"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Pretty simple, it’s 1998-Apr!</p>
</section>
<section id="day-10-best-sales-week-day-for-queso-cabrales" class="level2">
<h2 class="anchored" data-anchor-id="day-10-best-sales-week-day-for-queso-cabrales">Day 10: Best sales (week) day for queso cabrales?</h2>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb14-1"><a href="#cb14-1"></a>D10 <span class="op">=</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb14-3"><a href="#cb14-3"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb14-4"><a href="#cb14-4"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>        <span class="fu">ADDCOLUMNS</span> (</span>
<span id="cb14-6"><a href="#cb14-6"></a>            <span class="fu">SUMMARIZE</span> ( <span class="st">'Calendar'</span><span class="op">,</span> <span class="st">'Calendar'</span>[Day Name] )<span class="op">,</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>            <span class="st">"Queso Cabrales sales"</span><span class="op">,</span> <span class="fu">CALCULATE</span> ( [Revenue after discount]<span class="op">,</span> Products[ProductName] <span class="op">=</span> <span class="st">"Queso Cabrales"</span> )</span>
<span id="cb14-8"><a href="#cb14-8"></a>        )<span class="op">,</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>        [Queso Cabrales sales]<span class="op">,</span> DESC</span>
<span id="cb14-10"><a href="#cb14-10"></a>    )<span class="op">,</span></span>
<span id="cb14-11"><a href="#cb14-11"></a>    <span class="st">'Calendar'</span>[Day Name]<span class="op">,</span></span>
<span id="cb14-12"><a href="#cb14-12"></a>    <span class="st">", "</span><span class="op">,</span></span>
<span id="cb14-13"><a href="#cb14-13"></a>    <span class="st">'Calendar'</span>[Day Name]<span class="op">,</span> ASC</span>
<span id="cb14-14"><a href="#cb14-14"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This is an enhanced version from Claude 3.5 Sonnet:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb15-1"><a href="#cb15-1"></a>D10a <span class="op">=</span> </span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="fu">CALCULATE</span>(</span>
<span id="cb15-3"><a href="#cb15-3"></a>    <span class="fu">MAX</span>(<span class="st">'Calendar'</span>[Day Name])<span class="op">,</span> <span class="co">// trickily put an aggregation function here!</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>    <span class="fu">TOPN</span>(</span>
<span id="cb15-5"><a href="#cb15-5"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>        <span class="fu">VALUES</span>(<span class="st">'Calendar'</span>[Day Name])<span class="op">,</span></span>
<span id="cb15-7"><a href="#cb15-7"></a>        <span class="co">// Using VALUES() here effectively says "give me the distinct day names, then order them by the sales amount"</span></span>
<span id="cb15-8"><a href="#cb15-8"></a>        <span class="fu">CALCULATE</span>(</span>
<span id="cb15-9"><a href="#cb15-9"></a>            [Revenue after discount]<span class="op">,</span></span>
<span id="cb15-10"><a href="#cb15-10"></a>            Products[ProductName] <span class="op">=</span> <span class="st">"Queso Cabrales"</span></span>
<span id="cb15-11"><a href="#cb15-11"></a>        )<span class="op">,</span></span>
<span id="cb15-12"><a href="#cb15-12"></a>        DESC</span>
<span id="cb15-13"><a href="#cb15-13"></a>    )</span>
<span id="cb15-14"><a href="#cb15-14"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Bravo Tuesday!</p>
</section>
<section id="day-11-customer-with-the-highest-customer-lifespan" class="level2">
<h2 class="anchored" data-anchor-id="day-11-customer-with-the-highest-customer-lifespan">Day 11: Customer with the highest customer lifespan?</h2>
<p>I have walked around with the <code>VALUES()</code> magic but failed with the lifespan calculation. Claude helped me with this, and if we can confidently ensure there is no duplicated company name for 2 different companies/customers, this is a very concise solution:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb16-1"><a href="#cb16-1"></a>D11 <span class="op">=</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb16-3"><a href="#cb16-3"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb16-4"><a href="#cb16-4"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb16-5"><a href="#cb16-5"></a>        <span class="fu">VALUES</span> ( Customers[CompanyName] )<span class="op">,</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>        <span class="fu">CALCULATE</span> ( <span class="fu">MAX</span> ( Orders[OrderDate] ) <span class="op">-</span> <span class="fu">MIN</span> ( Orders[OrderDate] ) )<span class="op">,</span> DESC</span>
<span id="cb16-7"><a href="#cb16-7"></a>    )<span class="op">,</span></span>
<span id="cb16-8"><a href="#cb16-8"></a>    Customers[CompanyName]<span class="op">,</span></span>
<span id="cb16-9"><a href="#cb16-9"></a>    <span class="st">", "</span></span>
<span id="cb16-10"><a href="#cb16-10"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The answer is: Richter Supermarkt! Love you.</p>
</section>
<section id="day-12-which-customer-had-placed-most-orders" class="level2">
<h2 class="anchored" data-anchor-id="day-12-which-customer-had-placed-most-orders">Day 12: Which customer had placed most orders?</h2>
<p>This time I’ve successfully implemented this pattern!</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb17-1"><a href="#cb17-1"></a>D12 <span class="op">=</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="fu">TOPN</span> (</span>
<span id="cb17-3"><a href="#cb17-3"></a>    <span class="dv">1</span><span class="op">,</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>    <span class="fu">VALUES</span> ( Customers[CompanyName] )<span class="op">,</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>    <span class="fu">CALCULATE</span> ( <span class="fu">COUNT</span> ( Orders[OrderID] ) )<span class="op">,</span> DESC</span>
<span id="cb17-6"><a href="#cb17-6"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This is Save-a-lot Markets!</p>
</section>
<section id="day-13-top-5-countries-with-the-highest-number-of-customers" class="level2">
<h2 class="anchored" data-anchor-id="day-13-top-5-countries-with-the-highest-number-of-customers">Day 13: Top 5 countries with the highest number of customers?</h2>
<p>Quick check and I found that no customer in the Customers table did not order any order. So we just need to care/count on the Customers table only. Quite straightforwar!</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb18-1"><a href="#cb18-1"></a>D13 <span class="op">=</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb18-3"><a href="#cb18-3"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb18-4"><a href="#cb18-4"></a>        <span class="dv">5</span><span class="op">,</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>        <span class="fu">VALUES</span> ( Customers[Country] )<span class="op">,</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>        <span class="fu">CALCULATE</span> ( <span class="fu">COUNT</span> ( Customers[CustomerID] ) )<span class="op">,</span> DESC</span>
<span id="cb18-7"><a href="#cb18-7"></a>    )<span class="op">,</span></span>
<span id="cb18-8"><a href="#cb18-8"></a>    Customers[Country]<span class="op">,</span></span>
<span id="cb18-9"><a href="#cb18-9"></a>    <span class="st">", "</span><span class="op">,</span></span>
<span id="cb18-10"><a href="#cb18-10"></a>    <span class="fu">CALCULATE</span> ( <span class="fu">COUNT</span> ( Customers[CustomerID] ) )<span class="op">,</span> DESC</span>
<span id="cb18-11"><a href="#cb18-11"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>I am in love with this pattern, the answer is: USA, Germany, France, Brazil, UK!</p>
</section>
<section id="day-14-which-customer-placed-the-highest-value-of-order-sales-in-1997" class="level2">
<h2 class="anchored" data-anchor-id="day-14-which-customer-placed-the-highest-value-of-order-sales-in-1997">Day 14: Which customer placed the highest value of order (sales) in 1997?</h2>
<p>It’s QUICK-Stop!</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb19-1"><a href="#cb19-1"></a>D14 <span class="op">=</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="fu">TOPN</span> (</span>
<span id="cb19-3"><a href="#cb19-3"></a>    <span class="dv">1</span><span class="op">,</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>    <span class="fu">VALUES</span> ( Customers[CompanyName] )<span class="op">,</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>    <span class="fu">CALCULATE</span> ( [Revenue after discount]<span class="op">,</span> <span class="fu">YEAR</span> ( Orders[OrderDate] ) <span class="op">=</span> <span class="dv">1997</span> )<span class="op">,</span> DESC</span>
<span id="cb19-6"><a href="#cb19-6"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="day-15-customer-with-the-highest-number-of-orders-in-one-single-month" class="level2">
<h2 class="anchored" data-anchor-id="day-15-customer-with-the-highest-number-of-orders-in-one-single-month">Day 15: Customer with the highest number of orders in one single month?</h2>
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb20-1"><a href="#cb20-1"></a>D15 <span class="op">=</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb20-3"><a href="#cb20-3"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb20-4"><a href="#cb20-4"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>        <span class="fu">ADDCOLUMNS</span> (</span>
<span id="cb20-6"><a href="#cb20-6"></a>            <span class="fu">SUMMARIZE</span> ( Orders<span class="op">,</span> Customers[CompanyName]<span class="op">,</span> <span class="st">'Calendar'</span>[Year<span class="op">-</span>Month] )<span class="op">,</span></span>
<span id="cb20-7"><a href="#cb20-7"></a>            <span class="st">"order_count"</span><span class="op">,</span> <span class="fu">CALCULATE</span> ( <span class="fu">COUNT</span> ( Orders[OrderID] ) )</span>
<span id="cb20-8"><a href="#cb20-8"></a>        )<span class="op">,</span></span>
<span id="cb20-9"><a href="#cb20-9"></a>        [order_count]<span class="op">,</span> DESC</span>
<span id="cb20-10"><a href="#cb20-10"></a>    )<span class="op">,</span></span>
<span id="cb20-11"><a href="#cb20-11"></a>    Customers[CompanyName]<span class="op">,</span></span>
<span id="cb20-12"><a href="#cb20-12"></a>    <span class="st">", "</span><span class="op">,</span></span>
<span id="cb20-13"><a href="#cb20-13"></a>    Customers[CompanyName]<span class="op">,</span> DESC</span>
<span id="cb20-14"><a href="#cb20-14"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>There are 3 customers have 5 orders in one single month: Bottom-Dollar Markets, Ernst Handel, and Save-a-lot Markets!</p>
</section>
<section id="day-16-employee-with-the-highest-average-order-value-in-sales" class="level2">
<h2 class="anchored" data-anchor-id="day-16-employee-with-the-highest-average-order-value-in-sales">Day 16: Employee with the highest average order value (in sales)?</h2>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb21-1"><a href="#cb21-1"></a>D16 <span class="op">=</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="fu">TOPN</span> (</span>
<span id="cb21-3"><a href="#cb21-3"></a>    <span class="dv">1</span><span class="op">,</span></span>
<span id="cb21-4"><a href="#cb21-4"></a>    <span class="fu">VALUES</span> ( Employees[Full Name] )<span class="op">,</span></span>
<span id="cb21-5"><a href="#cb21-5"></a>    <span class="fu">CALCULATE</span> ( <span class="fu">DIVIDE</span> ( [Revenue after discount]<span class="op">,</span> <span class="fu">COUNT</span> ( Orders[OrderID] ) ) )<span class="op">,</span> DESC</span>
<span id="cb21-6"><a href="#cb21-6"></a>)</span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="co">// AVERAGEX wouldn't work here because the measure is already doing a sum across Order_Details</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>She is Anne Dodsworth.</p>
</section>
<section id="day-17-employee-with-the-longest-average-processing-order-time" class="level2">
<h2 class="anchored" data-anchor-id="day-17-employee-with-the-longest-average-processing-order-time">Day 17: Employee with the longest average processing order time?</h2>
<p>It’s also Dodsworth!</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb22-1"><a href="#cb22-1"></a>D17 <span class="op">=</span> </span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="fu">TOPN</span>(</span>
<span id="cb22-3"><a href="#cb22-3"></a>    <span class="dv">1</span><span class="op">,</span></span>
<span id="cb22-4"><a href="#cb22-4"></a>    <span class="fu">VALUES</span>(Employees[Full Name])<span class="op">,</span></span>
<span id="cb22-5"><a href="#cb22-5"></a>    <span class="fu">CALCULATE</span>( </span>
<span id="cb22-6"><a href="#cb22-6"></a>        <span class="fu">AVERAGEX</span>(</span>
<span id="cb22-7"><a href="#cb22-7"></a>            <span class="fu">FILTER</span>(Orders<span class="op">,</span> Orders[ShippedDate] <span class="op">&lt;&gt;</span> <span class="fu">BLANK</span>())<span class="op">,</span></span>
<span id="cb22-8"><a href="#cb22-8"></a>            <span class="fu">DATEDIFF</span>(Orders[OrderDate]<span class="op">,</span> Orders[ShippedDate]<span class="op">,</span> DAY)</span>
<span id="cb22-9"><a href="#cb22-9"></a>        )</span>
<span id="cb22-10"><a href="#cb22-10"></a>    )<span class="op">,</span></span>
<span id="cb22-11"><a href="#cb22-11"></a>    DESC</span>
<span id="cb22-12"><a href="#cb22-12"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="day-18-which-employee-has-been-in-the-company-the-longest" class="level2">
<h2 class="anchored" data-anchor-id="day-18-which-employee-has-been-in-the-company-the-longest">Day 18: Which employee has been in the company the longest?</h2>
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb23-1"><a href="#cb23-1"></a>D18 <span class="op">=</span> </span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="fu">CONCATENATEX</span>(</span>
<span id="cb23-3"><a href="#cb23-3"></a>    <span class="fu">TOPN</span>(</span>
<span id="cb23-4"><a href="#cb23-4"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb23-5"><a href="#cb23-5"></a>        <span class="fu">VALUES</span>(Employees[Full Name])<span class="op">,</span></span>
<span id="cb23-6"><a href="#cb23-6"></a>        <span class="fu">CALCULATE</span>( <span class="fu">MIN</span>( Employees[HireDate]) )<span class="op">,</span></span>
<span id="cb23-7"><a href="#cb23-7"></a>        ASC</span>
<span id="cb23-8"><a href="#cb23-8"></a>    )<span class="op">,</span></span>
<span id="cb23-9"><a href="#cb23-9"></a>    Employees[Full Name]<span class="op">,</span></span>
<span id="cb23-10"><a href="#cb23-10"></a>    <span class="st">", "</span></span>
<span id="cb23-11"><a href="#cb23-11"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Janet Leverling!</p>
</section>
<section id="day-19-name-of-all-northwind-managers" class="level2">
<h2 class="anchored" data-anchor-id="day-19-name-of-all-northwind-managers">Day 19: Name of all Northwind managers?</h2>
<p>Anyone who has an employee reporting to themself is a manager! They are Andrew Fuller, Nancy Davolio, Steven Buchanan.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb24-1"><a href="#cb24-1"></a>D19 <span class="op">=</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb24-3"><a href="#cb24-3"></a>    <span class="fu">FILTER</span> ( Employees<span class="op">,</span> Employees[EmployeeID] IN <span class="fu">VALUES</span> ( Employees[ReportsTo] ) )<span class="op">,</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>    Employees[Full Name]<span class="op">,</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>    <span class="st">", "</span><span class="op">,</span></span>
<span id="cb24-6"><a href="#cb24-6"></a>    Employees[Full Name]<span class="op">,</span> ASC</span>
<span id="cb24-7"><a href="#cb24-7"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="day-20-which-employee-handle-the-most-unique-customers" class="level2">
<h2 class="anchored" data-anchor-id="day-20-which-employee-handle-the-most-unique-customers">Day 20: Which employee handle the most unique customers?</h2>
<p>There is no direct relationship from Employees to Customers table, we will be working on the Orders table!</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb25-1"><a href="#cb25-1"></a>D20 <span class="op">=</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb25-3"><a href="#cb25-3"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb25-4"><a href="#cb25-4"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb25-5"><a href="#cb25-5"></a>        <span class="fu">VALUES</span> ( Employees[Full Name] )<span class="op">,</span></span>
<span id="cb25-6"><a href="#cb25-6"></a>        <span class="fu">CALCULATE</span> ( <span class="fu">DISTINCTCOUNT</span> ( Orders[CustomerID] ) )</span>
<span id="cb25-7"><a href="#cb25-7"></a>    )<span class="op">,</span></span>
<span id="cb25-8"><a href="#cb25-8"></a>    Employees[Full Name]<span class="op">,</span></span>
<span id="cb25-9"><a href="#cb25-9"></a>    <span class="st">", "</span></span>
<span id="cb25-10"><a href="#cb25-10"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Margaret Peacock!</p>
</section>
<section id="day-21-number-of-suppliers-that-deliver-more-product-items-than-average" class="level2">
<h2 class="anchored" data-anchor-id="day-21-number-of-suppliers-that-deliver-more-product-items-than-average">Day 21: Number of suppliers that deliver more product items than average?</h2>
<p>There are 16!</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb26-1"><a href="#cb26-1"></a>D21 <span class="op">=</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>VAR supplier_n_product <span class="op">=</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>    <span class="fu">ADDCOLUMNS</span> (</span>
<span id="cb26-4"><a href="#cb26-4"></a>        <span class="fu">SUMMARIZE</span> ( Suppliers<span class="op">,</span> Suppliers[SupplierID]<span class="op">,</span> Suppliers[CompanyName] )<span class="op">,</span></span>
<span id="cb26-5"><a href="#cb26-5"></a>        <span class="st">"count product"</span><span class="op">,</span> <span class="fu">CALCULATE</span> ( <span class="fu">COUNT</span> ( Products[CategoryID] ) )</span>
<span id="cb26-6"><a href="#cb26-6"></a>    )</span>
<span id="cb26-7"><a href="#cb26-7"></a>RETURN</span>
<span id="cb26-8"><a href="#cb26-8"></a>    <span class="fu">COUNTROWS</span> (</span>
<span id="cb26-9"><a href="#cb26-9"></a>        <span class="fu">FILTER</span> (</span>
<span id="cb26-10"><a href="#cb26-10"></a>            supplier_n_product<span class="op">,</span></span>
<span id="cb26-11"><a href="#cb26-11"></a>            [count product] <span class="op">&gt;</span> <span class="fu">AVERAGEX</span> ( supplier_n_product<span class="op">,</span> [count product] )</span>
<span id="cb26-12"><a href="#cb26-12"></a>        )</span>
<span id="cb26-13"><a href="#cb26-13"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="day-22-suppliers-with-most-stocked-out-products" class="level2">
<h2 class="anchored" data-anchor-id="day-22-suppliers-with-most-stocked-out-products">Day 22: Suppliers with most stocked-out products?</h2>
<p>Confidently assumed there is no duplicated CompanyName haha:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb27-1"><a href="#cb27-1"></a>D22 <span class="op">=</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb27-3"><a href="#cb27-3"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb27-4"><a href="#cb27-4"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>        <span class="fu">VALUES</span> ( Suppliers[CompanyName] )<span class="op">,</span></span>
<span id="cb27-6"><a href="#cb27-6"></a>        <span class="fu">CALCULATE</span> ( <span class="fu">COUNT</span> ( Products[ProductID] )<span class="op">,</span> Products[UnitsInStock] <span class="op">=</span> <span class="dv">0</span> )<span class="op">,</span> DESC</span>
<span id="cb27-7"><a href="#cb27-7"></a>    )<span class="op">,</span></span>
<span id="cb27-8"><a href="#cb27-8"></a>    Suppliers[CompanyName]<span class="op">,</span></span>
<span id="cb27-9"><a href="#cb27-9"></a>    <span class="st">", "</span></span>
<span id="cb27-10"><a href="#cb27-10"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The answer is: New Orleans Cajun Delights, Pavlova, Ltd., Plutzer Lebensmittelgroßmärkte AG, Formaggi Fortini s.r.l., and “G’day, Mate”!</p>
</section>
<section id="day-23-which-supplier-delivers-the-most-expensive-product" class="level2">
<h2 class="anchored" data-anchor-id="day-23-which-supplier-delivers-the-most-expensive-product">Day 23: Which supplier delivers the most expensive product?</h2>
<p>We need to focus on the Products table which lists the current price rather than the Orders table contained sold items ~ historical price.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb28-1"><a href="#cb28-1"></a>D23 <span class="op">=</span></span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb28-3"><a href="#cb28-3"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb28-4"><a href="#cb28-4"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb28-5"><a href="#cb28-5"></a>        <span class="fu">VALUES</span> ( Suppliers[CompanyName] )<span class="op">,</span></span>
<span id="cb28-6"><a href="#cb28-6"></a>        <span class="fu">CALCULATE</span> ( <span class="fu">MAX</span> ( Products[UnitPrice] ) )<span class="op">,</span> DESC</span>
<span id="cb28-7"><a href="#cb28-7"></a>    )<span class="op">,</span></span>
<span id="cb28-8"><a href="#cb28-8"></a>    Suppliers[CompanyName]<span class="op">,</span></span>
<span id="cb28-9"><a href="#cb28-9"></a>    <span class="st">", "</span></span>
<span id="cb28-10"><a href="#cb28-10"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It’s is Aux joyeux ecclésiastiques!</p>
</section>
<section id="day-24-which-supplier-has-the-highest-category-diversity" class="level2">
<h2 class="anchored" data-anchor-id="day-24-which-supplier-has-the-highest-category-diversity">Day 24: Which supplier has the highest category diversity?</h2>
<p>Note that there is no relationship between Suppliers table and Categories table. So we will be using <code>CategoryID</code> in the Products table:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb29-1"><a href="#cb29-1"></a>D24 <span class="op">=</span> </span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb29-3"><a href="#cb29-3"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb29-4"><a href="#cb29-4"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb29-5"><a href="#cb29-5"></a>        <span class="fu">VALUES</span> ( Suppliers[CompanyName] )<span class="op">,</span></span>
<span id="cb29-6"><a href="#cb29-6"></a>        <span class="fu">CALCULATE</span> ( <span class="fu">COUNT</span> ( Products[CategoryID] ) )<span class="op">,</span> DESC</span>
<span id="cb29-7"><a href="#cb29-7"></a>    )<span class="op">,</span></span>
<span id="cb29-8"><a href="#cb29-8"></a>    Suppliers[CompanyName]<span class="op">,</span></span>
<span id="cb29-9"><a href="#cb29-9"></a>    <span class="st">", "</span></span>
<span id="cb29-10"><a href="#cb29-10"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It’s Pavlova, Ltd., Plutzer Lebensmittelgroßmärkte AG.</p>
</section>
<section id="day-25-supplier-with-highest-number-of-top-5-selling-products" class="level2">
<h2 class="anchored" data-anchor-id="day-25-supplier-with-highest-number-of-top-5-selling-products">Day 25: Supplier with highest number of top 5 selling products?</h2>
<p>We need to do 2 steps: listing top 5 selling products, and then filter the top 1 supplier that delivers:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb30-1"><a href="#cb30-1"></a>D25 <span class="op">=</span> </span>
<span id="cb30-2"><a href="#cb30-2"></a>VAR Top_5_products <span class="op">=</span> <span class="fu">TOPN</span>(</span>
<span id="cb30-3"><a href="#cb30-3"></a>    <span class="dv">5</span><span class="op">,</span></span>
<span id="cb30-4"><a href="#cb30-4"></a>    <span class="fu">VALUES</span>(Products[ProductID])<span class="op">,</span></span>
<span id="cb30-5"><a href="#cb30-5"></a>    [Revenue after discount]</span>
<span id="cb30-6"><a href="#cb30-6"></a>)</span>
<span id="cb30-7"><a href="#cb30-7"></a>RETURN</span>
<span id="cb30-8"><a href="#cb30-8"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb30-9"><a href="#cb30-9"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb30-10"><a href="#cb30-10"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb30-11"><a href="#cb30-11"></a>        <span class="fu">VALUES</span> ( Suppliers[CompanyName] )<span class="op">,</span></span>
<span id="cb30-12"><a href="#cb30-12"></a>        <span class="fu">CALCULATE</span> ( <span class="fu">COUNT</span> ( Products[ProductID] )<span class="op">,</span> Products[ProductID] <span class="kw">in</span> Top_5_products )<span class="op">,</span> DESC</span>
<span id="cb30-13"><a href="#cb30-13"></a>    )<span class="op">,</span></span>
<span id="cb30-14"><a href="#cb30-14"></a>    Suppliers[CompanyName]<span class="op">,</span></span>
<span id="cb30-15"><a href="#cb30-15"></a>    <span class="st">", "</span></span>
<span id="cb30-16"><a href="#cb30-16"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It’s Gai pâturage! Yayyy we completed the challenge!</p>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ul>
<li>Link to the challenge: <a href="https://curbal.com/25-days-of-dax-fridays-challenge-edition-3" class="uri">https://curbal.com/25-days-of-dax-fridays-challenge-edition-3</a>;</li>
<li>DAX codes were formatted using DAXFormatter: <a href="https://www.daxformatter.com/" class="uri">https://www.daxformatter.com/</a>;</li>
<li>A brilliant No-CALCULATE solution by Brian Julius: <a href="https://github.com/bjulius/No-CALCULATE-DAX" class="uri">https://github.com/bjulius/No-CALCULATE-DAX</a>;</li>
<li>Worth reading - The One DAX pattern to rule them all by Greg Deckler in <a href="https://www.linkedin.com/posts/gregdeckler_powerbi-microsoft-dax-activity-7056636983959322624-uxwY">LinkedIn</a>.</li>
</ul>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/lktuan\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb31" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb31-1"><a href="#cb31-1"></a><span class="co">---</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="an">title:</span><span class="co"> "I completed 25 days of DAX (Friday) challenge, in 2 days!"</span></span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="an">description:</span><span class="co"> "by Curbal AB, Edition 3, on Northwind dataset"</span></span>
<span id="cb31-4"><a href="#cb31-4"></a><span class="an">author:</span></span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="co">  - name: "Tuan Le Khac"</span></span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="co">    url: https://lktuan.github.io/</span></span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="an">categories:</span><span class="co"> [DAX] </span></span>
<span id="cb31-8"><a href="#cb31-8"></a><span class="an">date:</span><span class="co"> 02-12-2025</span></span>
<span id="cb31-9"><a href="#cb31-9"></a><span class="an">date-modified:</span><span class="co"> 02-12-2025</span></span>
<span id="cb31-10"><a href="#cb31-10"></a><span class="an">image:</span><span class="co"> dax.png</span></span>
<span id="cb31-11"><a href="#cb31-11"></a><span class="an">draft:</span><span class="co"> false</span></span>
<span id="cb31-12"><a href="#cb31-12"></a><span class="an">format:</span></span>
<span id="cb31-13"><a href="#cb31-13"></a><span class="co">  html:</span></span>
<span id="cb31-14"><a href="#cb31-14"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb31-15"><a href="#cb31-15"></a><span class="co">    code-tools: true</span></span>
<span id="cb31-16"><a href="#cb31-16"></a><span class="co">    code-fold: show</span></span>
<span id="cb31-17"><a href="#cb31-17"></a><span class="co">    code-annotations: hover</span></span>
<span id="cb31-18"><a href="#cb31-18"></a><span class="co">---</span></span>
<span id="cb31-19"><a href="#cb31-19"></a></span>
<span id="cb31-20"><a href="#cb31-20"></a><span class="fu"># My thought</span></span>
<span id="cb31-21"><a href="#cb31-21"></a></span>
<span id="cb31-22"><a href="#cb31-22"></a>I did the challenge a couple of months after it closed, so all the solutions by Curbal were available. I practiced along with watching the solution, and asking LLMs (mostly Claude 3.5 Sonnet, and DeepSeek-R1) for advice on a calculation pattern, or to give a more efficient approach.</span>
<span id="cb31-23"><a href="#cb31-23"></a></span>
<span id="cb31-24"><a href="#cb31-24"></a>I am satisfied with the ability to solve around 50-60% myself as I am new to DAX.</span>
<span id="cb31-25"><a href="#cb31-25"></a></span>
<span id="cb31-26"><a href="#cb31-26"></a>Everything in DAX (Data, contexts, filters, aggregators, parameters, etc) are **tables**. I do not like the way Curbal always used `SUMMARIZE()` but the instruction of how can we drag variables to a **table** (as a pivot table), do some sorting, or export to Excel to understand to flow of calculation is good. Tips on working with DAX query view is also helpful.</span>
<span id="cb31-27"><a href="#cb31-27"></a></span>
<span id="cb31-28"><a href="#cb31-28"></a>What I do not like about DAX is there are **several ways** to achieve a calculation pattern, and actually we don't need such many functions that DAX offers (see this <span class="co">[</span><span class="ot">post</span><span class="co">](https://www.linkedin.com/posts/brianjuliusdc_dax-nocalculate-rochesmaxim-activity-7294362624358567936-SgNC)</span> from Brian Julius).</span>
<span id="cb31-29"><a href="#cb31-29"></a></span>
<span id="cb31-30"><a href="#cb31-30"></a>Anyway, I am now more confident with DAX. Happy learning!</span>
<span id="cb31-31"><a href="#cb31-31"></a></span>
<span id="cb31-32"><a href="#cb31-32"></a><span class="fu"># My solution</span></span>
<span id="cb31-33"><a href="#cb31-33"></a></span>
<span id="cb31-34"><a href="#cb31-34"></a><span class="co">[</span><span class="ot">Here</span><span class="co">](https://github.com/lktuan/lktuan.github.io/tree/main/assets/20250210_25daysDAX_ed3_Northwind)</span></span>
<span id="cb31-35"><a href="#cb31-35"></a>is my final file.</span>
<span id="cb31-36"><a href="#cb31-36"></a></span>
<span id="cb31-37"><a href="#cb31-37"></a><span class="fu">## Day 1: Which product had been ordered the most (in terms of quantity) ?</span></span>
<span id="cb31-38"><a href="#cb31-38"></a></span>
<span id="cb31-39"><a href="#cb31-39"></a>View the data on DAX query view:</span>
<span id="cb31-40"><a href="#cb31-40"></a></span>
<span id="cb31-41"><a href="#cb31-41"></a><span class="in">```js</span></span>
<span id="cb31-42"><a href="#cb31-42"></a>EVALUATE</span>
<span id="cb31-43"><a href="#cb31-43"></a><span class="fu">SUMMARIZE</span> (</span>
<span id="cb31-44"><a href="#cb31-44"></a>    Products<span class="op">,</span></span>
<span id="cb31-45"><a href="#cb31-45"></a>    Products[ProductID]<span class="op">,</span></span>
<span id="cb31-46"><a href="#cb31-46"></a>    Products[ProductName]<span class="op">,</span></span>
<span id="cb31-47"><a href="#cb31-47"></a>    <span class="st">"Qty"</span><span class="op">,</span> <span class="fu">SUM</span> ( Order_Details[Quantity] )</span>
<span id="cb31-48"><a href="#cb31-48"></a>)</span>
<span id="cb31-49"><a href="#cb31-49"></a>ORDER BY [Qty] DESC</span>
<span id="cb31-50"><a href="#cb31-50"></a><span class="in">```</span></span>
<span id="cb31-51"><a href="#cb31-51"></a></span>
<span id="cb31-52"><a href="#cb31-52"></a>We need to get the <span class="in">`TOPN()`</span> **1**, and then <span class="in">`CONCATENATE()`</span> all products that have largest order quantities (there is such scenario):</span>
<span id="cb31-53"><a href="#cb31-53"></a></span>
<span id="cb31-54"><a href="#cb31-54"></a><span class="in">```js</span></span>
<span id="cb31-55"><a href="#cb31-55"></a>D1 <span class="op">=</span></span>
<span id="cb31-56"><a href="#cb31-56"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb31-57"><a href="#cb31-57"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb31-58"><a href="#cb31-58"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb31-59"><a href="#cb31-59"></a>        <span class="fu">SUMMARIZE</span> (</span>
<span id="cb31-60"><a href="#cb31-60"></a>            Products<span class="op">,</span></span>
<span id="cb31-61"><a href="#cb31-61"></a>            Products[ProductID]<span class="op">,</span></span>
<span id="cb31-62"><a href="#cb31-62"></a>            Products[ProductName]<span class="op">,</span></span>
<span id="cb31-63"><a href="#cb31-63"></a>            <span class="st">"Qty"</span><span class="op">,</span> <span class="fu">SUM</span> ( Order_Details[Quantity] )</span>
<span id="cb31-64"><a href="#cb31-64"></a>        )<span class="op">,</span></span>
<span id="cb31-65"><a href="#cb31-65"></a>        [Qty]<span class="op">,</span> DESC</span>
<span id="cb31-66"><a href="#cb31-66"></a>    )<span class="op">,</span></span>
<span id="cb31-67"><a href="#cb31-67"></a>    Products[ProductName]<span class="op">,</span></span>
<span id="cb31-68"><a href="#cb31-68"></a>    <span class="st">", "</span><span class="op">,</span></span>
<span id="cb31-69"><a href="#cb31-69"></a>    Products[ProductName]<span class="op">,</span> ASC</span>
<span id="cb31-70"><a href="#cb31-70"></a>)</span>
<span id="cb31-71"><a href="#cb31-71"></a><span class="co">// Concat ProductName and order ascending by itself</span></span>
<span id="cb31-72"><a href="#cb31-72"></a><span class="in">```</span></span>
<span id="cb31-73"><a href="#cb31-73"></a></span>
<span id="cb31-74"><a href="#cb31-74"></a>The answer is: "Camembert Pierrot"!</span>
<span id="cb31-75"><a href="#cb31-75"></a></span>
<span id="cb31-76"><a href="#cb31-76"></a>::: {.callout-tip}</span>
<span id="cb31-77"><a href="#cb31-77"></a><span class="in">`CONCATENATE()`</span> return string so if we want to run it in DAX query view, use the <span class="in">`ROW()`</span> function:</span>
<span id="cb31-78"><a href="#cb31-78"></a></span>
<span id="cb31-79"><a href="#cb31-79"></a><span class="in">```js</span></span>
<span id="cb31-80"><a href="#cb31-80"></a><span class="fu">ROW</span>(<span class="st">"Top sales products"</span><span class="op">,</span> </span>
<span id="cb31-81"><a href="#cb31-81"></a><span class="co">// measure D1</span></span>
<span id="cb31-82"><a href="#cb31-82"></a>)</span>
<span id="cb31-83"><a href="#cb31-83"></a><span class="in">```</span></span>
<span id="cb31-84"><a href="#cb31-84"></a>:::</span>
<span id="cb31-85"><a href="#cb31-85"></a></span>
<span id="cb31-86"><a href="#cb31-86"></a><span class="fu">## Day 2: Which product have the highest average order size?</span></span>
<span id="cb31-87"><a href="#cb31-87"></a></span>
<span id="cb31-88"><a href="#cb31-88"></a>The average order size is calculated for each product based on the quantity of each order. We will first <span class="in">`SUMMARIZE()`</span> to get distinct product and the average order quantity over Order Details table.</span>
<span id="cb31-89"><a href="#cb31-89"></a></span>
<span id="cb31-90"><a href="#cb31-90"></a>This time we will use the <span class="in">`ADDCOLUMNS()`</span> to explicit the intention of adding more columns, which is more efficient (this is also a common pattern in DAX). Readmore: <span class="ot">&lt;https://www.sqlbi.com/articles/best-practices-using-summarize-and-addcolumns/&gt;</span>.</span>
<span id="cb31-91"><a href="#cb31-91"></a></span>
<span id="cb31-92"><a href="#cb31-92"></a><span class="in">```js</span></span>
<span id="cb31-93"><a href="#cb31-93"></a>D2 <span class="op">=</span></span>
<span id="cb31-94"><a href="#cb31-94"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb31-95"><a href="#cb31-95"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb31-96"><a href="#cb31-96"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb31-97"><a href="#cb31-97"></a>        <span class="fu">ADDCOLUMNS</span> (</span>
<span id="cb31-98"><a href="#cb31-98"></a>            <span class="fu">SUMMARIZE</span> ( Products<span class="op">,</span> Products[ProductID]<span class="op">,</span> Products[ProductName] )<span class="op">,</span></span>
<span id="cb31-99"><a href="#cb31-99"></a>            <span class="st">"Avg qty"</span><span class="op">,</span> <span class="fu">CALCULATE</span> ( <span class="fu">AVERAGE</span> ( Order_Details[Quantity] ) )</span>
<span id="cb31-100"><a href="#cb31-100"></a>        )<span class="op">,</span></span>
<span id="cb31-101"><a href="#cb31-101"></a>        [Avg qty]<span class="op">,</span> DESC</span>
<span id="cb31-102"><a href="#cb31-102"></a>    )<span class="op">,</span></span>
<span id="cb31-103"><a href="#cb31-103"></a>    Products[ProductName]<span class="op">,</span></span>
<span id="cb31-104"><a href="#cb31-104"></a>    <span class="st">", "</span><span class="op">,</span></span>
<span id="cb31-105"><a href="#cb31-105"></a>    Products[ProductName]<span class="op">,</span> ASC</span>
<span id="cb31-106"><a href="#cb31-106"></a>)</span>
<span id="cb31-107"><a href="#cb31-107"></a><span class="in">```</span></span>
<span id="cb31-108"><a href="#cb31-108"></a></span>
<span id="cb31-109"><a href="#cb31-109"></a>And the answer is: "Schoggi Schokolade"!</span>
<span id="cb31-110"><a href="#cb31-110"></a></span>
<span id="cb31-111"><a href="#cb31-111"></a><span class="fu">## Day 3: What is highest average discount done to a product?</span></span>
<span id="cb31-112"><a href="#cb31-112"></a></span>
<span id="cb31-113"><a href="#cb31-113"></a>The solution is pretty similar to day 2, but this time we get the hight value instead of product name, we <span class="in">`FORMAT()`</span> the value to text and select it by <span class="in">`SELECTCOLUMNS()`</span>:</span>
<span id="cb31-114"><a href="#cb31-114"></a></span>
<span id="cb31-115"><a href="#cb31-115"></a><span class="in">```js</span></span>
<span id="cb31-116"><a href="#cb31-116"></a>D3 <span class="op">=</span></span>
<span id="cb31-117"><a href="#cb31-117"></a><span class="fu">SELECTCOLUMNS</span> (</span>
<span id="cb31-118"><a href="#cb31-118"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb31-119"><a href="#cb31-119"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb31-120"><a href="#cb31-120"></a>        <span class="fu">ADDCOLUMNS</span> (</span>
<span id="cb31-121"><a href="#cb31-121"></a>            <span class="fu">SUMMARIZE</span> ( Products<span class="op">,</span> Products[ProductID]<span class="op">,</span> Products[ProductName] )<span class="op">,</span></span>
<span id="cb31-122"><a href="#cb31-122"></a>            <span class="st">"Avg discount"</span><span class="op">,</span> <span class="fu">CALCULATE</span> ( <span class="fu">AVERAGE</span> ( Order_Details[Discount] ) )</span>
<span id="cb31-123"><a href="#cb31-123"></a>        )<span class="op">,</span></span>
<span id="cb31-124"><a href="#cb31-124"></a>        [Avg discount]<span class="op">,</span> DESC</span>
<span id="cb31-125"><a href="#cb31-125"></a>    )<span class="op">,</span></span>
<span id="cb31-126"><a href="#cb31-126"></a>    <span class="st">"Highest average"</span><span class="op">,</span> <span class="fu">FORMAT</span> ( [Avg discount]<span class="op">,</span> <span class="st">"0.00%"</span> )</span>
<span id="cb31-127"><a href="#cb31-127"></a>)</span>
<span id="cb31-128"><a href="#cb31-128"></a><span class="in">```</span></span>
<span id="cb31-129"><a href="#cb31-129"></a></span>
<span id="cb31-130"><a href="#cb31-130"></a>The answer is: "25.00%"!</span>
<span id="cb31-131"><a href="#cb31-131"></a></span>
<span id="cb31-132"><a href="#cb31-132"></a><span class="fu">## Day 4: Top3 categories that have the highest revenue contribution?</span></span>
<span id="cb31-133"><a href="#cb31-133"></a></span>
<span id="cb31-134"><a href="#cb31-134"></a>We do not need to <span class="in">`DIVIDE()`</span> as the solution provided by Curbal IMHO, it would be the same if we sort the absolute value.</span>
<span id="cb31-135"><a href="#cb31-135"></a></span>
<span id="cb31-136"><a href="#cb31-136"></a>We first create a measure to calculate the revenue post discount:</span>
<span id="cb31-137"><a href="#cb31-137"></a></span>
<span id="cb31-138"><a href="#cb31-138"></a><span class="in">```js</span></span>
<span id="cb31-139"><a href="#cb31-139"></a>Revenue after discount <span class="op">=</span></span>
<span id="cb31-140"><a href="#cb31-140"></a><span class="fu">SUMX</span> (</span>
<span id="cb31-141"><a href="#cb31-141"></a>    Order_Details<span class="op">,</span></span>
<span id="cb31-142"><a href="#cb31-142"></a>    Order_Details[Quantity] <span class="op">*</span> Order_Details[UnitPrice] <span class="op">*</span> ( <span class="dv">1</span> <span class="op">-</span> Order_Details[Discount] )</span>
<span id="cb31-143"><a href="#cb31-143"></a>)</span>
<span id="cb31-144"><a href="#cb31-144"></a><span class="in">```</span></span>
<span id="cb31-145"><a href="#cb31-145"></a></span>
<span id="cb31-146"><a href="#cb31-146"></a>And everything remained the same to previous question! We should sort descending by the revenue in the concatenated output rather than category name to show them in informative order.</span>
<span id="cb31-147"><a href="#cb31-147"></a></span>
<span id="cb31-148"><a href="#cb31-148"></a><span class="in">```js</span></span>
<span id="cb31-149"><a href="#cb31-149"></a>D4 <span class="op">=</span></span>
<span id="cb31-150"><a href="#cb31-150"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb31-151"><a href="#cb31-151"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb31-152"><a href="#cb31-152"></a>        <span class="dv">3</span><span class="op">,</span></span>
<span id="cb31-153"><a href="#cb31-153"></a>        <span class="fu">ADDCOLUMNS</span> (</span>
<span id="cb31-154"><a href="#cb31-154"></a>            <span class="fu">SUMMARIZE</span> ( Categories<span class="op">,</span> Categories[CategoryID]<span class="op">,</span> Categories[CategoryName] )<span class="op">,</span></span>
<span id="cb31-155"><a href="#cb31-155"></a>            <span class="st">"Total revenue"</span><span class="op">,</span> <span class="fu">CALCULATE</span> ( [Revenue after discount] )</span>
<span id="cb31-156"><a href="#cb31-156"></a>        )<span class="op">,</span></span>
<span id="cb31-157"><a href="#cb31-157"></a>        [Total revenue]<span class="op">,</span> DESC</span>
<span id="cb31-158"><a href="#cb31-158"></a>    )<span class="op">,</span></span>
<span id="cb31-159"><a href="#cb31-159"></a>    Categories[CategoryName]<span class="op">,</span></span>
<span id="cb31-160"><a href="#cb31-160"></a>    <span class="st">", "</span><span class="op">,</span></span>
<span id="cb31-161"><a href="#cb31-161"></a>    [Total revenue]<span class="op">,</span> DESC</span>
<span id="cb31-162"><a href="#cb31-162"></a>)</span>
<span id="cb31-163"><a href="#cb31-163"></a><span class="in">```</span></span>
<span id="cb31-164"><a href="#cb31-164"></a></span>
<span id="cb31-165"><a href="#cb31-165"></a>The answer is: "Beverages, Dairy Products, Confections"!</span>
<span id="cb31-166"><a href="#cb31-166"></a></span>
<span id="cb31-167"><a href="#cb31-167"></a><span class="fu">## Day 5: Average price of discontinued products?</span></span>
<span id="cb31-168"><a href="#cb31-168"></a></span>
<span id="cb31-169"><a href="#cb31-169"></a>We must get the (actual) unit price from the Order details table, not the Product table. The order price is even different order by order, so we need 2 steps:</span>
<span id="cb31-170"><a href="#cb31-170"></a></span>
<span id="cb31-171"><a href="#cb31-171"></a><span class="ss">- </span>Calculate average order unit price (over all order) for all discontinued products;</span>
<span id="cb31-172"><a href="#cb31-172"></a><span class="ss">- </span>Calculate the average for all those average.</span>
<span id="cb31-173"><a href="#cb31-173"></a></span>
<span id="cb31-174"><a href="#cb31-174"></a><span class="in">```js</span></span>
<span id="cb31-175"><a href="#cb31-175"></a>D5 <span class="op">=</span></span>
<span id="cb31-176"><a href="#cb31-176"></a><span class="fu">AVERAGEX</span> (</span>
<span id="cb31-177"><a href="#cb31-177"></a>    <span class="fu">SUMMARIZE</span> (</span>
<span id="cb31-178"><a href="#cb31-178"></a>        <span class="fu">FILTER</span> ( Products<span class="op">,</span> Products[Discontinued] <span class="op">=</span> <span class="fu">TRUE</span> () )<span class="op">,</span></span>
<span id="cb31-179"><a href="#cb31-179"></a>        Products[ProductID]<span class="op">,</span></span>
<span id="cb31-180"><a href="#cb31-180"></a>        Products[ProductName]<span class="op">,</span></span>
<span id="cb31-181"><a href="#cb31-181"></a>        <span class="st">"Avg unit price"</span><span class="op">,</span> <span class="fu">AVERAGE</span> ( Order_Details[UnitPrice] )</span>
<span id="cb31-182"><a href="#cb31-182"></a>    )<span class="op">,</span></span>
<span id="cb31-183"><a href="#cb31-183"></a>    [Avg unit price]</span>
<span id="cb31-184"><a href="#cb31-184"></a>)</span>
<span id="cb31-185"><a href="#cb31-185"></a><span class="in">```</span></span>
<span id="cb31-186"><a href="#cb31-186"></a></span>
<span id="cb31-187"><a href="#cb31-187"></a>The answer is: 44.35!</span>
<span id="cb31-188"><a href="#cb31-188"></a></span>
<span id="cb31-189"><a href="#cb31-189"></a><span class="fu">## Day 6: Percentage of sales from discontinued products?</span></span>
<span id="cb31-190"><a href="#cb31-190"></a></span>
<span id="cb31-191"><a href="#cb31-191"></a>We will be reusing the Revenue post discount:</span>
<span id="cb31-192"><a href="#cb31-192"></a></span>
<span id="cb31-193"><a href="#cb31-193"></a><span class="in">```js</span></span>
<span id="cb31-194"><a href="#cb31-194"></a>D6 <span class="op">=</span> </span>
<span id="cb31-195"><a href="#cb31-195"></a><span class="fu">DIVIDE</span>(</span>
<span id="cb31-196"><a href="#cb31-196"></a>    <span class="fu">SUMX</span>(</span>
<span id="cb31-197"><a href="#cb31-197"></a>        <span class="fu">FILTER</span>(</span>
<span id="cb31-198"><a href="#cb31-198"></a>        Products<span class="op">,</span></span>
<span id="cb31-199"><a href="#cb31-199"></a>        Products[Discontinued] <span class="op">=</span> <span class="fu">TRUE</span>()</span>
<span id="cb31-200"><a href="#cb31-200"></a>        )<span class="op">,</span></span>
<span id="cb31-201"><a href="#cb31-201"></a>        [Revenue after discount]</span>
<span id="cb31-202"><a href="#cb31-202"></a>    )<span class="op">,</span></span>
<span id="cb31-203"><a href="#cb31-203"></a>    [Revenue after discount] <span class="co">// This is a measure of SUMX itself</span></span>
<span id="cb31-204"><a href="#cb31-204"></a>)</span>
<span id="cb31-205"><a href="#cb31-205"></a><span class="in">```</span></span>
<span id="cb31-206"><a href="#cb31-206"></a></span>
<span id="cb31-207"><a href="#cb31-207"></a>The answer is: 14.61%!</span>
<span id="cb31-208"><a href="#cb31-208"></a></span>
<span id="cb31-209"><a href="#cb31-209"></a><span class="fu">## Day 7: How many high-value orders were placed in 1997?</span></span>
<span id="cb31-210"><a href="#cb31-210"></a></span>
<span id="cb31-211"><a href="#cb31-211"></a>The Orders table, not the Order detail is the concerned table, we first calculate the average order revenue for all orders place in 1997. And then we filter the Orders table with 2 conditions: year of order date is 1997, and the revenue post discount is larger than average.</span>
<span id="cb31-212"><a href="#cb31-212"></a></span>
<span id="cb31-213"><a href="#cb31-213"></a><span class="in">```js</span></span>
<span id="cb31-214"><a href="#cb31-214"></a>D7 <span class="op">=</span></span>
<span id="cb31-215"><a href="#cb31-215"></a>VAR Avg_order_rev_1997 <span class="op">=</span></span>
<span id="cb31-216"><a href="#cb31-216"></a>    <span class="fu">AVERAGEX</span> (</span>
<span id="cb31-217"><a href="#cb31-217"></a>        <span class="fu">FILTER</span> ( Orders<span class="op">,</span> <span class="fu">YEAR</span> ( Orders[OrderDate] ) <span class="op">=</span> <span class="dv">1997</span> )<span class="op">,</span></span>
<span id="cb31-218"><a href="#cb31-218"></a>        [Revenue after discount]</span>
<span id="cb31-219"><a href="#cb31-219"></a>    )</span>
<span id="cb31-220"><a href="#cb31-220"></a>RETURN</span>
<span id="cb31-221"><a href="#cb31-221"></a>    <span class="fu">COUNTROWS</span> (</span>
<span id="cb31-222"><a href="#cb31-222"></a>        <span class="fu">FILTER</span> (</span>
<span id="cb31-223"><a href="#cb31-223"></a>            Orders<span class="op">,</span></span>
<span id="cb31-224"><a href="#cb31-224"></a>            [Revenue after discount] <span class="op">&gt;</span> Avg_order_rev_1997</span>
<span id="cb31-225"><a href="#cb31-225"></a>                <span class="op">&amp;&amp;</span> <span class="fu">YEAR</span> ( Orders[OrderDate] ) <span class="op">=</span> <span class="dv">1997</span></span>
<span id="cb31-226"><a href="#cb31-226"></a>        )</span>
<span id="cb31-227"><a href="#cb31-227"></a>    )</span>
<span id="cb31-228"><a href="#cb31-228"></a><span class="in">```</span></span>
<span id="cb31-229"><a href="#cb31-229"></a></span>
<span id="cb31-230"><a href="#cb31-230"></a>There are 145 high-value orders in the year 1997!</span>
<span id="cb31-231"><a href="#cb31-231"></a></span>
<span id="cb31-232"><a href="#cb31-232"></a><span class="fu">## Day 8: Number of orders delivered on time?</span></span>
<span id="cb31-233"><a href="#cb31-233"></a></span>
<span id="cb31-234"><a href="#cb31-234"></a>Curbal seems to prefer using <span class="in">`SUMMARIZE()`</span> everywhere, I think the solution is relatively simple of <span class="in">`COUNTROWS()`</span> after some <span class="in">`FILTER()`</span>. Here is my initial solution:</span>
<span id="cb31-235"><a href="#cb31-235"></a></span>
<span id="cb31-236"><a href="#cb31-236"></a><span class="in">```js</span></span>
<span id="cb31-237"><a href="#cb31-237"></a>D8 <span class="op">=</span></span>
<span id="cb31-238"><a href="#cb31-238"></a><span class="fu">COUNTROWS</span> (</span>
<span id="cb31-239"><a href="#cb31-239"></a>    <span class="fu">FILTER</span> (</span>
<span id="cb31-240"><a href="#cb31-240"></a>        Orders<span class="op">,</span></span>
<span id="cb31-241"><a href="#cb31-241"></a>        NOT <span class="fu">ISBLANK</span> ( Orders[ShippedDate] )</span>
<span id="cb31-242"><a href="#cb31-242"></a>            <span class="op">&amp;&amp;</span> <span class="fu">DATEDIFF</span> ( Orders[RequiredDate]<span class="op">,</span> Orders[ShippedDate]<span class="op">,</span> DAY ) <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb31-243"><a href="#cb31-243"></a>    )</span>
<span id="cb31-244"><a href="#cb31-244"></a>)</span>
<span id="cb31-245"><a href="#cb31-245"></a><span class="in">```</span></span>
<span id="cb31-246"><a href="#cb31-246"></a></span>
<span id="cb31-247"><a href="#cb31-247"></a>I asked Claude 3.5 Sonnet to optimized this and he said the combination of <span class="in">`FILTER()`</span> and <span class="in">`DATEDIFF()`</span> might be expensive, his solution is:</span>
<span id="cb31-248"><a href="#cb31-248"></a></span>
<span id="cb31-249"><a href="#cb31-249"></a><span class="in">```js</span></span>
<span id="cb31-250"><a href="#cb31-250"></a>D8 <span class="op">=</span> </span>
<span id="cb31-251"><a href="#cb31-251"></a><span class="fu">CALCULATE</span>(</span>
<span id="cb31-252"><a href="#cb31-252"></a>    <span class="fu">COUNTROWS</span>(Orders)<span class="op">,</span></span>
<span id="cb31-253"><a href="#cb31-253"></a>    Orders[ShippedDate] <span class="op">&lt;&gt;</span> <span class="fu">BLANK</span>()<span class="op">,</span></span>
<span id="cb31-254"><a href="#cb31-254"></a>    Orders[RequiredDate] <span class="op">=</span> Orders[ShippedDate]</span>
<span id="cb31-255"><a href="#cb31-255"></a>)</span>
<span id="cb31-256"><a href="#cb31-256"></a><span class="in">```</span></span>
<span id="cb31-257"><a href="#cb31-257"></a></span>
<span id="cb31-258"><a href="#cb31-258"></a>Cool! There is 3 such orders.</span>
<span id="cb31-259"><a href="#cb31-259"></a></span>
<span id="cb31-260"><a href="#cb31-260"></a>If we use the logic <span class="in">`Orders[RequiredDate] &gt;= Orders[ShippedDate]`</span>, there is 772 orders. IMHO I think this make more sense!</span>
<span id="cb31-261"><a href="#cb31-261"></a></span>
<span id="cb31-262"><a href="#cb31-262"></a><span class="fu">## Day 9: The single month with highest sales?</span></span>
<span id="cb31-263"><a href="#cb31-263"></a></span>
<span id="cb31-264"><a href="#cb31-264"></a><span class="in">```js</span></span>
<span id="cb31-265"><a href="#cb31-265"></a>D9 <span class="op">=</span></span>
<span id="cb31-266"><a href="#cb31-266"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb31-267"><a href="#cb31-267"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb31-268"><a href="#cb31-268"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb31-269"><a href="#cb31-269"></a>        <span class="fu">ADDCOLUMNS</span> (</span>
<span id="cb31-270"><a href="#cb31-270"></a>            <span class="fu">SUMMARIZE</span> ( <span class="st">'Calendar'</span><span class="op">,</span> <span class="st">'Calendar'</span>[Year<span class="op">-</span>Month] )<span class="op">,</span></span>
<span id="cb31-271"><a href="#cb31-271"></a>            <span class="st">"Total rev"</span><span class="op">,</span> [Revenue after discount]</span>
<span id="cb31-272"><a href="#cb31-272"></a>        )<span class="op">,</span></span>
<span id="cb31-273"><a href="#cb31-273"></a>        [Revenue after discount]<span class="op">,</span> DESC</span>
<span id="cb31-274"><a href="#cb31-274"></a>    )<span class="op">,</span></span>
<span id="cb31-275"><a href="#cb31-275"></a>    <span class="st">'Calendar'</span>[Year<span class="op">-</span>Month]<span class="op">,</span></span>
<span id="cb31-276"><a href="#cb31-276"></a>    <span class="st">", "</span><span class="op">,</span></span>
<span id="cb31-277"><a href="#cb31-277"></a>    <span class="st">'Calendar'</span>[Year<span class="op">-</span>Month]<span class="op">,</span> ASC</span>
<span id="cb31-278"><a href="#cb31-278"></a>)</span>
<span id="cb31-279"><a href="#cb31-279"></a><span class="in">```</span></span>
<span id="cb31-280"><a href="#cb31-280"></a></span>
<span id="cb31-281"><a href="#cb31-281"></a>Pretty simple, it's 1998-Apr!</span>
<span id="cb31-282"><a href="#cb31-282"></a></span>
<span id="cb31-283"><a href="#cb31-283"></a><span class="fu">## Day 10: Best sales (week) day for queso cabrales?</span></span>
<span id="cb31-284"><a href="#cb31-284"></a></span>
<span id="cb31-285"><a href="#cb31-285"></a><span class="in">```js</span></span>
<span id="cb31-286"><a href="#cb31-286"></a>D10 <span class="op">=</span></span>
<span id="cb31-287"><a href="#cb31-287"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb31-288"><a href="#cb31-288"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb31-289"><a href="#cb31-289"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb31-290"><a href="#cb31-290"></a>        <span class="fu">ADDCOLUMNS</span> (</span>
<span id="cb31-291"><a href="#cb31-291"></a>            <span class="fu">SUMMARIZE</span> ( <span class="st">'Calendar'</span><span class="op">,</span> <span class="st">'Calendar'</span>[Day Name] )<span class="op">,</span></span>
<span id="cb31-292"><a href="#cb31-292"></a>            <span class="st">"Queso Cabrales sales"</span><span class="op">,</span> <span class="fu">CALCULATE</span> ( [Revenue after discount]<span class="op">,</span> Products[ProductName] <span class="op">=</span> <span class="st">"Queso Cabrales"</span> )</span>
<span id="cb31-293"><a href="#cb31-293"></a>        )<span class="op">,</span></span>
<span id="cb31-294"><a href="#cb31-294"></a>        [Queso Cabrales sales]<span class="op">,</span> DESC</span>
<span id="cb31-295"><a href="#cb31-295"></a>    )<span class="op">,</span></span>
<span id="cb31-296"><a href="#cb31-296"></a>    <span class="st">'Calendar'</span>[Day Name]<span class="op">,</span></span>
<span id="cb31-297"><a href="#cb31-297"></a>    <span class="st">", "</span><span class="op">,</span></span>
<span id="cb31-298"><a href="#cb31-298"></a>    <span class="st">'Calendar'</span>[Day Name]<span class="op">,</span> ASC</span>
<span id="cb31-299"><a href="#cb31-299"></a>)</span>
<span id="cb31-300"><a href="#cb31-300"></a><span class="in">```</span></span>
<span id="cb31-301"><a href="#cb31-301"></a></span>
<span id="cb31-302"><a href="#cb31-302"></a>This is an enhanced version from Claude 3.5 Sonnet:</span>
<span id="cb31-303"><a href="#cb31-303"></a></span>
<span id="cb31-304"><a href="#cb31-304"></a><span class="in">```js</span></span>
<span id="cb31-305"><a href="#cb31-305"></a>D10a <span class="op">=</span> </span>
<span id="cb31-306"><a href="#cb31-306"></a><span class="fu">CALCULATE</span>(</span>
<span id="cb31-307"><a href="#cb31-307"></a>    <span class="fu">MAX</span>(<span class="st">'Calendar'</span>[Day Name])<span class="op">,</span> <span class="co">// trickily put an aggregation function here!</span></span>
<span id="cb31-308"><a href="#cb31-308"></a>    <span class="fu">TOPN</span>(</span>
<span id="cb31-309"><a href="#cb31-309"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb31-310"><a href="#cb31-310"></a>        <span class="fu">VALUES</span>(<span class="st">'Calendar'</span>[Day Name])<span class="op">,</span></span>
<span id="cb31-311"><a href="#cb31-311"></a>        <span class="co">// Using VALUES() here effectively says "give me the distinct day names, then order them by the sales amount"</span></span>
<span id="cb31-312"><a href="#cb31-312"></a>        <span class="fu">CALCULATE</span>(</span>
<span id="cb31-313"><a href="#cb31-313"></a>            [Revenue after discount]<span class="op">,</span></span>
<span id="cb31-314"><a href="#cb31-314"></a>            Products[ProductName] <span class="op">=</span> <span class="st">"Queso Cabrales"</span></span>
<span id="cb31-315"><a href="#cb31-315"></a>        )<span class="op">,</span></span>
<span id="cb31-316"><a href="#cb31-316"></a>        DESC</span>
<span id="cb31-317"><a href="#cb31-317"></a>    )</span>
<span id="cb31-318"><a href="#cb31-318"></a>)</span>
<span id="cb31-319"><a href="#cb31-319"></a><span class="in">```</span></span>
<span id="cb31-320"><a href="#cb31-320"></a></span>
<span id="cb31-321"><a href="#cb31-321"></a>Bravo Tuesday!</span>
<span id="cb31-322"><a href="#cb31-322"></a></span>
<span id="cb31-323"><a href="#cb31-323"></a><span class="fu">## Day 11: Customer with the highest customer lifespan?</span></span>
<span id="cb31-324"><a href="#cb31-324"></a></span>
<span id="cb31-325"><a href="#cb31-325"></a>I have walked around with the <span class="in">`VALUES()`</span> magic but failed with the lifespan calculation.</span>
<span id="cb31-326"><a href="#cb31-326"></a>Claude helped me with this, and if we can confidently ensure there is no duplicated company name for 2 different companies/customers,</span>
<span id="cb31-327"><a href="#cb31-327"></a>this is a very concise solution:</span>
<span id="cb31-328"><a href="#cb31-328"></a></span>
<span id="cb31-329"><a href="#cb31-329"></a><span class="in">```js</span></span>
<span id="cb31-330"><a href="#cb31-330"></a>D11 <span class="op">=</span></span>
<span id="cb31-331"><a href="#cb31-331"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb31-332"><a href="#cb31-332"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb31-333"><a href="#cb31-333"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb31-334"><a href="#cb31-334"></a>        <span class="fu">VALUES</span> ( Customers[CompanyName] )<span class="op">,</span></span>
<span id="cb31-335"><a href="#cb31-335"></a>        <span class="fu">CALCULATE</span> ( <span class="fu">MAX</span> ( Orders[OrderDate] ) <span class="op">-</span> <span class="fu">MIN</span> ( Orders[OrderDate] ) )<span class="op">,</span> DESC</span>
<span id="cb31-336"><a href="#cb31-336"></a>    )<span class="op">,</span></span>
<span id="cb31-337"><a href="#cb31-337"></a>    Customers[CompanyName]<span class="op">,</span></span>
<span id="cb31-338"><a href="#cb31-338"></a>    <span class="st">", "</span></span>
<span id="cb31-339"><a href="#cb31-339"></a>)</span>
<span id="cb31-340"><a href="#cb31-340"></a><span class="in">```</span></span>
<span id="cb31-341"><a href="#cb31-341"></a></span>
<span id="cb31-342"><a href="#cb31-342"></a>The answer is: Richter Supermarkt! Love you.</span>
<span id="cb31-343"><a href="#cb31-343"></a></span>
<span id="cb31-344"><a href="#cb31-344"></a><span class="fu">## Day 12: Which customer had placed most orders?</span></span>
<span id="cb31-345"><a href="#cb31-345"></a></span>
<span id="cb31-346"><a href="#cb31-346"></a>This time I've successfully implemented this pattern!</span>
<span id="cb31-347"><a href="#cb31-347"></a></span>
<span id="cb31-348"><a href="#cb31-348"></a><span class="in">```js</span></span>
<span id="cb31-349"><a href="#cb31-349"></a>D12 <span class="op">=</span></span>
<span id="cb31-350"><a href="#cb31-350"></a><span class="fu">TOPN</span> (</span>
<span id="cb31-351"><a href="#cb31-351"></a>    <span class="dv">1</span><span class="op">,</span></span>
<span id="cb31-352"><a href="#cb31-352"></a>    <span class="fu">VALUES</span> ( Customers[CompanyName] )<span class="op">,</span></span>
<span id="cb31-353"><a href="#cb31-353"></a>    <span class="fu">CALCULATE</span> ( <span class="fu">COUNT</span> ( Orders[OrderID] ) )<span class="op">,</span> DESC</span>
<span id="cb31-354"><a href="#cb31-354"></a>)</span>
<span id="cb31-355"><a href="#cb31-355"></a><span class="in">```</span></span>
<span id="cb31-356"><a href="#cb31-356"></a></span>
<span id="cb31-357"><a href="#cb31-357"></a>This is Save-a-lot Markets!</span>
<span id="cb31-358"><a href="#cb31-358"></a></span>
<span id="cb31-359"><a href="#cb31-359"></a><span class="fu">## Day 13: Top 5 countries with the highest number of customers?</span></span>
<span id="cb31-360"><a href="#cb31-360"></a></span>
<span id="cb31-361"><a href="#cb31-361"></a>Quick check and I found that no customer in the Customers table did not order any order.</span>
<span id="cb31-362"><a href="#cb31-362"></a>So we just need to care/count on the Customers table only. Quite straightforwar!</span>
<span id="cb31-363"><a href="#cb31-363"></a></span>
<span id="cb31-364"><a href="#cb31-364"></a><span class="in">```js</span></span>
<span id="cb31-365"><a href="#cb31-365"></a>D13 <span class="op">=</span></span>
<span id="cb31-366"><a href="#cb31-366"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb31-367"><a href="#cb31-367"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb31-368"><a href="#cb31-368"></a>        <span class="dv">5</span><span class="op">,</span></span>
<span id="cb31-369"><a href="#cb31-369"></a>        <span class="fu">VALUES</span> ( Customers[Country] )<span class="op">,</span></span>
<span id="cb31-370"><a href="#cb31-370"></a>        <span class="fu">CALCULATE</span> ( <span class="fu">COUNT</span> ( Customers[CustomerID] ) )<span class="op">,</span> DESC</span>
<span id="cb31-371"><a href="#cb31-371"></a>    )<span class="op">,</span></span>
<span id="cb31-372"><a href="#cb31-372"></a>    Customers[Country]<span class="op">,</span></span>
<span id="cb31-373"><a href="#cb31-373"></a>    <span class="st">", "</span><span class="op">,</span></span>
<span id="cb31-374"><a href="#cb31-374"></a>    <span class="fu">CALCULATE</span> ( <span class="fu">COUNT</span> ( Customers[CustomerID] ) )<span class="op">,</span> DESC</span>
<span id="cb31-375"><a href="#cb31-375"></a>)</span>
<span id="cb31-376"><a href="#cb31-376"></a><span class="in">```</span></span>
<span id="cb31-377"><a href="#cb31-377"></a></span>
<span id="cb31-378"><a href="#cb31-378"></a>I am in love with this pattern, the answer is: USA, Germany, France, Brazil, UK!</span>
<span id="cb31-379"><a href="#cb31-379"></a></span>
<span id="cb31-380"><a href="#cb31-380"></a><span class="fu">## Day 14: Which customer placed the highest value of order (sales) in 1997?</span></span>
<span id="cb31-381"><a href="#cb31-381"></a></span>
<span id="cb31-382"><a href="#cb31-382"></a>It's QUICK-Stop!</span>
<span id="cb31-383"><a href="#cb31-383"></a></span>
<span id="cb31-384"><a href="#cb31-384"></a><span class="in">```js</span></span>
<span id="cb31-385"><a href="#cb31-385"></a>D14 <span class="op">=</span></span>
<span id="cb31-386"><a href="#cb31-386"></a><span class="fu">TOPN</span> (</span>
<span id="cb31-387"><a href="#cb31-387"></a>    <span class="dv">1</span><span class="op">,</span></span>
<span id="cb31-388"><a href="#cb31-388"></a>    <span class="fu">VALUES</span> ( Customers[CompanyName] )<span class="op">,</span></span>
<span id="cb31-389"><a href="#cb31-389"></a>    <span class="fu">CALCULATE</span> ( [Revenue after discount]<span class="op">,</span> <span class="fu">YEAR</span> ( Orders[OrderDate] ) <span class="op">=</span> <span class="dv">1997</span> )<span class="op">,</span> DESC</span>
<span id="cb31-390"><a href="#cb31-390"></a>)</span>
<span id="cb31-391"><a href="#cb31-391"></a><span class="in">```</span></span>
<span id="cb31-392"><a href="#cb31-392"></a></span>
<span id="cb31-393"><a href="#cb31-393"></a><span class="fu">## Day 15: Customer with the highest number of orders in one single month?</span></span>
<span id="cb31-394"><a href="#cb31-394"></a></span>
<span id="cb31-395"><a href="#cb31-395"></a><span class="in">```js</span></span>
<span id="cb31-396"><a href="#cb31-396"></a>D15 <span class="op">=</span></span>
<span id="cb31-397"><a href="#cb31-397"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb31-398"><a href="#cb31-398"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb31-399"><a href="#cb31-399"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb31-400"><a href="#cb31-400"></a>        <span class="fu">ADDCOLUMNS</span> (</span>
<span id="cb31-401"><a href="#cb31-401"></a>            <span class="fu">SUMMARIZE</span> ( Orders<span class="op">,</span> Customers[CompanyName]<span class="op">,</span> <span class="st">'Calendar'</span>[Year<span class="op">-</span>Month] )<span class="op">,</span></span>
<span id="cb31-402"><a href="#cb31-402"></a>            <span class="st">"order_count"</span><span class="op">,</span> <span class="fu">CALCULATE</span> ( <span class="fu">COUNT</span> ( Orders[OrderID] ) )</span>
<span id="cb31-403"><a href="#cb31-403"></a>        )<span class="op">,</span></span>
<span id="cb31-404"><a href="#cb31-404"></a>        [order_count]<span class="op">,</span> DESC</span>
<span id="cb31-405"><a href="#cb31-405"></a>    )<span class="op">,</span></span>
<span id="cb31-406"><a href="#cb31-406"></a>    Customers[CompanyName]<span class="op">,</span></span>
<span id="cb31-407"><a href="#cb31-407"></a>    <span class="st">", "</span><span class="op">,</span></span>
<span id="cb31-408"><a href="#cb31-408"></a>    Customers[CompanyName]<span class="op">,</span> DESC</span>
<span id="cb31-409"><a href="#cb31-409"></a>)</span>
<span id="cb31-410"><a href="#cb31-410"></a><span class="in">```</span></span>
<span id="cb31-411"><a href="#cb31-411"></a></span>
<span id="cb31-412"><a href="#cb31-412"></a>There are 3 customers have 5 orders in one single month: Bottom-Dollar Markets, Ernst Handel, and Save-a-lot Markets!</span>
<span id="cb31-413"><a href="#cb31-413"></a></span>
<span id="cb31-414"><a href="#cb31-414"></a><span class="fu">## Day 16: Employee with the highest average order value (in sales)?</span></span>
<span id="cb31-415"><a href="#cb31-415"></a></span>
<span id="cb31-416"><a href="#cb31-416"></a><span class="in">```js</span></span>
<span id="cb31-417"><a href="#cb31-417"></a>D16 <span class="op">=</span></span>
<span id="cb31-418"><a href="#cb31-418"></a><span class="fu">TOPN</span> (</span>
<span id="cb31-419"><a href="#cb31-419"></a>    <span class="dv">1</span><span class="op">,</span></span>
<span id="cb31-420"><a href="#cb31-420"></a>    <span class="fu">VALUES</span> ( Employees[Full Name] )<span class="op">,</span></span>
<span id="cb31-421"><a href="#cb31-421"></a>    <span class="fu">CALCULATE</span> ( <span class="fu">DIVIDE</span> ( [Revenue after discount]<span class="op">,</span> <span class="fu">COUNT</span> ( Orders[OrderID] ) ) )<span class="op">,</span> DESC</span>
<span id="cb31-422"><a href="#cb31-422"></a>)</span>
<span id="cb31-423"><a href="#cb31-423"></a><span class="co">// AVERAGEX wouldn't work here because the measure is already doing a sum across Order_Details</span></span>
<span id="cb31-424"><a href="#cb31-424"></a><span class="in">```</span></span>
<span id="cb31-425"><a href="#cb31-425"></a></span>
<span id="cb31-426"><a href="#cb31-426"></a>She is Anne Dodsworth.</span>
<span id="cb31-427"><a href="#cb31-427"></a></span>
<span id="cb31-428"><a href="#cb31-428"></a><span class="fu">## Day 17: Employee with the longest average processing order time?</span></span>
<span id="cb31-429"><a href="#cb31-429"></a></span>
<span id="cb31-430"><a href="#cb31-430"></a>It's also Dodsworth!</span>
<span id="cb31-431"><a href="#cb31-431"></a></span>
<span id="cb31-432"><a href="#cb31-432"></a><span class="in">```js</span></span>
<span id="cb31-433"><a href="#cb31-433"></a>D17 <span class="op">=</span> </span>
<span id="cb31-434"><a href="#cb31-434"></a><span class="fu">TOPN</span>(</span>
<span id="cb31-435"><a href="#cb31-435"></a>    <span class="dv">1</span><span class="op">,</span></span>
<span id="cb31-436"><a href="#cb31-436"></a>    <span class="fu">VALUES</span>(Employees[Full Name])<span class="op">,</span></span>
<span id="cb31-437"><a href="#cb31-437"></a>    <span class="fu">CALCULATE</span>( </span>
<span id="cb31-438"><a href="#cb31-438"></a>        <span class="fu">AVERAGEX</span>(</span>
<span id="cb31-439"><a href="#cb31-439"></a>            <span class="fu">FILTER</span>(Orders<span class="op">,</span> Orders[ShippedDate] <span class="op">&lt;&gt;</span> <span class="fu">BLANK</span>())<span class="op">,</span></span>
<span id="cb31-440"><a href="#cb31-440"></a>            <span class="fu">DATEDIFF</span>(Orders[OrderDate]<span class="op">,</span> Orders[ShippedDate]<span class="op">,</span> DAY)</span>
<span id="cb31-441"><a href="#cb31-441"></a>        )</span>
<span id="cb31-442"><a href="#cb31-442"></a>    )<span class="op">,</span></span>
<span id="cb31-443"><a href="#cb31-443"></a>    DESC</span>
<span id="cb31-444"><a href="#cb31-444"></a>)</span>
<span id="cb31-445"><a href="#cb31-445"></a><span class="in">```</span></span>
<span id="cb31-446"><a href="#cb31-446"></a></span>
<span id="cb31-447"><a href="#cb31-447"></a><span class="fu">## Day 18: Which employee has been in the company the longest?</span></span>
<span id="cb31-448"><a href="#cb31-448"></a></span>
<span id="cb31-449"><a href="#cb31-449"></a><span class="in">```js</span></span>
<span id="cb31-450"><a href="#cb31-450"></a>D18 <span class="op">=</span> </span>
<span id="cb31-451"><a href="#cb31-451"></a><span class="fu">CONCATENATEX</span>(</span>
<span id="cb31-452"><a href="#cb31-452"></a>    <span class="fu">TOPN</span>(</span>
<span id="cb31-453"><a href="#cb31-453"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb31-454"><a href="#cb31-454"></a>        <span class="fu">VALUES</span>(Employees[Full Name])<span class="op">,</span></span>
<span id="cb31-455"><a href="#cb31-455"></a>        <span class="fu">CALCULATE</span>( <span class="fu">MIN</span>( Employees[HireDate]) )<span class="op">,</span></span>
<span id="cb31-456"><a href="#cb31-456"></a>        ASC</span>
<span id="cb31-457"><a href="#cb31-457"></a>    )<span class="op">,</span></span>
<span id="cb31-458"><a href="#cb31-458"></a>    Employees[Full Name]<span class="op">,</span></span>
<span id="cb31-459"><a href="#cb31-459"></a>    <span class="st">", "</span></span>
<span id="cb31-460"><a href="#cb31-460"></a>)</span>
<span id="cb31-461"><a href="#cb31-461"></a><span class="in">```</span></span>
<span id="cb31-462"><a href="#cb31-462"></a></span>
<span id="cb31-463"><a href="#cb31-463"></a>Janet Leverling!</span>
<span id="cb31-464"><a href="#cb31-464"></a></span>
<span id="cb31-465"><a href="#cb31-465"></a><span class="fu">## Day 19: Name of all Northwind managers?</span></span>
<span id="cb31-466"><a href="#cb31-466"></a></span>
<span id="cb31-467"><a href="#cb31-467"></a>Anyone who has an employee reporting to themself is a manager! They are Andrew Fuller, Nancy Davolio, Steven Buchanan.</span>
<span id="cb31-468"><a href="#cb31-468"></a></span>
<span id="cb31-469"><a href="#cb31-469"></a><span class="in">```js</span></span>
<span id="cb31-470"><a href="#cb31-470"></a>D19 <span class="op">=</span></span>
<span id="cb31-471"><a href="#cb31-471"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb31-472"><a href="#cb31-472"></a>    <span class="fu">FILTER</span> ( Employees<span class="op">,</span> Employees[EmployeeID] IN <span class="fu">VALUES</span> ( Employees[ReportsTo] ) )<span class="op">,</span></span>
<span id="cb31-473"><a href="#cb31-473"></a>    Employees[Full Name]<span class="op">,</span></span>
<span id="cb31-474"><a href="#cb31-474"></a>    <span class="st">", "</span><span class="op">,</span></span>
<span id="cb31-475"><a href="#cb31-475"></a>    Employees[Full Name]<span class="op">,</span> ASC</span>
<span id="cb31-476"><a href="#cb31-476"></a>)</span>
<span id="cb31-477"><a href="#cb31-477"></a><span class="in">```</span></span>
<span id="cb31-478"><a href="#cb31-478"></a></span>
<span id="cb31-479"><a href="#cb31-479"></a><span class="fu">## Day 20: Which employee handle the most unique customers?</span></span>
<span id="cb31-480"><a href="#cb31-480"></a></span>
<span id="cb31-481"><a href="#cb31-481"></a>There is no direct relationship from Employees to Customers table, we will be working on the Orders table!</span>
<span id="cb31-482"><a href="#cb31-482"></a></span>
<span id="cb31-483"><a href="#cb31-483"></a><span class="in">```js</span></span>
<span id="cb31-484"><a href="#cb31-484"></a>D20 <span class="op">=</span></span>
<span id="cb31-485"><a href="#cb31-485"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb31-486"><a href="#cb31-486"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb31-487"><a href="#cb31-487"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb31-488"><a href="#cb31-488"></a>        <span class="fu">VALUES</span> ( Employees[Full Name] )<span class="op">,</span></span>
<span id="cb31-489"><a href="#cb31-489"></a>        <span class="fu">CALCULATE</span> ( <span class="fu">DISTINCTCOUNT</span> ( Orders[CustomerID] ) )</span>
<span id="cb31-490"><a href="#cb31-490"></a>    )<span class="op">,</span></span>
<span id="cb31-491"><a href="#cb31-491"></a>    Employees[Full Name]<span class="op">,</span></span>
<span id="cb31-492"><a href="#cb31-492"></a>    <span class="st">", "</span></span>
<span id="cb31-493"><a href="#cb31-493"></a>)</span>
<span id="cb31-494"><a href="#cb31-494"></a><span class="in">```</span></span>
<span id="cb31-495"><a href="#cb31-495"></a></span>
<span id="cb31-496"><a href="#cb31-496"></a>Margaret Peacock!</span>
<span id="cb31-497"><a href="#cb31-497"></a></span>
<span id="cb31-498"><a href="#cb31-498"></a><span class="fu">## Day 21: Number of suppliers that deliver more product items than average?</span></span>
<span id="cb31-499"><a href="#cb31-499"></a></span>
<span id="cb31-500"><a href="#cb31-500"></a>There are 16!</span>
<span id="cb31-501"><a href="#cb31-501"></a></span>
<span id="cb31-502"><a href="#cb31-502"></a><span class="in">```js</span></span>
<span id="cb31-503"><a href="#cb31-503"></a>D21 <span class="op">=</span></span>
<span id="cb31-504"><a href="#cb31-504"></a>VAR supplier_n_product <span class="op">=</span></span>
<span id="cb31-505"><a href="#cb31-505"></a>    <span class="fu">ADDCOLUMNS</span> (</span>
<span id="cb31-506"><a href="#cb31-506"></a>        <span class="fu">SUMMARIZE</span> ( Suppliers<span class="op">,</span> Suppliers[SupplierID]<span class="op">,</span> Suppliers[CompanyName] )<span class="op">,</span></span>
<span id="cb31-507"><a href="#cb31-507"></a>        <span class="st">"count product"</span><span class="op">,</span> <span class="fu">CALCULATE</span> ( <span class="fu">COUNT</span> ( Products[CategoryID] ) )</span>
<span id="cb31-508"><a href="#cb31-508"></a>    )</span>
<span id="cb31-509"><a href="#cb31-509"></a>RETURN</span>
<span id="cb31-510"><a href="#cb31-510"></a>    <span class="fu">COUNTROWS</span> (</span>
<span id="cb31-511"><a href="#cb31-511"></a>        <span class="fu">FILTER</span> (</span>
<span id="cb31-512"><a href="#cb31-512"></a>            supplier_n_product<span class="op">,</span></span>
<span id="cb31-513"><a href="#cb31-513"></a>            [count product] <span class="op">&gt;</span> <span class="fu">AVERAGEX</span> ( supplier_n_product<span class="op">,</span> [count product] )</span>
<span id="cb31-514"><a href="#cb31-514"></a>        )</span>
<span id="cb31-515"><a href="#cb31-515"></a>    )</span>
<span id="cb31-516"><a href="#cb31-516"></a><span class="in">```</span></span>
<span id="cb31-517"><a href="#cb31-517"></a></span>
<span id="cb31-518"><a href="#cb31-518"></a><span class="fu">## Day 22: Suppliers with most stocked-out products?</span></span>
<span id="cb31-519"><a href="#cb31-519"></a></span>
<span id="cb31-520"><a href="#cb31-520"></a>Confidently assumed there is no duplicated CompanyName haha:</span>
<span id="cb31-521"><a href="#cb31-521"></a></span>
<span id="cb31-522"><a href="#cb31-522"></a><span class="in">```js</span></span>
<span id="cb31-523"><a href="#cb31-523"></a>D22 <span class="op">=</span></span>
<span id="cb31-524"><a href="#cb31-524"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb31-525"><a href="#cb31-525"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb31-526"><a href="#cb31-526"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb31-527"><a href="#cb31-527"></a>        <span class="fu">VALUES</span> ( Suppliers[CompanyName] )<span class="op">,</span></span>
<span id="cb31-528"><a href="#cb31-528"></a>        <span class="fu">CALCULATE</span> ( <span class="fu">COUNT</span> ( Products[ProductID] )<span class="op">,</span> Products[UnitsInStock] <span class="op">=</span> <span class="dv">0</span> )<span class="op">,</span> DESC</span>
<span id="cb31-529"><a href="#cb31-529"></a>    )<span class="op">,</span></span>
<span id="cb31-530"><a href="#cb31-530"></a>    Suppliers[CompanyName]<span class="op">,</span></span>
<span id="cb31-531"><a href="#cb31-531"></a>    <span class="st">", "</span></span>
<span id="cb31-532"><a href="#cb31-532"></a>)</span>
<span id="cb31-533"><a href="#cb31-533"></a><span class="in">```</span></span>
<span id="cb31-534"><a href="#cb31-534"></a></span>
<span id="cb31-535"><a href="#cb31-535"></a>The answer is: New Orleans Cajun Delights, Pavlova, Ltd., Plutzer Lebensmittelgroßmärkte AG, Formaggi Fortini s.r.l., and "G'day, Mate"!</span>
<span id="cb31-536"><a href="#cb31-536"></a></span>
<span id="cb31-537"><a href="#cb31-537"></a><span class="fu">## Day 23: Which supplier delivers the most expensive product?</span></span>
<span id="cb31-538"><a href="#cb31-538"></a></span>
<span id="cb31-539"><a href="#cb31-539"></a>We need to focus on the Products table which lists the current price rather than the Orders table contained sold items ~ historical price.</span>
<span id="cb31-540"><a href="#cb31-540"></a></span>
<span id="cb31-541"><a href="#cb31-541"></a><span class="in">```js</span></span>
<span id="cb31-542"><a href="#cb31-542"></a>D23 <span class="op">=</span></span>
<span id="cb31-543"><a href="#cb31-543"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb31-544"><a href="#cb31-544"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb31-545"><a href="#cb31-545"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb31-546"><a href="#cb31-546"></a>        <span class="fu">VALUES</span> ( Suppliers[CompanyName] )<span class="op">,</span></span>
<span id="cb31-547"><a href="#cb31-547"></a>        <span class="fu">CALCULATE</span> ( <span class="fu">MAX</span> ( Products[UnitPrice] ) )<span class="op">,</span> DESC</span>
<span id="cb31-548"><a href="#cb31-548"></a>    )<span class="op">,</span></span>
<span id="cb31-549"><a href="#cb31-549"></a>    Suppliers[CompanyName]<span class="op">,</span></span>
<span id="cb31-550"><a href="#cb31-550"></a>    <span class="st">", "</span></span>
<span id="cb31-551"><a href="#cb31-551"></a>)</span>
<span id="cb31-552"><a href="#cb31-552"></a><span class="in">```</span></span>
<span id="cb31-553"><a href="#cb31-553"></a></span>
<span id="cb31-554"><a href="#cb31-554"></a>It's is Aux joyeux ecclésiastiques!</span>
<span id="cb31-555"><a href="#cb31-555"></a></span>
<span id="cb31-556"><a href="#cb31-556"></a><span class="fu">## Day 24: Which supplier has the highest category diversity?</span></span>
<span id="cb31-557"><a href="#cb31-557"></a></span>
<span id="cb31-558"><a href="#cb31-558"></a>Note that there is no relationship between Suppliers table and Categories table. So we will be using <span class="in">`CategoryID`</span> in the Products table:</span>
<span id="cb31-559"><a href="#cb31-559"></a></span>
<span id="cb31-560"><a href="#cb31-560"></a><span class="in">```js</span></span>
<span id="cb31-561"><a href="#cb31-561"></a>D24 <span class="op">=</span> </span>
<span id="cb31-562"><a href="#cb31-562"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb31-563"><a href="#cb31-563"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb31-564"><a href="#cb31-564"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb31-565"><a href="#cb31-565"></a>        <span class="fu">VALUES</span> ( Suppliers[CompanyName] )<span class="op">,</span></span>
<span id="cb31-566"><a href="#cb31-566"></a>        <span class="fu">CALCULATE</span> ( <span class="fu">COUNT</span> ( Products[CategoryID] ) )<span class="op">,</span> DESC</span>
<span id="cb31-567"><a href="#cb31-567"></a>    )<span class="op">,</span></span>
<span id="cb31-568"><a href="#cb31-568"></a>    Suppliers[CompanyName]<span class="op">,</span></span>
<span id="cb31-569"><a href="#cb31-569"></a>    <span class="st">", "</span></span>
<span id="cb31-570"><a href="#cb31-570"></a>)</span>
<span id="cb31-571"><a href="#cb31-571"></a><span class="in">```</span></span>
<span id="cb31-572"><a href="#cb31-572"></a></span>
<span id="cb31-573"><a href="#cb31-573"></a>It's Pavlova, Ltd., Plutzer Lebensmittelgroßmärkte AG.</span>
<span id="cb31-574"><a href="#cb31-574"></a></span>
<span id="cb31-575"><a href="#cb31-575"></a><span class="fu">## Day 25: Supplier with highest number of top 5 selling products?</span></span>
<span id="cb31-576"><a href="#cb31-576"></a></span>
<span id="cb31-577"><a href="#cb31-577"></a>We need to do 2 steps: listing top 5 selling products, and then filter the top 1 supplier that delivers:</span>
<span id="cb31-578"><a href="#cb31-578"></a></span>
<span id="cb31-579"><a href="#cb31-579"></a><span class="in">```js</span></span>
<span id="cb31-580"><a href="#cb31-580"></a>D25 <span class="op">=</span> </span>
<span id="cb31-581"><a href="#cb31-581"></a>VAR Top_5_products <span class="op">=</span> <span class="fu">TOPN</span>(</span>
<span id="cb31-582"><a href="#cb31-582"></a>    <span class="dv">5</span><span class="op">,</span></span>
<span id="cb31-583"><a href="#cb31-583"></a>    <span class="fu">VALUES</span>(Products[ProductID])<span class="op">,</span></span>
<span id="cb31-584"><a href="#cb31-584"></a>    [Revenue after discount]</span>
<span id="cb31-585"><a href="#cb31-585"></a>)</span>
<span id="cb31-586"><a href="#cb31-586"></a>RETURN</span>
<span id="cb31-587"><a href="#cb31-587"></a><span class="fu">CONCATENATEX</span> (</span>
<span id="cb31-588"><a href="#cb31-588"></a>    <span class="fu">TOPN</span> (</span>
<span id="cb31-589"><a href="#cb31-589"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb31-590"><a href="#cb31-590"></a>        <span class="fu">VALUES</span> ( Suppliers[CompanyName] )<span class="op">,</span></span>
<span id="cb31-591"><a href="#cb31-591"></a>        <span class="fu">CALCULATE</span> ( <span class="fu">COUNT</span> ( Products[ProductID] )<span class="op">,</span> Products[ProductID] <span class="kw">in</span> Top_5_products )<span class="op">,</span> DESC</span>
<span id="cb31-592"><a href="#cb31-592"></a>    )<span class="op">,</span></span>
<span id="cb31-593"><a href="#cb31-593"></a>    Suppliers[CompanyName]<span class="op">,</span></span>
<span id="cb31-594"><a href="#cb31-594"></a>    <span class="st">", "</span></span>
<span id="cb31-595"><a href="#cb31-595"></a>)</span>
<span id="cb31-596"><a href="#cb31-596"></a><span class="in">```</span></span>
<span id="cb31-597"><a href="#cb31-597"></a></span>
<span id="cb31-598"><a href="#cb31-598"></a>It's Gai pâturage! Yayyy we completed the challenge!</span>
<span id="cb31-599"><a href="#cb31-599"></a></span>
<span id="cb31-600"><a href="#cb31-600"></a><span class="fu"># References</span></span>
<span id="cb31-601"><a href="#cb31-601"></a></span>
<span id="cb31-602"><a href="#cb31-602"></a><span class="ss">- </span>Link to the challenge: <span class="ot">&lt;https://curbal.com/25-days-of-dax-fridays-challenge-edition-3&gt;</span>;</span>
<span id="cb31-603"><a href="#cb31-603"></a><span class="ss">- </span>DAX codes were formatted using DAXFormatter: <span class="ot">&lt;https://www.daxformatter.com/&gt;</span>;</span>
<span id="cb31-604"><a href="#cb31-604"></a><span class="ss">- </span>A brilliant No-CALCULATE solution by Brian Julius: <span class="ot">&lt;https://github.com/bjulius/No-CALCULATE-DAX&gt;</span>;</span>
<span id="cb31-605"><a href="#cb31-605"></a><span class="ss">- </span>Worth reading - The One DAX pattern to rule them all by Greg Deckler in <span class="co">[</span><span class="ot">LinkedIn</span><span class="co">](https://www.linkedin.com/posts/gregdeckler_powerbi-microsoft-dax-activity-7056636983959322624-uxwY)</span>.</span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><span class="faux-block"><a href="https://creativecommons.org/licenses/by-nc-nd/4.0/"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i></a> 2023-2025 Le Khac Tuan</span></p>
</div>   
    <div class="nav-footer-center">
<p><span class="faux-block"> Designed with <i class="fa-solid fa-heart" aria-label="heart"></i>, <span id="commit-info">Loading last commit…</span> </span></p>
</div>
    <div class="nav-footer-right">
<p><span class="faux-block">Made with <a href="https://quarto.org/">Quarto</a></span></p>
</div>
  </div>
</footer>
<script type="application/javascript" src="commit_info.js"></script>




</body></html>